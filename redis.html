<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.2.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Redis 入门教程 - 何年の再遇见</title>


    <meta property="og:type" content="article">
<meta property="og:title" content="Redis 入门教程">
<meta property="og:url" content="https://guoshizhan.github.io/redis.html">
<meta property="og:site_name" content="何年の再遇见">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://guoshizhan.github.io/gallery/Database/Redis/redis-000.png">
<meta property="article:published_time" content="2020-07-14T08:24:02.000Z">
<meta property="article:modified_time" content="2020-08-11T13:42:27.822Z">
<meta property="article:author" content="Java Developer">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://guoshizhan.github.io/gallery/Database/Redis/redis-000.png">







<link rel="icon" href="/images/favicon.ico">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-2-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/GSZ's-Blog.png" alt="Redis 入门教程" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">首页</a>
                
                <a class="navbar-item"
                href="/archives">归档</a>
                
                <a class="navbar-item"
                href="/categories">分类</a>
                
                <a class="navbar-item"
                href="/tags">标签</a>
                
                <a class="navbar-item"
                href="/friends">友链</a>
                
                <a class="navbar-item"
                href="/albums">相册</a>
                
                <a class="navbar-item"
                href="/media">影音</a>
                
                <a class="navbar-item"
                href="/inspiration">随笔</a>
                
                <a class="navbar-item"
                href="/secret">私密</a>
                
                <a class="navbar-item"
                href="/about">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    <a class="navbar-item" target="_blank" rel="noopener" title="MyGitHub" href="https://github.com/guoshizhan">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-9-desktop is-9-widescreen has-order-2 column-main">
<div class="card">
    
    <div class="card-image">
        <span  class="image is-7by1">
            <img class="thumbnail" src="/../gallery/Database/Redis/redis-000.png" alt="Redis 入门教程">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                
                <time class="level-item has-text-grey" datetime="2020-07-14T08:24:02.000Z">2020-07-14</time>
                
                    <span class="display-none-class"></span>
                    <img class="not-gallery-item" src="/images/chat.svg">&nbsp;<a href="/redis.html#comment-container"><span></span></a>&nbsp;&nbsp;&nbsp;&nbsp;</img>
                
                
                <div class="level-item">
                <i class="fas fa-folder-open has-text-grey"></i>&nbsp;
                <a class="has-link-grey -link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 小时 读完 (大约 33025 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Redis 入门教程
            
        </h1>
        <div class="content">
            <hr>
<a id="more"></a>

<h1 id="Redis-基本介绍"><a href="#Redis-基本介绍" class="headerlink" title="Redis 基本介绍"></a>Redis 基本介绍</h1><h2 id="Redis-简介"><a href="#Redis-简介" class="headerlink" title="Redis 简介"></a>Redis 简介</h2><p><code>Redis（Remote Dictionary Server )</code> : <strong><em>即远程字典服务</em></strong> ，是一个开源的使用 ANSI C 语言编写、支持网络、可基于内存亦可持久化的日志型、<strong><em>高性能的 <code>NOSQL</code> 系列的非关系型数据库</em></strong> ，并提供多种语言的 API 。【———— 百度百科】</p>
<hr>
<p><strong><em>那么什么是 NOSQL 呢？</em></strong> <code>NoSQL(NoSQL = Not Only SQL)</code> 意为：<strong><em>不仅仅是 SQL</em></strong> ，是一项全新的数据库理念，泛指 <strong><em>非关系型数据库</em></strong> 。<code>NOSQL 出现原因：</code> 随着互联网 web2.0 网站的兴起，传统的关系数据库在应付 web2.0 网站，特别是超大规模和高并发的 SNS 类型的 web2.0 纯动态网站已经显得力不从心，暴露了很多难以克服的问题，而非关系型的数据库则由于其本身的特点得到了非常迅速的发展。NoSQL 数据库的产生就是为了解决大规模数据集合多重数据种类带来的挑战，尤其是大数据应用难题。</p>
<h2 id="Redis-优缺点"><a href="#Redis-优缺点" class="headerlink" title="Redis 优缺点"></a>Redis 优缺点</h2><p>NOSQL 和关系型数据库比较，异同点如下所示：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ Redis 优点：</span></span><br><span class="line"><span class="addition">+ 1）成本：NOSQL 数据库简单易部署，基本都是开源软件，不需要像使用 oracle 那样花费大量成本购买使用，相比关系型数据库价格便宜。</span></span><br><span class="line"><span class="addition">+ 2）查询速度：NOSQL 数据库将数据存储于缓存之中，关系型数据库将数据存储在硬盘中，自然查询速度远不及 NOSQL 数据库。</span></span><br><span class="line"><span class="addition">+ 3）存储数据的格式：NOSQL 的存储格式是 key=value 形式、文档形式、图片形式等等，所以可以存储基础类型以及对象或者是集合等各种格式，而数据库则只支持基础类型。</span></span><br><span class="line"><span class="addition">+ 4）扩展性：关系型数据库有类似 join 这样的多表查询机制的限制导致扩展很艰难。</span></span><br><span class="line"><span class="addition">+ 5）是否区分大小写：Redis 不区分大小写。</span></span><br><span class="line"><span class="addition">+ 6）瓶颈：Redis 是单线程的，所以 Redis 的瓶颈不是 CPU ，而是机器内存和网络带宽。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ Redis 缺点：</span></span><br><span class="line"><span class="deletion">- 1）维护的工具和资料有限，因为 NOSQL 是属于新的技术，不能和关系型数据库 10 几年的技术同日而语。</span></span><br><span class="line"><span class="deletion">- 2）不提供对sql的支持，如果不支持 SQL 这样的工业标准，将产生一定用户的学习和使用成本。</span></span><br><span class="line"><span class="deletion">- 3）不提供关系型数据库对事务的处理。（有些支持，有些不支持）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 总结如下：</span></span><br><span class="line"><span class="addition">+ 1）关系型数据库与 NoSQL 数据库并非对立而是互补的关系，即通常情况下使用关系型数据库，在适合使用 NoSQL 的时候使用 NoSQL 数据库。</span></span><br><span class="line"><span class="addition">+ 2）让 NoSQL 数据库对关系型数据库的不足进行弥补。</span></span><br><span class="line"><span class="addition">+ 3）一般会将数据存储在关系型数据库中，在 NoSQL 数据库中备份存储关系型数据库的数据</span></span><br></pre></td></tr></table></figure>

<h2 id="Redis-应用场景"><a href="#Redis-应用场景" class="headerlink" title="Redis 应用场景"></a>Redis 应用场景</h2><p><code>Redis</code> 是用 C 语言开发的一个开源的 <strong><em>高性能键值对（key-value）数据库</em></strong> ，官方提供测试数据，50 个并发执行 100000 个请求,读的速度是 <strong><em>110000 次 / s</em></strong> ，写的速度是 <strong><em>81000 次 / s</em></strong> 。</p>
<hr>
<p>且 Redis 通过提供多种键值数据类型来适应不同场景下的存储需求。目前为止 ， <strong><em>Redis 支持的键值数据类型</em></strong> 如下：</p>
<div class="hacker">
    <div  class="block-title ">
        <i class="fa fa-bullseye" aria-hidden="true"></i>
        <span>Redis 支持的键值数据类型：</span>
    </div>
    <div class="block">
        1、字符串类型 string
        2、哈希类型 hash
        3、列表类型 list
        4、集合类型 set
        5、有序集合类型 sortedset
    </div>
</div>

<div class="hacker">
    <div  class="block-title ">
        <i class="fa fa-bullseye" aria-hidden="true"></i>
        <span>Redis 的应用场景：</span>
    </div>
    <div class="block">
        1、缓存（数据查询、短连接、新闻内容、商品内容等等）
        2、聊天室的在线好友列表
        3、任务队列。（秒杀、抢购、12306 等等）
        4、应用排行榜
        5、网站访问统计
        6、数据过期处理（可以精确到毫秒
        7、分布式集群架构中的 session 分离
        8、发布订阅系统
        9、地图信息分析
    </div>
</div>

<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ 主流的 NOSQL 产品</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 键值(Key-Value)存储数据库</span></span><br><span class="line">相关产品： Tokyo Cabinet/Tyrant、Redis、Voldemort、Berkeley DB</span><br><span class="line">典型应用： 内容缓存，主要用于处理大量数据的高访问负载。 </span><br><span class="line">数据模型： 一系列键值对</span><br><span class="line">优势： 快速查询</span><br><span class="line">劣势： 存储的数据缺少结构化</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 列存储数据库</span></span><br><span class="line">相关产品：Cassandra, HBase, Riak</span><br><span class="line">典型应用：分布式的文件系统</span><br><span class="line">数据模型：以列簇式存储，将同一列数据存在一起</span><br><span class="line">优势：查找速度快，可扩展性强，更容易进行分布式扩展</span><br><span class="line">劣势：功能相对局限</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 文档型数据库</span></span><br><span class="line">相关产品：CouchDB、MongoDB</span><br><span class="line">典型应用：Web应用（与 Key-Value 类似，Value 是结构化的）</span><br><span class="line">数据模型： 一系列键值对</span><br><span class="line">优势：数据结构要求不严格</span><br><span class="line">劣势： 查询性能不高，而且缺乏统一的查询语法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 图形(Graph)数据库</span></span><br><span class="line">相关数据库：Neo4J、InfoGrid、Infinite Graph</span><br><span class="line">典型应用：社交网络</span><br><span class="line">数据模型：图结构</span><br><span class="line">优势：利用图结构相关算法。</span><br><span class="line">劣势：需要对整个图做计算才能得出结果，不容易做分布式的集群方案。</span><br></pre></td></tr></table></figure>

<h2 id="Redis-下载安装"><a href="#Redis-下载安装" class="headerlink" title="Redis 下载安装"></a>Redis 下载安装</h2><blockquote>
<p><code>Redis 的下载：</code></p>
<p>1、Redis 官网下载链接：<a href="https://redis.io">Redis 官网</a> 【下载的是 Liunx 版本，不是 windows 版本】<br>2、Redis 中文网下载链接：<a href="http://www.redis.net.cn/">Redis 中文网</a> 【下载的是 Liunx 版本，不是 windows 版本】<br>3、GitHub 下载链接：<a href="https://github.com/MicrosoftArchive/redis/releases">Redis 的 GitHub 地址</a> 【建议使用，各种版本都有，这个是微软的，不是 Redis 的】<br>4、本博客站点下载：<a href="../gallery/Resources/redis-2.8.9.zip">redis-2.8.9.zip</a> 【建议使用，windows 版本的】</p>
</blockquote>
<p>下载完成之后，<code>解压即可使用</code> 。解压之后如下图：</p>
<p><img src="../gallery/Database/Redis/redis-001.png" alt=""></p>
<p><strong><em>那么如何使用 Redis 呢？</em></strong> <code>双击打开 redis-server.exe</code> ，如下图：</p>
<p><img src="../gallery/Database/Redis/redis-002.png" alt=""></p>
<p>然后 <code>双击打开 redis-cli.exe</code> 即可使用，如下图：</p>
<p><img src="../gallery/Database/Redis/redis-003.png" alt=""></p>
<h2 id="Redis-配置文件详解"><a href="#Redis-配置文件详解" class="headerlink" title="Redis 配置文件详解"></a>Redis 配置文件详解</h2><p>这个是 <strong><em>windows 下的配置文件【linux 的在 Redis 高级部分】</em></strong>，具体解释如下：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 指定 Redis 运行的端口，默认是 6379</span></span><br><span class="line"><span class="string">port</span> <span class="number">6379</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置客户端连接时的超时时间，单位为秒。当客户端在这段时间内没有发出任何指令，那么就关闭该连接。0 代表关闭此设置</span></span><br><span class="line"><span class="string">timeout</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="string">tcp-keepalive</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当 Redis 在后台运行的时候，Redis 默认会把 pid 文件放在 /var/run/redis.pid ，你也可以配置到其他地址。当运行多个 Redis 服务时，需要指定不同的 pid 文件和端口</span></span><br><span class="line"><span class="string">pidfile</span> <span class="string">/var/run/redis.pid</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定日志记录级别。Redis 总共支持四个级别：debug、verbose、notice、warning，默认为 notice</span></span><br><span class="line"><span class="comment"># debug 记录很多信息，用于开发和测试。varbose 有用的信息，不像 debug 会记录那么多。notice 就是普通的 verbose ，常用于生产环境。warning 只有非常重要或者严重的信息会记录到日志</span></span><br><span class="line"><span class="string">loglevel</span> <span class="string">notice</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认值为 stdout ，标准输出，若后台模式会输出到 /dev/null</span></span><br><span class="line"><span class="string">logfile</span> <span class="string">stdout</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 代表 Redis 默认有 16 个数据库，默认使用第 0 个数据库。如果需要切换，那就进入到客户端，使用命令：select n （n 代表第 n + 1 个数据库，n 最大为 15 ）</span></span><br><span class="line"><span class="string">databases</span> <span class="number">16</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># daemonize no 默认情况下，redis不是在后台运行的，如果需要在后台运行，把该项的值更改为yes</span></span><br><span class="line"><span class="string">daemonize</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="string">save</span> <span class="number">900</span> <span class="number">1</span></span><br><span class="line"><span class="string">save</span> <span class="number">300</span> <span class="number">10</span></span><br><span class="line"><span class="string">save</span> <span class="number">60</span>  <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="string">stop-writes-on-bgsave-error</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在启动 redis 时是否显示 logo</span></span><br><span class="line"><span class="string">always-show-logo</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="string">rdbcompression</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="string">rdbchecksum</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="string">dbfilename</span> <span class="string">dump.rdb</span></span><br><span class="line"></span><br><span class="line"><span class="string">dir</span> <span class="string">./</span></span><br><span class="line"></span><br><span class="line"><span class="string">slave-serve-stale-data</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="string">slave-read-only</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="string">repl-disable-tcp-nodelay</span> <span class="literal">no</span></span><br><span class="line"></span><br><span class="line"><span class="string">slave-priority</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="string">appendonly</span> <span class="literal">no</span></span><br><span class="line"></span><br><span class="line"><span class="string">appendfsync</span> <span class="string">everysec</span></span><br><span class="line"></span><br><span class="line"><span class="literal">no</span><span class="string">-appendfsync-on-rewrite</span> <span class="literal">no</span></span><br><span class="line"></span><br><span class="line"><span class="string">auto-aof-rewrite-percentage</span> <span class="number">100</span></span><br><span class="line"><span class="string">auto-aof-rewrite-min-size</span> <span class="string">64mb</span></span><br><span class="line"></span><br><span class="line"><span class="string">lua-time-limit</span> <span class="number">5000</span></span><br><span class="line"></span><br><span class="line"><span class="string">slowlog-log-slower-than</span> <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="string">slowlog-max-len</span> <span class="number">128</span></span><br><span class="line"></span><br><span class="line"><span class="string">hash-max-ziplist-entries</span> <span class="number">512</span></span><br><span class="line"><span class="string">hash-max-ziplist-value</span> <span class="number">64</span></span><br><span class="line"></span><br><span class="line"><span class="string">list-max-ziplist-entries</span> <span class="number">512</span></span><br><span class="line"><span class="string">list-max-ziplist-value</span> <span class="number">64</span></span><br><span class="line"></span><br><span class="line"><span class="string">set-max-intset-entries</span> <span class="number">512</span></span><br><span class="line"></span><br><span class="line"><span class="string">zset-max-ziplist-entries</span> <span class="number">128</span></span><br><span class="line"><span class="string">zset-max-ziplist-value</span> <span class="number">64</span></span><br><span class="line"></span><br><span class="line"><span class="string">activerehashing</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line"><span class="string">client-output-buffer-limit</span> <span class="string">normal</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="string">client-output-buffer-limit</span> <span class="string">slave</span> <span class="string">256mb</span> <span class="string">64mb</span> <span class="number">60</span></span><br><span class="line"><span class="string">client-output-buffer-limit</span> <span class="string">pubsub</span> <span class="string">32mb</span> <span class="string">8mb</span> <span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="string">hz</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="string">aof-rewrite-incremental-fsync</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>
<h1 id="相关操作命令"><a href="#相关操作命令" class="headerlink" title="相关操作命令"></a>相关操作命令</h1><blockquote>
<p><code>TIPS：</code></p>
<p>Redis 中文网教程： <a href="https://www.redis.net.cn/tutorial/3501.html">Redis 教程</a><br>Redis 的官方文档： <a href="https://redis.io/documentation">Redis 文档</a></p>
</blockquote>
<h2 id="redis-数据结构"><a href="#redis-数据结构" class="headerlink" title="redis 数据结构"></a>redis 数据结构</h2><p><code>redis</code> 存储的是 <strong><em>key-value 格式</em></strong> 的数据。其中 <strong><em>key 都是字符串</em></strong> ，而 <strong><em>value 却有 5 种不同的数据结构</em></strong> ，如下图：</p>
<p><img src="../gallery/Database/Redis/redis-004.bmp" alt=""></p>
<h2 id="通用命令"><a href="#通用命令" class="headerlink" title="通用命令"></a>通用命令</h2><p><strong><em>通用命令</em></strong> 的相关操作以及截图如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ 通用命令</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ keys *            查询所有的键</span></span><br><span class="line"><span class="addition">+ type key          获取键对应的 value 的类型</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">- del key           删除指定的 key</span></span><br><span class="line"><span class="deletion">- flushdb           清空当前数据库</span></span><br><span class="line"><span class="deletion">- flushall          清空所有数据库</span></span><br><span class="line"><span class="deletion">- clear             清空屏幕</span></span><br><span class="line"><span class="deletion">- expire key n      表示 key 在 n 秒后会过期。例如：expire name 10 表示 name 这个键在 10 秒后会过期</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ dbsize            查看当前数据库大小</span></span><br><span class="line"><span class="addition">+ select 8          切换到第 9 个数据库，n 最大值为 15</span></span><br><span class="line"><span class="addition">+ exist key         判断某个键是否存在。例如：exist name 表示判断 name 这个键是否存在</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 通用命令</span></span><br></pre></td></tr></table></figure>

<p><img src="../gallery/Database/Redis/redis-011.png" alt=""><br><img src="../gallery/Database/Redis/redis-064.png" alt=""></p>
<h2 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h2><p><strong><em>字符串类型</em></strong> 的常用命令相关操作以及截图如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ 字符串类型 string</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 存储： set key value                   举例：127.0.0.1:6379&gt; set age 23</span></span><br><span class="line"><span class="addition">+ 追加： append key value                举例：127.0.0.1:6379&gt; append age 24</span></span><br><span class="line"><span class="addition">+ 获取： get key                         举例：127.0.0.1:6379&gt; get age</span></span><br><span class="line">                                        </span><br><span class="line"><span class="deletion">- 删除： del key                         举例：127.0.0.1:6379&gt; del age</span></span><br><span class="line">                                        </span><br><span class="line"><span class="addition">+ 长度： strlen key                      举例：127.0.0.1:6379&gt; strlen age</span></span><br><span class="line"><span class="addition">+ 截取： getrange key start end          举例：127.0.0.1:6379&gt; getrange age 0 -1</span></span><br><span class="line"><span class="addition">+ 替换： setrange key index value        举例：127.0.0.1:6379&gt; setrange age 0 G</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 字符串类型 string</span></span><br></pre></td></tr></table></figure>

<p><img src="../gallery/Database/Redis/redis-005.png" alt=""></p>
<p><strong><em>字符串类型</em></strong> 的高级操作，这里只做简单介绍，更多详情介绍请 <a href="https://www.redis.net.cn/order/3555.html">参阅官网</a> 。高级命令如下：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># setnx 命令： Setnx（SET if Not eXists） 命令在指定的 key 不存在时，为 key 设置指定的值。</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379&gt;</span> <span class="string">SETNX</span> <span class="string">KEY_NAME</span> <span class="string">VALUE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mset 命令： Mset 命令用于同时设置一个或多个 key-value 对</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379&gt;</span> <span class="string">MSET</span> <span class="string">key1</span> <span class="string">value1</span> <span class="string">key2</span> <span class="string">value2</span> <span class="string">..</span> <span class="string">keyN</span> <span class="string">valueN</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># setex 命令： Setex 为指定的 key 设置值及其过期时间。如果 key 已经存在， SETEX 命令将会替换旧的值。</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379&gt;</span> <span class="string">SETEX</span> <span class="string">KEY_NAME</span> <span class="string">TIMEOUT</span> <span class="string">VALUE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># incr 命令： Incr 命令将 key 中储存的数字值增一。如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 INCR 操作。注意 key 的值必须是 integer 类型的，就是整型</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379&gt;</span> <span class="string">INCR</span> <span class="string">KEY_NAME</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># incrby 命令： 对 key 的值自动加 n，类似于 i += n</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379&gt;</span> <span class="string">INCRBY</span> <span class="string">KEY_NAME</span> <span class="string">INCR_AMOUNT</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># decr 命令： Decr 命令将 key 中储存的数字值减一。如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 DECR 操作。注意 key 的值必须是 integer 类型的，就是整型</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379&gt;</span> <span class="string">DECR</span> <span class="string">KEY_NAME</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># decrby 命令： 将 key 所储存的值减去指定的减量值。意思就是对 key 的值自动加 n，类似于 i += n 。</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379&gt;</span> <span class="string">DECRBY</span> <span class="string">KEY_NAME</span> <span class="string">DECREMENT_AMOUNT</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set 命令存储 json 特殊用法</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379&gt;</span> <span class="string">set</span> <span class="string">user:1</span> <span class="string">&#123;name:zhangsan,age:23&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># getset 命令： Getset 命令用于设置指定 key 的值，并返回 key 旧的值。</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379&gt;</span> <span class="string">GETSET</span> <span class="string">KEY_NAME</span> <span class="string">VALUE</span></span><br></pre></td></tr></table></figure>

<h2 id="哈希类型"><a href="#哈希类型" class="headerlink" title="哈希类型"></a>哈希类型</h2><p><strong><em>哈希类型</em></strong> 的相关操作以及截图如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ 哈希类型 hash</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 存储： hset key field value       举例：127.0.0.1:6379&gt; hset myhash username guo</span></span><br><span class="line"><span class="addition">+ 获取： hget key field             举例：127.0.0.1:6379&gt; hget myhash username</span></span><br><span class="line"><span class="deletion">- 删除： hdel key field             举例：127.0.0.1:6379&gt; hdel myhash username</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 哈希类型 hash</span></span><br></pre></td></tr></table></figure>

<p><img src="../gallery/Database/Redis/redis-006.png" alt=""></p>
<h2 id="列表类型"><a href="#列表类型" class="headerlink" title="列表类型"></a>列表类型</h2><p><strong><em>列表类型</em></strong> 的相关操作以及截图如下：</p>
<p><img src="../gallery/Database/Redis/redis-007.png" alt="列表类型示意图"></p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ 列表类型 list ：可以添加一个元素到列表的头部（左边）或者尾部（右边）。注意：列表类型里面的元素允许重复</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 向左添加： lpush key value             举例：127.0.0.1:6379&gt; lpush mylist a</span></span><br><span class="line"><span class="addition">+ 向右添加： rpush key value             举例：127.0.0.1:6379&gt; rpush mylist c</span></span><br><span class="line"><span class="addition">+ 范围获取： lrange key start end        举例：127.0.0.1:6379&gt; lrange mylist 0 -1</span></span><br><span class="line"><span class="addition">+ 指定获取： lindex key index            举例：127.0.0.1:6379&gt; lindex mylist 1</span></span><br><span class="line"><span class="addition">+ 列表长度： llen key                    举例：127.0.0.1:6379&gt; llen mylist</span></span><br><span class="line"><span class="addition">+ 列表修剪： ltrim key start stop        举例：127.0.0.1:6379&gt; ltrim mylist 0 1</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">- 向左删除： lpop key                    举例：127.0.0.1:6379&gt; lpop mylist</span></span><br><span class="line"><span class="deletion">- 向右删除： rpop key                    举例：127.0.0.1:6379&gt; rpop mylist</span></span><br><span class="line"><span class="deletion">- 移除元素： lrem key count value        举例：127.0.0.1:6379&gt; lrem mylist 2 Java</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 列表类型 list</span></span><br></pre></td></tr></table></figure>

<p><img src="../gallery/Database/Redis/redis-008.png" alt=""></p>
<h2 id="集合类型"><a href="#集合类型" class="headerlink" title="集合类型"></a>集合类型</h2><p><strong><em>集合类型</em></strong> 的相关操作以及截图如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ 集合类型 set  注意：集合类型里面的元素不允许重复且不保证顺序</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 添加： sadd key value              举例：127.0.0.1:6379&gt; sadd myset a</span></span><br><span class="line"><span class="addition">+ 获取： smembers key                举例：127.0.0.1:6379&gt; smembers myset</span></span><br><span class="line"><span class="addition">+ 交集： sinter key1 key2 ...keyn    举例：127.0.0.1:6379&gt; sinter myset myset2</span></span><br><span class="line"><span class="addition">+ 并集： sunion key1 key2 ...keyn    举例：127.0.0.1:6379&gt; sunion myset myset2</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">- 删除： srem key value              举例：127.0.0.1:6379&gt; srem myset a</span></span><br><span class="line"><span class="deletion">- 差集： sdiff key1 key2 ...keyn     举例：127.0.0.1:6379&gt; sdiff myset myset2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 集合类型 set</span></span><br></pre></td></tr></table></figure>

<p><img src="../gallery/Database/Redis/redis-009.png" alt=""></p>
<h2 id="有序集合类型"><a href="#有序集合类型" class="headerlink" title="有序集合类型"></a>有序集合类型</h2><p><strong><em>有序集合类型</em></strong> 的相关操作以及截图如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ 有序集合类型 sortedset  注意：不允许重复元素，且元素有顺序。</span></span><br><span class="line"><span class="comment">+++ 每个元素都会关联一个 double 类型的分数。redis 正是通过分数来为集合中的成员进行从小到大的排序。</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 添加： zadd key score value                举例：127.0.0.1:6379&gt; zadd mysort 60 Jack</span></span><br><span class="line"><span class="addition">+ 获取： zrange key start end [withscores]   举例：127.0.0.1:6379&gt; zrange mysort 0 -1 或者 zrange mysort 0 -1 withscores</span></span><br><span class="line"><span class="deletion">- 删除： zrem key value                      举例：127.0.0.1:6379&gt; zrem mysort Jack</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 有序集合类型 sortedset</span></span><br></pre></td></tr></table></figure>

<p><img src="../gallery/Database/Redis/redis-010.png" alt=""></p>
<h2 id="Redis-的持久化"><a href="#Redis-的持久化" class="headerlink" title="Redis 的持久化"></a>Redis 的持久化</h2><h3 id="持久化简介"><a href="#持久化简介" class="headerlink" title="持久化简介"></a>持久化简介</h3><p><strong><em>什么是持久化呢？</em></strong> 因为 Redis 是一个内存数据库，当 Redis 服务器重启或者电脑重启，那么数据就会丢失。这个时候我们就要进行持久化操作，将 Redis 内存中的数据持久化保存到硬盘的文件中。</p>
<h3 id="持久化机制"><a href="#持久化机制" class="headerlink" title="持久化机制"></a>持久化机制</h3><p>接下来介绍一下 Redis 的持久化机制。Redis 持久化机制有两种：<code>RDB 机制</code> 和 <code>AOF 机制</code> 。具体详情介绍如下：</p>
<hr>
<p><code>RDB 机制：</code> 这是 Redis 持久化的默认方式，不需要进行配置，默认就使用这种机制。这种机会在一定的间隔时间中，检测 key 的变化情况，然后持久化数据。接下来我们实际操作一下，看一下这种机制如何实现。</p>
<hr>
<p><strong><em>第一步：</em></strong> 编辑 Redis 安装目录下的 <code>redis.windwos.conf</code> 配置文件，找到如下内容，然后修改一下配置，把 <code>save 60 10000</code> 注释掉，修改为 <code>save 10 5</code> 。这里的修改只是用于测试，测试完成之后改回原来的数据。修改如下：</p>
<figure class="highlight yml"><figcaption><span>redis.windwos.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># after 900 sec (15 min) if at least 1 key changed      中文意思是：15 分钟内，如果有 1 个 key 改变，那么就进行持久化</span></span><br><span class="line"><span class="comment"># after 300 sec (5 min) if at least 10 keys changed     中文意思是：5 分钟内，如果有 10 个 key 改变，那么就进行持久化</span></span><br><span class="line"><span class="comment"># after 60 sec if at least 10000 keys changed           中文意思是：1 分钟内，如果有 10000 个 key 改变，那么就进行持久化</span></span><br><span class="line"></span><br><span class="line"><span class="string">save</span> <span class="number">900</span> <span class="number">1</span></span><br><span class="line"><span class="string">save</span> <span class="number">300</span> <span class="number">10</span></span><br><span class="line"><span class="comment"># save 60 10000</span></span><br><span class="line"><span class="comment"># 10 秒内，如果有 5 个 key 改变，那么就进行持久化，即会在 Redis 安装目录生成一个以 rdb 为后缀的文件</span></span><br><span class="line"><span class="string">save</span> <span class="number">10</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>

<p><strong><em>第二步：</em></strong> 以指定配置文件名称的方式重新启动 Redis 服务器，启动过程如下图：</p>
<p><img src="../gallery/Database/Redis/redis-012.png" alt=""><br><img src="../gallery/Database/Redis/redis-013.png" alt=""></p>
<p><strong><em>第三步：</em></strong> 测试 RDB 机制，看是否生成以 <code>rdb</code> 为后缀的持久化文件。过程如下图：</p>
<p><img src="../gallery/Database/Redis/redis-014.png" alt=""><br><img src="../gallery/Database/Redis/redis-015.png" alt=""></p>
<p><strong><em>第四步：</em></strong> 以指定配置文件名称的方式重启 Redis 服务器，看里面是否还有数据。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-016.png" alt=""></p>
<blockquote>
<p><code>温馨小提示：</code> 记得把修改了的配置文件修改回去嗷！！！</p>
</blockquote>
<hr>
<p>接下来，我们介绍 <code>AOF 机制：</code> 日志记录的方式，可以记录每一条命令的操作。可以在每一次命令操作完成之后就持久化数据。那么现在就来操作一波吧！<strong><em>第一步：</em></strong> 编辑 <code>redis.windwos.conf</code> 配置文件，找到 <code>appendonly no</code> （关闭 aof）（在 392 行） ，然后将其修改为 <code>appendonly yes</code> （开启 aof）。修改好后保存。以下配置了解一下，不需要修改：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以下三行配置在 420 行，对应的功能都写好了</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># appendfsync always    每一次操作都进行持久化</span></span><br><span class="line"><span class="string">appendfsync</span> <span class="string">everysec</span>  <span class="comment"># 每隔一秒进行一次持久化</span></span><br><span class="line"><span class="comment"># appendfsync no        不进行持久化</span></span><br></pre></td></tr></table></figure>

<p><strong><em>第二步：</em></strong> 以指定配置文件名称的方式重新启动 Redis 服务器，启动过程如下图：</p>
<p><img src="../gallery/Database/Redis/redis-017.png" alt=""><br><img src="../gallery/Database/Redis/redis-013.png" alt=""></p>
<p><strong><em>第三步：</em></strong> 测试 AOF 机制，看是否生成以 <code>aof</code> 为后缀的持久化文件。过程如下图：</p>
<p><img src="../gallery/Database/Redis/redis-018.png" alt=""><br><img src="../gallery/Database/Redis/redis-019.png" alt=""></p>
<p><strong><em>第四步：</em></strong> 以指定配置文件名称的方式重启 Redis 服务器，看里面是否还有数据。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-020.png" alt=""></p>
<blockquote>
<p><code>两种持久化机制不足：</code></p>
<p><code>RDB 机制：</code> 数据可能无法完全保存，存在一些数据的丢失。<br><code>AOF 机制：</code> 对性能影响比较严重，耗内存。</p>
</blockquote>
<h1 id="Jedis-快速入门"><a href="#Jedis-快速入门" class="headerlink" title="Jedis 快速入门"></a>Jedis 快速入门</h1><h2 id="Jedis-简介"><a href="#Jedis-简介" class="headerlink" title="Jedis 简介"></a>Jedis 简介</h2><p><code>Jedis</code> <strong><em>是一款 Redis 官方推荐 java 操作 redis 数据库的工具，与 JDBC 很类似</em></strong> 。</p>
<hr>
<p>使用步骤：</p>
<ul>
<li><code>第一步：</code> 下载 jedis 的 jar 包 ，<a href="https://mvnrepository.com/artifact/redis.clients/jedis">官方下载</a> 或者 <a href="../gallery/Resources/jedis.zip">本博客下载</a></li>
<li><code>第二步：</code> 新建 JavaEE 项目，然后添加 jedis 的 jar 包。</li>
<li><code>第三步：</code> 启动 redis 服务器 redis-server.exe 。</li>
<li><code>第四步：</code> 编写 Java 程序对 redis 进行操作。</li>
<li><code>第五步：</code> 启动 redis 的客户端 redis-cli.exe 进行结果查看。</li>
</ul>
<hr>
<h2 id="Jedis-的使用"><a href="#Jedis-的使用" class="headerlink" title="Jedis 的使用"></a>Jedis 的使用</h2><p><code>第一步：</code> <strong><em>新建一个 JavaEE 项目【如果新建 Maven 项目会更简单，只要导入依赖即可】</em></strong>。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-021.png" alt=""><br><img src="../gallery/Database/Redis/redis-022.png" alt=""><br><img src="../gallery/Database/Redis/redis-023.png" alt=""><br><img src="../gallery/Database/Redis/redis-024.png" alt=""></p>
<p><code>第二步：</code> 启动 redis 服务器。找到自己 redis 安装目录，双击 redis-server.exe 即可启动。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-025.png" alt=""></p>
<p><code>第三步：</code> 编写 Java 程序对 redis 进行操作。相关代码如下：</p>
<figure class="highlight java"><figcaption><span>JedisTest.class</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 15:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Jedis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedisTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、获取连接。如果使用空参构造，那么默认值就是 "localhost",6379 </span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"localhost"</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="comment">// 2、进行操作</span></span><br><span class="line">        jedis.set(<span class="string">"username"</span>, <span class="string">"guoshizhan"</span>);</span><br><span class="line">        <span class="comment">// 3、关闭连接</span></span><br><span class="line">        jedis.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第四步：</code> 启动 redis 的客户端 redis-cli.exe 进行结果查看。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-026.png" alt=""></p>
<h2 id="Jedis-的各种操作"><a href="#Jedis-的各种操作" class="headerlink" title="Jedis 的各种操作"></a>Jedis 的各种操作</h2><blockquote>
<p><code>温馨小提示：</code></p>
<p><strong><em>1、Jedis 里面的各种方法和 Redis 里面的各种命令是相互对应的，所以操作起来相对简单。</em></strong><br><strong><em>2、Jedis 里面也会有一些特殊的方法，这些方法都将在代码里体现。</em></strong></p>
</blockquote>
<p><code>第一种操作：</code> <strong><em>Jedis 操作 redis 中的字符串类型</em></strong> 。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 15:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Jedis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedisTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、获取连接</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"localhost"</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、进行操作</span></span><br><span class="line">        jedis.set(<span class="string">"username"</span>, <span class="string">"guoshizhan"</span>);</span><br><span class="line">        jedis.set(<span class="string">"age"</span>, <span class="string">"22"</span>);</span><br><span class="line"></span><br><span class="line">        String str = jedis.get(<span class="string">"age"</span>);</span><br><span class="line">        System.out.println(str);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// setex() 方法存储可以指定时间过期的 key-value</span></span><br><span class="line">        <span class="comment">// 以下代码表示把 activeCode:039752 键值对存入 Redis ，30 秒之后过期</span></span><br><span class="line">        jedis.setex(<span class="string">"activeCode"</span>, <span class="number">30</span>, <span class="string">"039752"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、关闭连接</span></span><br><span class="line">        jedis.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码的执行结果如下图：</p>
<p><img src="../gallery/Database/Redis/redis-027.png" alt=""><br><img src="../gallery/Database/Redis/redis-028.png" alt=""></p>
<p><code>第二种操作：</code> <strong><em>Jedis 操作 redis 中的哈希类型</em></strong> 。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 15:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Jedis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedisTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、获取连接</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"localhost"</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、进行操作：存储 hash</span></span><br><span class="line">        jedis.hset(<span class="string">"user"</span>, <span class="string">"username"</span>, <span class="string">"guoshizhan"</span>);</span><br><span class="line">        jedis.hset(<span class="string">"user"</span>, <span class="string">"address"</span>, <span class="string">"HangZhou"</span>);</span><br><span class="line">        jedis.hset(<span class="string">"user"</span>, <span class="string">"gender"</span>, <span class="string">"male"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、获取 hash</span></span><br><span class="line">        String username = jedis.hget(<span class="string">"user"</span>, <span class="string">"username"</span>);</span><br><span class="line">        System.out.println(username);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; stringMap = jedis.hgetAll(<span class="string">"user"</span>);</span><br><span class="line">        Set&lt;String&gt; keySet = stringMap.keySet();</span><br><span class="line">        <span class="keyword">for</span> (String key : keySet) &#123;</span><br><span class="line">            String value = stringMap.get(key);</span><br><span class="line">            System.out.println(key + <span class="string">"---"</span> + value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、关闭连接</span></span><br><span class="line">        jedis.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码的执行结果如下图：</p>
<p><img src="../gallery/Database/Redis/redis-029.png" alt=""><br><img src="../gallery/Database/Redis/redis-030.png" alt=""></p>
<p><code>第三种操作：</code> <strong><em>Jedis 操作 redis 中的列表类型</em></strong> 。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 15:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Jedis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedisTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、获取连接</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"localhost"</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、进行操作：存储 list</span></span><br><span class="line">        jedis.lpush(<span class="string">"myList"</span>, <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>);</span><br><span class="line">        jedis.rpush(<span class="string">"myList"</span>, <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、范围获取</span></span><br><span class="line">        List&lt;String&gt; myList = jedis.lrange(<span class="string">"myList"</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        System.out.println(myList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、删除操作</span></span><br><span class="line">        String eleLeft = jedis.lpop(<span class="string">"myList"</span>);    <span class="comment">// 从左边删除</span></span><br><span class="line">        System.out.println(eleLeft);</span><br><span class="line">        String eleright = jedis.rpop(<span class="string">"myList"</span>);   <span class="comment">// 从右边删除</span></span><br><span class="line">        System.out.println(eleright);</span><br><span class="line">        System.out.println(jedis.lrange(<span class="string">"myList"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、关闭连接</span></span><br><span class="line">        jedis.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码的执行结果如下图：</p>
<p><img src="../gallery/Database/Redis/redis-031.png" alt=""></p>
<p><code>第四种操作：</code> <strong><em>Jedis 操作 redis 中的集合类型</em></strong> 。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 15:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Jedis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedisTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、获取连接</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"localhost"</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、进行操作：存储 set ，不重复存储且无序</span></span><br><span class="line">        jedis.sadd(<span class="string">"mySet"</span>, <span class="string">"Java"</span>, <span class="string">"C++"</span>, <span class="string">"HTML"</span>, <span class="string">"Java"</span>);</span><br><span class="line">        Set&lt;String&gt; mySet = jedis.smembers(<span class="string">"mySet"</span>);</span><br><span class="line">        System.out.println(mySet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、关闭连接</span></span><br><span class="line">        jedis.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码的执行结果如下图：</p>
<p><img src="../gallery/Database/Redis/redis-032.png" alt=""></p>
<p><code>第五种操作：</code> <strong><em>Jedis 操作 redis 中的有序集合类型</em></strong> 。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 15:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Jedis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedisTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、获取连接</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"localhost"</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、进行操作：存储 set ，不重复存储且无序</span></span><br><span class="line">        jedis.zadd(<span class="string">"sortedSet"</span>, <span class="number">9</span>, <span class="string">"典韦"</span>);</span><br><span class="line">        jedis.zadd(<span class="string">"sortedSet"</span>, <span class="number">7</span>, <span class="string">"亚瑟"</span>);</span><br><span class="line">        jedis.zadd(<span class="string">"sortedSet"</span>, <span class="number">5</span>, <span class="string">"白起"</span>);</span><br><span class="line"></span><br><span class="line">        Set&lt;String&gt; sortedSet = jedis.zrange(<span class="string">"sortedSet"</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        System.out.println(sortedSet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、关闭连接</span></span><br><span class="line">        jedis.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码的执行结果如下图：</p>
<p><img src="../gallery/Database/Redis/redis-033.png" alt=""></p>
<h2 id="Jedis-连接池"><a href="#Jedis-连接池" class="headerlink" title="Jedis 连接池"></a>Jedis 连接池</h2><p>Jedis 有直连方式，所谓直连指的是 Jedis 每次都会新建 TCP 连接，使用后再断开连接，对于频繁访问 Redis 的场景显然不是高效的使用方式。<strong><em>因此， Jedis 连接池 JedisPool 诞生了。</em></strong> 当我们需要连接 Redis 时，只需要向 JedisPool 池子中借，用完了再归还给 JedisPool 池子即可。 </p>
<hr>
<p>使用步骤：</p>
<ul>
<li><code>第一步：</code> 下载 jedis 的 jar 包 ，把 commons-pool2-2.3.jar 加入到项目的 lib 文件夹中。jar 包下载： <a href="../gallery/Resources/jedis.zip">本博客下载</a></li>
<li><code>第二步：</code> 编写相关代码：1、创建 JedisPool 连接池对象；2、调用方法 getResource() 方法获取 Jedis 连接。</li>
<li><code>第三步：</code> 查看结果。</li>
</ul>
<hr>
<p><code>第一步</code> 的操作如下图：</p>
<p><img src="../gallery/Database/Redis/redis-034.png" alt=""></p>
<p><code>第二步</code> 的具体代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 15:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Jedis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedisPoolTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建 Jedis 连接池对象</span></span><br><span class="line">        JedisPool jedisPool = <span class="keyword">new</span> JedisPool();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、获取连接</span></span><br><span class="line">        Jedis jedis = jedisPool.getResource();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、进行使用</span></span><br><span class="line">        jedis.set(<span class="string">"jedisPool"</span>, <span class="string">"jedisPool"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、关闭，就是把 jedis 对象归还到 jedisPool 连接池中</span></span><br><span class="line">        jedis.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码的执行结果如下图：</p>
<p><img src="../gallery/Database/Redis/redis-035.png" alt=""></p>
<h2 id="Jedis-连接池工具类"><a href="#Jedis-连接池工具类" class="headerlink" title="Jedis 连接池工具类"></a>Jedis 连接池工具类</h2><p>感觉 使用 Jedis 连接池创建对象比较麻烦，那我们就来写一个 Jedis 连接池工具类吧！<strong><em>开始撸码 ing ……</em></strong></p>
<hr>
<p><strong><em>第一步：</em></strong> 在 <code>src 目录</code> 下新建 <code>utils 包</code> 和 jedis 配置文件 <code>jedis.properties</code> 。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-036.png" alt=""></p>
<p><strong><em>第二步：</em></strong> 编写 Jedis 配置文件 <code>jedis.properties</code> 和 Jedis 连接池工具类 <code>JedisPoolUtils</code> 。配置文件代码如下：</p>
<figure class="highlight properties"><figcaption><span>jedis.properties</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主机地址，可以是服务器地址，也可以是本地</span></span><br><span class="line"><span class="attr">host</span>=<span class="string">127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 端口号</span></span><br><span class="line"><span class="attr">port</span>=<span class="string">6379</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最大连接数</span></span><br><span class="line"><span class="attr">maxTotal</span>=<span class="string">50</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最大空闲连接数</span></span><br><span class="line"><span class="attr">maxIdle</span>=<span class="string">10</span></span><br></pre></td></tr></table></figure>

<p>Jedis 连接池工具类代码如下：</p>
<figure class="highlight java"><figcaption><span>JedisPoolUtils.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 22:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Jedis 连接池工具类，用于加载连接池的配置文件，降低程序的耦合性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisPoolUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义静态代码块，当这个类一加载，它就去读取连接池的配置文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// 1、读取配置文件</span></span><br><span class="line">        InputStream inputStream = JedisPoolUtils.class.getClassLoader().getResourceAsStream("jedis.properties");</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、创建 properties 对象</span></span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、关联连接池配置文件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            properties.load(inputStream);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、获取数据，设置到 JedisPoolConfig 中</span></span><br><span class="line">        JedisPoolConfig config = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        config.setMaxTotal(Integer.parseInt(properties.getProperty(<span class="string">"maxTotal"</span>)));</span><br><span class="line">        config.setMaxIdle(Integer.parseInt(properties.getProperty(<span class="string">"maxIdle"</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、初始化 jedisPool</span></span><br><span class="line">        jedisPool = <span class="keyword">new</span> JedisPool(config, properties.getProperty(<span class="string">"host"</span>), Integer.parseInt(properties.getProperty(<span class="string">"port"</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Jedis <span class="title">getJedis</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jedisPool.getResource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>第三步：</em></strong> 编写测试类代码。具体代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> utils.JedisPoolUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 15:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Jedis 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedisPoolTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、jedis 连接池工具类的使用</span></span><br><span class="line">        Jedis jedis = JedisPoolUtils.getJedis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、进行操作</span></span><br><span class="line">        jedis.set(<span class="string">"jedisPoolUtils"</span>, <span class="string">"jedisPoolUtils"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、关闭，就是把 jedis 对象归还到连接池中</span></span><br><span class="line">        jedis.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>第四步：</em></strong> 查看测试结果。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-037.png" alt=""></p>
<blockquote>
<p><code>附赠：jedis 的详细配置一览：</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 最大活动对象数     </span></span><br><span class="line"><span class="meta">redis.pool.maxTotal</span>=<span class="string">1000    </span></span><br><span class="line"><span class="comment"># 最大能够保持idel状态的对象数      </span></span><br><span class="line"><span class="meta">redis.pool.maxIdle</span>=<span class="string">100  </span></span><br><span class="line"><span class="comment"># 最小能够保持idel状态的对象数   </span></span><br><span class="line"><span class="meta">redis.pool.minIdle</span>=<span class="string">50    </span></span><br><span class="line"><span class="comment"># 当池内没有返回对象时，最大等待时间    </span></span><br><span class="line"><span class="meta">redis.pool.maxWaitMillis</span>=<span class="string">10000    </span></span><br><span class="line"><span class="comment"># 当调用borrow Object方法时，是否进行有效性检查    </span></span><br><span class="line"><span class="meta">redis.pool.testOnBorrow</span>=<span class="string">true    </span></span><br><span class="line"><span class="comment"># 当调用return Object方法时，是否进行有效性检查    </span></span><br><span class="line"><span class="meta">redis.pool.testOnReturn</span>=<span class="string">true  </span></span><br><span class="line"><span class="comment"># “空闲链接”检测线程，检测的周期，毫秒数。如果为负值，表示不运行“检测线程”。默认为-1.  </span></span><br><span class="line"><span class="meta">redis.pool.timeBetweenEvictionRunsMillis</span>=<span class="string">30000  </span></span><br><span class="line"><span class="comment"># 向调用者输出“链接”对象时，是否检测它的空闲超时；  </span></span><br><span class="line"><span class="meta">redis.pool.testWhileIdle</span>=<span class="string">true  </span></span><br><span class="line"><span class="comment"># 对于“空闲链接”检测线程而言，每次检测的链接资源的个数。默认为3.  </span></span><br><span class="line"><span class="meta">redis.pool.numTestsPerEvictionRun</span>=<span class="string">50  </span></span><br><span class="line"><span class="comment"># redis 服务器的 IP    </span></span><br><span class="line"><span class="meta">redis.ip</span>=<span class="string">xxxxxx  </span></span><br><span class="line"><span class="comment"># redis 服务器的 Port    </span></span><br><span class="line"><span class="meta">redis1.port</span>=<span class="string">6379   </span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="Redis-案例"><a href="#Redis-案例" class="headerlink" title="Redis 案例"></a>Redis 案例</h2><h3 id="案例准备"><a href="#案例准备" class="headerlink" title="案例准备"></a>案例准备</h3><hr>
<p><strong><em>案例需求：</em></strong> 提供 index.html 页面，页面中有一个省份【下拉列表】。当页面加载完成后，发送 ajax 请求，加载所有省份。<br><strong><em>本案例所用资源下载：</em></strong> <a href="../gallery/Resources/Redis-Test.zip">案例资源下载（包含了代码部分）</a></p>
<hr>
<p><strong><em>第一步：</em></strong> 新建数据库和数据表。代码如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> RedisTest;    <span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">USE</span> RedisTest;                <span class="comment">-- 使用数据库</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> province(        <span class="comment">-- 创建表</span></span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">    <span class="keyword">NAME</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">    </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> province <span class="keyword">VALUES</span>(<span class="literal">NULL</span>,<span class="string">'北京'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> province <span class="keyword">VALUES</span>(<span class="literal">NULL</span>,<span class="string">'上海'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> province <span class="keyword">VALUES</span>(<span class="literal">NULL</span>,<span class="string">'广州'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> province <span class="keyword">VALUES</span>(<span class="literal">NULL</span>,<span class="string">'陕西'</span>);</span><br></pre></td></tr></table></figure>

<p><strong><em>第二步：</em></strong> 添加各种 jar 包到 lib 文件夹下<strong><em>【案例资源上面已经给了】</em></strong>。添加之后如下图：</p>
<p><img src="../gallery/Database/Redis/redis-038.png" alt=""></p>
<p><strong><em>第三步：</em></strong> 添加数据库配置文件 <code>druid.properties</code> 到 src 目录下，并完善包结构。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-039.png" alt=""></p>
<p><strong><em>第四步：</em></strong> 导入 js 文件到 web 目录下。如图所示：</p>
<p><img src="../gallery/Database/Redis/redis-040.png" alt=""></p>
<p><strong><em>第五步：</em></strong> 在 <code>utils 包</code> 下新建 <code>JDBCUtils</code> 和 <code>JedisPoolUtils</code> 两个工具类。对应代码如下：</p>
<figure class="highlight java"><figcaption><span>utils/JDBCUtils.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDBC工具类：使用 Durid 连接池</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DataSource ds ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1、加载配置文件</span></span><br><span class="line">            Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">            <span class="comment">// 使用 ClassLoader 加载配置文件，获取字节输入流</span></span><br><span class="line">            InputStream is = JDBCUtils.class.getClassLoader().getResourceAsStream("druid.properties");</span><br><span class="line">            properties.load(is);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2、初始化连接池对象</span></span><br><span class="line">            ds = DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接池对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DataSource <span class="title">getDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接 Connection 对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  ds.getConnection();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><figcaption><span>utils/JedisPoolUtils.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 22:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Jedis 连接池工具类，用于加载连接池的配置文件，降低程序的耦合性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisPoolUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义静态代码块，当这个类一加载，它就去读取连接池的配置文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// 1、读取配置文件</span></span><br><span class="line">        InputStream inputStream = JedisPoolUtils.class.getClassLoader().getResourceAsStream("jedis.properties");</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、创建 properties 对象</span></span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、关联连接池配置文件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            properties.load(inputStream);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、获取数据，设置到 JedisPoolConfig 中</span></span><br><span class="line">        JedisPoolConfig config = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        config.setMaxTotal(Integer.parseInt(properties.getProperty(<span class="string">"maxTotal"</span>)));</span><br><span class="line">        config.setMaxIdle(Integer.parseInt(properties.getProperty(<span class="string">"maxIdle"</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、初始化 jedisPool</span></span><br><span class="line">        jedisPool = <span class="keyword">new</span> JedisPool(config, properties.getProperty(<span class="string">"host"</span>), Integer.parseInt(properties.getProperty(<span class="string">"port"</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Jedis <span class="title">getJedis</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jedisPool.getResource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="案例编码"><a href="#案例编码" class="headerlink" title="案例编码"></a>案例编码</h3><hr>
<p><strong><em>第一步：</em></strong> 在 <strong><em>domain 包</em></strong> 下新建一个 <code>Province 类</code> ，和数据库 province 表相对应。代码如下：</p>
<figure class="highlight java"><figcaption><span>domain/Province.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> domain;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 23:33</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Province实体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Province</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>第二步：</em></strong> 在 <strong><em>dao 包</em></strong> 下新建一个 <code>ProvinceDao 接口</code> ，定义相关操作方法。代码如下：</p>
<figure class="highlight java"><figcaption><span>dao/ProvinceDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> domain.Province;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 23:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: ProvinceDao 接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProvinceDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有省份</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Province&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在 <strong><em>dao/impl 包</em></strong> 下新建 <code>ProvinceDaoImpl 实现类</code> ，用于实现 ProvinceDao 接口。代码如下：</p>
<figure class="highlight java"><figcaption><span>dao/impl/ProvinceDaoImpl.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> dao.ProvinceDao;</span><br><span class="line"><span class="keyword">import</span> domain.Province;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.BeanPropertyRowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> utils.JDBCUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 23:38</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: ProvinceDao 的实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProvinceDaoImpl</span> <span class="keyword">implements</span> <span class="title">ProvinceDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate template = <span class="keyword">new</span> JdbcTemplate(JDBCUtils.getDataSource());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Province&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、定义查询所有的 sql</span></span><br><span class="line">        String sql = <span class="string">"select * from province"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、执行 sql</span></span><br><span class="line">        List&lt;Province&gt; list = template.query(sql, <span class="keyword">new</span> BeanPropertyRowMapper&lt;&gt;(Province<span class="class">.<span class="keyword">class</span>))</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、返回 list 集合</span></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>第三步：</em></strong> 在 <strong><em>service 包</em></strong> 下新建一个 <code>ProvinceService 接口</code> ，定义相关操作方法。代码如下：</p>
<figure class="highlight java"><figcaption><span>service/ProvinceService.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> domain.Province;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 23:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: ProvinceService</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProvinceService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有，与 Redis 无关</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Province&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用 Redis 会用到这个方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">findAllJson</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在 <strong><em>service/impl 包</em></strong> 下新建 <code>ProvinceServiceImpl 实现类</code> ，用于实现 ProvinceService 接口。代码如下：</p>
<figure class="highlight java"><figcaption><span>service/impl/ProvinceServiceImpl.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> dao.ProvinceDao;</span><br><span class="line"><span class="keyword">import</span> dao.impl.ProvinceDaoImpl;</span><br><span class="line"><span class="keyword">import</span> domain.Province;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> service.ProvinceService;</span><br><span class="line"><span class="keyword">import</span> utils.JedisPoolUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 23:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: ProvinceService 实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProvinceServiceImpl</span> <span class="keyword">implements</span> <span class="title">ProvinceService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ProvinceDao dao = <span class="keyword">new</span> ProvinceDaoImpl();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Province&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dao.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用 Redis 作为缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回字符串类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">findAllJson</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1、获取连接</span></span><br><span class="line">        Jedis jedis = JedisPoolUtils.getJedis();</span><br><span class="line">        String province_json = jedis.get(<span class="string">"province"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、判断 province_json 是否为 null</span></span><br><span class="line">        <span class="keyword">if</span> (province_json == <span class="keyword">null</span> || province_json.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Redis 中没有数据，正在查询数据库……"</span>);</span><br><span class="line"></span><br><span class="line">            List&lt;Province&gt; list = dao.findAll();</span><br><span class="line">            ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                province_json = mapper.writeValueAsString(list);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            jedis.set(<span class="string">"province"</span>, province_json);</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"Redis 中有数据，正在查询缓存……"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、返回数据</span></span><br><span class="line">        <span class="keyword">return</span> province_json;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<p><strong><em>第四步：</em></strong> 在 <strong><em>web/servlet 包</em></strong> 下新建一个 <code>ProvinceServlet 类</code> ，用于 Ajax 请求和页面数据展示 。代码如下：</p>
<figure class="highlight java"><figcaption><span>web/servlet/ProvinceServlet.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> domain.Province;</span><br><span class="line"><span class="keyword">import</span> service.ProvinceService;</span><br><span class="line"><span class="keyword">import</span> service.impl.ProvinceServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 23:56</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Servlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/provinceServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProvinceServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、调用 service 查询</span></span><br><span class="line">        ProvinceService service = <span class="keyword">new</span> ProvinceServiceImpl();</span><br><span class="line">        List&lt;Province&gt; list = service.findAll();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、序列化 list 为 json 数据</span></span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String json = mapper.writeValueAsString(list);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、响应结果</span></span><br><span class="line">        System.out.println(json);</span><br><span class="line">        response.setContentType(<span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line">        response.getWriter().write(json);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着在 <strong><em>web</em></strong> 目录下新建 <code>index.html</code> 页面，代码如下：</p>
<figure class="highlight html"><figcaption><span>web/index.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/jquery-3.3.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">            $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="comment">// 发送 ajax 请求，加载所有省份数据</span></span></span><br><span class="line"><span class="javascript">                $.<span class="keyword">get</span>("provinceServlet", &#123;&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">                    <span class="comment">// 1、获取 select</span></span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> province = $(<span class="string">"#province"</span>);</span></span><br><span class="line"><span class="actionscript">                    <span class="comment">// 2、遍历 json 数组</span></span></span><br><span class="line"><span class="javascript">                    $(data).each(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">                        <span class="comment">// 3、创建 &lt;option&gt;</span></span></span><br><span class="line"><span class="actionscript">                        <span class="keyword">var</span> option = <span class="string">"&lt;option name='"</span> + <span class="keyword">this</span>.id + <span class="string">"'&gt;"</span> + <span class="keyword">this</span>.name + <span class="string">"&lt;/option&gt;"</span>;</span></span><br><span class="line"><span class="actionscript">                        <span class="comment">// 4、调用 select 的 append 追加 option</span></span></span><br><span class="line">                        province.append(option);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"province"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>---请选择省份---<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><em>第五步：</em></strong> 启动 tomcat 查看结果。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-041.png" alt=""><br><img src="../gallery/Database/Redis/redis-042.png" alt=""></p>
<h3 id="使用-Redis-作为缓存"><a href="#使用-Redis-作为缓存" class="headerlink" title="使用 Redis 作为缓存"></a>使用 Redis 作为缓存</h3><p>使用 Redis 可以减少数据库的交互，从而提高了效率。那么该如何操作呢？</p>
<hr>
<p><strong><em>第一步：</em></strong> 使用以下代码覆盖原先的 <code>ProvinceServlet 类</code> 。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> service.ProvinceService;</span><br><span class="line"><span class="keyword">import</span> service.impl.ProvinceServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/21 23:56</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Servlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/provinceServlet"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProvinceServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、调用 service 查询，这部分是与 Redis 相关的代码</span></span><br><span class="line">        ProvinceService service = <span class="keyword">new</span> ProvinceServiceImpl();</span><br><span class="line">        String json = service.findAllJson();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、响应结果</span></span><br><span class="line">        System.out.println(json);</span><br><span class="line">        response.setContentType(<span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line">        response.getWriter().write(json);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doPost(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>第二步：</em></strong> 启动 tomcat ，查看测试结果。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-045.png" alt="进入这个页面后，多刷新几次页面，方便在控制台看到输出"><br><img src="../gallery/Database/Redis/redis-043.png" alt=""><br><img src="../gallery/Database/Redis/redis-044.png" alt=""></p>
<blockquote>
<p><code>TIPS：</code> 到此为止，Redis 入门教程就结束了。接着往下看 <strong><em>Redis 进阶教程。</em></strong></p>
</blockquote>
<h1 id="Redis-进阶"><a href="#Redis-进阶" class="headerlink" title="Redis 进阶"></a>Redis 进阶</h1><h2 id="Redis-在-Linux-下的安装"><a href="#Redis-在-Linux-下的安装" class="headerlink" title="Redis 在 Linux 下的安装"></a>Redis 在 Linux 下的安装</h2><p><code>Redis 官方</code> <strong><em>更推荐我们在 Linux 下使用 Redis</em></strong> ，而不是在 windows 系统下，这样才更符合企业级的开发。现在就来介绍 <strong><em>Redis 在 Linux 下的安装。</em></strong></p>
<hr>
<p><code>第一步：</code> <strong><em>下载 Redis 的 Linux 版本。</em></strong> <a href="https://redis.io/download">下载地址</a> 如下图：</p>
<p><img src="../gallery/Database/Redis/redis-046.png" alt=""></p>
<p>当然，也可以 <strong><em>使用命令下载</em></strong> 。如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01-如果没有安装 wget ，那就使用下列命令安装。如果安装了，可跳过这一步</span></span><br><span class="line">yum install wget</span><br><span class="line"></span><br><span class="line"><span class="comment"># 02-下载 redis-6.0.6.tar.gz 压缩包。下面的这条命令官方有</span></span><br><span class="line">wget http://download.redis.io/releases/redis-6.0.6.tar.gz</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>解压 Redis 压缩包。</em></strong>【如果下载在 windows 系统了，还需要把压缩包上传到 Liunx 云服务器或者是虚拟机，这个自行解决，不难】解压缩的命令和结果如下图：</p>
<p><img src="../gallery/Database/Redis/redis-047.png" alt=""></p>
<p><code>第三步：</code> <strong><em>编译 Redis 。</em></strong> 需要用到如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01-安装 gcc 环境，如果安装过，可跳到 03 步骤【凡是涉及到安装的，都需要网络，没网络就完成不了了】</span></span><br><span class="line">yum install gcc-c++</span><br><span class="line"></span><br><span class="line"><span class="comment"># 02-检查 gcc 是否安装成功以及查看版本</span></span><br><span class="line">gcc -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 03-进入到刚刚解压出来的目录</span></span><br><span class="line"><span class="built_in">cd</span> redis-5.0.4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 04-使用 make 命令编译。需要点时间，大概 1~2 分钟</span></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"><span class="comment"># 05-进入到 src 目录</span></span><br><span class="line"><span class="built_in">cd</span> src</span><br><span class="line"></span><br><span class="line"><span class="comment"># 06-执行安装</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>TIPS：</code></p>
<p>在 make 命令执行完后 ， redis-5.0.4 目录下会出现编译后的 redis 服务程序 <code>redis-server</code> 和用于测试的客户端程序 <code>redis-cli</code> ，<strong><em>两个程序位于 <code>redis-5.0.4/src</code> 目录下。</em></strong></p>
</blockquote>
<p><img src="../gallery/Database/Redis/redis-048.png" alt=""><br><img src="../gallery/Database/Redis/redis-049.png" alt=""></p>
<p><code>第四步：</code> <strong><em>启动 Redis【不是后台启动，需要使用 <code>CTRL + C</code> 才能停止服务】。</em></strong> 需要用到如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01-进入到 src 目录</span></span><br><span class="line"><span class="built_in">cd</span> src</span><br><span class="line"></span><br><span class="line"><span class="comment"># 02-启动 Redis 服务端</span></span><br><span class="line">./redis-server ../redis.conf</span><br></pre></td></tr></table></figure>

<p><img src="../gallery/Database/Redis/redis-050.png" alt=""></p>
<p><code>第五步：</code> <strong><em>配置后台启动，并存一个数据。</em></strong> 需要用到如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01-编辑配置文件</span></span><br><span class="line">vi redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 02-找到 daemonize ，把它的值改为 yes ，然后保存退出</span></span><br><span class="line">daemonize yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 03-启动 Redis 服务端</span></span><br><span class="line">./redis-server ../redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 04-启动 Redis 客户端</span></span><br><span class="line">./redis-cli -p 6379</span><br></pre></td></tr></table></figure>

<p>对应的截图如下：</p>
<p><img src="../gallery/Database/Redis/redis-051.png" alt=""><br><img src="../gallery/Database/Redis/redis-052.png" alt=""></p>
<p><code>第六步：</code> <strong><em>查看 Redis 进程和关闭 Redis 。</em></strong> 需要用到如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01-查看 Redis 进程</span></span><br><span class="line">ps -ef|grep redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># 02-关闭 Redis 进程，不明白就看下列图片</span></span><br><span class="line">shutdown</span><br><span class="line"></span><br><span class="line"><span class="comment"># 03-退出 Redis ，不明白就看下列图片</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<p><img src="../gallery/Database/Redis/redis-053.png" alt=""></p>
<h2 id="Redis-性能测试"><a href="#Redis-性能测试" class="headerlink" title="Redis 性能测试"></a>Redis 性能测试</h2><p><code>redis-benchmark</code> 是一个官方自带的 <strong><em>性能测试工具</em></strong> ，与 <code>redis-server</code> 一样，<strong><em>都位于 Redis 的安装目录 src 下</em></strong> 。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-054.png" alt=""></p>
<p>这个性能测试工具有一些可选参数<strong><em>【来源于：<a href="https://www.runoob.com/redis/redis-benchmarks.html">菜鸟教程</a>】</em></strong> ，如下图：</p>
<p><img src="../gallery/Database/Redis/redis-055.png" alt=""></p>
<p>那么我们如何使用这个测试工具呢？我们又该如何使用这些可选参数呢？使用命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 01-进入到 Redis-server 所在目录，启动 Redis 服务端</span></span><br><span class="line">./redis-server ../redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 02-使用 redis-benchmark 测试 100 个并发连接 10 万个请求</span></span><br><span class="line">./redis-benchmark -h localhost -p 6379 -c 100 -n 100000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 03-如果还需要测试其他参数，请自行按照上述样式进行测试即可，这里就不作过多的测试了</span></span><br></pre></td></tr></table></figure>

<p>测试结果以及对结果的分析如下图：</p>
<p><img src="../gallery/Database/Redis/redis-056.png" alt="测试结果"><br><img src="../gallery/Database/Redis/redis-057.png" alt="对部分结果进行分析"></p>
<h1 id="三种特殊数据类型"><a href="#三种特殊数据类型" class="headerlink" title="三种特殊数据类型"></a>三种特殊数据类型</h1><h2 id="geospatial-地理位置"><a href="#geospatial-地理位置" class="headerlink" title="geospatial-地理位置"></a>geospatial-地理位置</h2><p>有没有想过，<strong><em>微信定位，附近的人，打车距离计算等功能</em></strong> 是如何实现的？用 <code>geospatial</code> 就可以实现。这种数据类型是 <strong><em>根据经纬度计算两地之间的距离 【直线距离，两个极点除外】</em></strong> 。</p>
<hr>
<p>那我们该如何去使用呢？先查询好经纬度：<a href="https://jingweidu.51240.com/">经纬度查询</a> ，然后进行各种操作。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-058.png" alt=""></p>
<blockquote>
<p><code>小提示：</code></p>
<p>我们至少需要两个点才能进行操作。越多越好。以下是我准备的几个城市的经纬度：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ 准备好的城市经纬度</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 北京：  经度： 116.23128      纬度： 40.22077</span></span><br><span class="line"><span class="addition">+ 上海：  经度： 121.48941      纬度： 31.40527</span></span><br><span class="line"><span class="addition">+ 佛山：  经度： 112.89262      纬度： 22.90026</span></span><br><span class="line"><span class="addition">+ 广州：  经度： 113.27324      纬度： 23.15792</span></span><br><span class="line"><span class="addition">+ 深圳：  经度： 113.88308      纬度： 22.55329</span></span><br><span class="line"><span class="addition">+ 成都：  经度： 104.10194      纬度： 30.65984</span></span><br><span class="line"><span class="addition">+ 重庆：  经度： 106.54041      纬度： 29.40268</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 准备好的城市经纬度</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong><em>有了上述的经纬度之后，我们就可以使用命令进行操作了。</em></strong> 其实手动添加数据是真的烦，如果要添加 1000 个城市甚至更多，那我们岂不是要累死了。所以，<strong><em>我们可以自己通过写 Java 程序，去读取一个相关的配置文件，然后把多个城市或者全国的城市的坐标添加进去。</em></strong>【这个就自己实现了哈！！！】接下来开始命令操作吧！！！</p>
<h3 id="GEOADD"><a href="#GEOADD" class="headerlink" title="GEOADD"></a>GEOADD</h3><p><strong><em>官方介绍：</em></strong> <code>GEOADD 命令</code> 将指定的地理空间位置 <code>（经度、纬度、名称）</code> 添加到指定的 key 中。<strong><em>这些数据将会存储到 sorted set【所以 geospatial 它的底层就是有序集合】</em></strong>。这样的目的是为了方便使用 <code>GEORADIUS</code> 或者 <code>GEORADIUSBYMEMBER</code> 命令对数据进行半径查询等操作。</p>
<blockquote>
<p><code>注意事项：</code></p>
<p>1、有效的经度 <strong><em>从 -180 度到 180 度</em></strong> 。<br>2、有效的纬度 <strong><em>从 -85.05112878 度到 85.05112878 度</em></strong> 。【所以两个极点是没有坐标的】<br>3、当坐标位置超出上述指定范围时，该命令将会返回一个错误。</p>
</blockquote>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ 使用 GEOADD 命令添加地理位置</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; geoadd ChinaCity 116.23 40.22 BeiJing</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; geoadd ChinaCity 121.48 31.41 ShangHai</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; geoadd ChinaCity 112.89 22.90 FoShan</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; geoadd ChinaCity 113.27 23.15 GuangZhou</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; geoadd ChinaCity 113.88 22.55 ShenZhen</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; geoadd ChinaCity 104.10 30.66 ChengDu</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; geoadd ChinaCity 106.54 29.40 ChongQing</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 使用 GEOADD 命令添加地理位置</span></span><br></pre></td></tr></table></figure>

<p>到这为止，添加操作完成了。【 <code>GEOADD 命令</code> 是不是挺简单的，哈哈】如下图：</p>
<p><img src="../gallery/Database/Redis/redis-059.png" alt=""></p>
<h3 id="GEOPOS"><a href="#GEOPOS" class="headerlink" title="GEOPOS"></a>GEOPOS</h3><p><strong><em>官方介绍：</em></strong> <code>GEOPOS 命令</code> <strong><em>从 key 里返回所有给定位置元素的位置（经度和纬度）。返回值：</em></strong> <code>GEOPOS 命令</code> 返回一个数组， 数组中的每个项都由两个元素组成： 第一个元素为给定位置元素的经度， 而第二个元素则为给定位置元素的纬度。当给定的位置元素不存在时， 对应的数组项为空值。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ GEOPOS 获取位置命令</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; geopos ChinaCity BeiJing</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; geopos ChinaCity ShangHai FoShan</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ GEOPOS 获取位置命令</span></span><br></pre></td></tr></table></figure>

<p>到这为止，获取操作完成了。【 <code>GEOPOS 命令</code> 是不是也挺简单的，哈哈】如下图：</p>
<p><img src="../gallery/Database/Redis/redis-060.png" alt=""></p>
<h3 id="GEODIST"><a href="#GEODIST" class="headerlink" title="GEODIST"></a>GEODIST</h3><p><strong><em>官方介绍：</em></strong> <code>GEODIST 命令</code> <strong><em>返回两个给定位置之间的距离。如果两个位置之间的其中一个不存在， 那么命令返回空值。</em></strong>指定的单位如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ 指定单位的参数 unit 必须是以下单位的其中一个：</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ m 表示单位为米。</span></span><br><span class="line"><span class="addition">+ km 表示单位为千米。</span></span><br><span class="line"><span class="addition">+ mi 表示单位为英里。</span></span><br><span class="line"><span class="addition">+ ft 表示单位为英尺。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 如果用户没有显式地指定单位参数， 那么 GEODIST 默认使用米作为单位。</span></span><br><span class="line"><span class="comment">+++ GEODIST 命令在计算距离时会假设地球为完美的球形， 在极限情况下， 这一假设最大会造成 0.5% 的误差。</span></span><br></pre></td></tr></table></figure>

<p><code>GEODIST 命令</code> 的具体操作如下图：</p>
<p><img src="../gallery/Database/Redis/redis-061.png" alt=""></p>
<h3 id="GEORADIUS"><a href="#GEORADIUS" class="headerlink" title="GEORADIUS"></a>GEORADIUS</h3><p><code>GEORADIUS 命令</code> <strong><em>以给定的经纬度为中心， 返回与中心的距离不超过给定最大距离的所有的位置元素</em></strong> 。详细介绍如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">+++ 范围可以使用以下其中一个单位：</span></span><br><span class="line"><span class="addition">+ m 表示单位为米。</span></span><br><span class="line"><span class="addition">+ km 表示单位为千米。</span></span><br><span class="line"><span class="addition">+ mi 表示单位为英里。</span></span><br><span class="line"><span class="addition">+ ft 表示单位为英尺。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 在给定以下可选项时， 命令会返回额外的信息：</span></span><br><span class="line"><span class="addition">+ WITHDIST:  在返回位置元素的同时， 将位置元素与中心之间的距离也一并返回。 距离的单位和用户给定的范围单位保持一致。</span></span><br><span class="line"><span class="addition">+ WITHCOORD: 将位置元素的经度和维度也一并返回。</span></span><br><span class="line"><span class="addition">+ WITHHASH:  以 52 位有符号整数的形式， 返回位置元素经过原始 geohash 编码的有序集合分值。 这个选项主要用于底层应用或者调试， 实际中的作用并不大。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 命令默认返回未排序的位置元素。 通过以下两个参数， 用户可以指定被返回位置元素的排序方式：</span></span><br><span class="line"><span class="addition">+ ASC:  根据中心的位置， 按照 从近到远 的方式返回位置元素。</span></span><br><span class="line"><span class="addition">+ DESC: 根据中心的位置， 按照 从远到近 的方式返回位置元素。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 该命令可以用于查找附近的人，通过半径查询，即圆形搜索。Over！！！</span></span><br></pre></td></tr></table></figure>

<p>在默认情况下， <code>GEORADIUS 命令</code> <strong><em>会返回所有匹配的位置元素</em></strong> 。 虽然用户可以使用 COUNT <count> 选项去获取前 N 个匹配元素， 但是因为命令在内部可能会需要对所有被匹配的元素进行处理， 所以在对一个非常大的区域进行搜索时， <strong><em>即使只使用 COUNT 选项去获取少量元素， 命令的执行速度也可能会非常慢。 但是从另一方面来说， 使用 COUNT 选项去减少需要返回的元素数量， 对于减少带宽来说仍然是非常有用的</em></strong> 。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ GEORADIUS</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; georadius ChinaCity 110 30 1000 km</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; georadius ChinaCity 110 30 1000 km withdist</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; georadius ChinaCity 110 30 1000 km withcoord</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; georadius ChinaCity 110 30 1000 km count 1</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; georadius ChinaCity 110 30 1000 km count 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ GEORADIUS 命令</span></span><br></pre></td></tr></table></figure>

<p>上述命令对应的结果如下图：</p>
<p><img src="../gallery/Database/Redis/redis-062.png" alt=""><br><img src="../gallery/Database/Redis/redis-063.png" alt=""></p>
<h3 id="GEORADIUSBYMEMBER"><a href="#GEORADIUSBYMEMBER" class="headerlink" title="GEORADIUSBYMEMBER"></a>GEORADIUSBYMEMBER</h3><p><code>GEORADIUSBYMEMBER 命令</code> 和 <strong><em>GEORADIUS 命令</em></strong> 一样， <strong><em>都可以找出位于指定范围内的元素</em></strong> 。 但是 <code>GEORADIUSBYMEMBER</code> 的中心点是由给定的位置元素决定的， <strong><em>而不是像 GEORADIUS 那样， 使用输入的经度和纬度来决定中心点。</em></strong>简而言之，<code>GEORADIUSBYMEMBER 命令</code> <strong><em>就是指定成员的位置被用作查询的中心。</em></strong></p>
<hr>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ GEORADIUSBYMEMBER 命令</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; georadiusbymember ChinaCity FoShan 1000 km</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; georadiusbymember ChinaCity FoShan 100 km</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ GEORADIUSBYMEMBER 命令</span></span><br></pre></td></tr></table></figure>

<hr>
<p>命令操作及结果如下图：</p>
<p><img src="../gallery/Database/Redis/redis-065.png" alt=""></p>
<h3 id="GEOHASH"><a href="#GEOHASH" class="headerlink" title="GEOHASH"></a>GEOHASH</h3><p><code>GEOHASH 命令</code> <strong><em>返回一个或多个位置元素的 Geohash 表示</em></strong> 。【了解一下】</p>
<p><img src="../gallery/Database/Redis/redis-066.png" alt="命令和结果"></p>
<h3 id="特别提示"><a href="#特别提示" class="headerlink" title="特别提示"></a>特别提示</h3><p>在 <code>GEOADD 命令</code> 中有这么一句话： <strong><em>这些数据将会存储到 sorted set</em></strong> ，由此可知，<strong><em>geospatial 类型的底层是</em></strong> <code>sorted set</code> ，所以我们可以使用有序集合的命令来操作 <strong><em>geospatial 类型</em></strong> 。具体操作如下图：</p>
<p><img src="../gallery/Database/Redis/redis-067.png" alt=""></p>
<h2 id="HyperLogLog-类型"><a href="#HyperLogLog-类型" class="headerlink" title="HyperLogLog 类型"></a>HyperLogLog 类型</h2><p><strong><em>官方介绍：</em></strong> <code>HyperLogLog</code> 是用来做基数统计的算法，它的的优点是：<strong><em>在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定 的、并且是很小的</em></strong>。在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。<strong><em>但是，因为 <code>HyperLogLog</code> 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 <code>HyperLogLog</code> 不能像集合那样，返回输入的各个元素。</em></strong></p>
<hr>
<p><strong><em>那么问题来了，什么是基数？</em></strong> 比如数据集 {1, 3, 5, 7, 5, 7, 8}， 那么这个数据集的基数集为 {1, 3, 5 ,7, 8}, 基数(不重复元素)为 5 。 基数估计就是在误差可接受的范围内，快速计算基数。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ HyperLogLog 应用场景</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 1、网站用户访问量（一个用户访问多次，但还是算作一个人）</span></span><br><span class="line"><span class="addition">+ 2、统计注册 IP 数</span></span><br><span class="line"><span class="addition">+ 3、统计每日访问 IP 数</span></span><br><span class="line"><span class="addition">+ 4、统计页面实时 UV 数</span></span><br><span class="line"><span class="addition">+ 5、统计在线用户数</span></span><br><span class="line"><span class="addition">+ 6、统计用户每天搜索不同词条的个数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ HyperLogLog 应用场景</span></span><br></pre></td></tr></table></figure>

<p><strong><em>HyperLogLog 类型</em></strong> 的命令只有三个，比较少。具体介绍如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ HyperLogLog 类型相关命令</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ PFADD key element [element ...]               添加指定元素到 HyperLogLog 中。</span></span><br><span class="line"><span class="addition">+ PFCOUNT key [key ...]                         返回给定 HyperLogLog 的基数估算值。</span></span><br><span class="line"><span class="addition">+ PFMERGE destkey sourcekey [sourcekey ...]     将多个 HyperLogLog 合并为一个 HyperLogLog</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ HyperLogLog 类型相关命令</span></span><br></pre></td></tr></table></figure>

<p><img src="../gallery/Database/Redis/redis-068.png" alt=""></p>
<blockquote>
<p><code>TIPS：</code> 如果允许容错，那么统计功能的实现建议使用 HyperLogLog 类型。</p>
</blockquote>
<h2 id="Bitmaps-位图"><a href="#Bitmaps-位图" class="headerlink" title="Bitmaps 位图"></a>Bitmaps 位图</h2><p><code>Bitmaps</code> 的底层是 <strong><em>字符串类型</em></strong>，所以它的命令是在 <strong><em>字符串类型命令</em></strong> 里面。其各种命令如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ Bitmaps 命令</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ SETBIT KEY_NAME OFFSET VALUE ：     Setbit 命令用于对 key 所储存的字符串值，设置或清除指定偏移量上的位(bit)。</span></span><br><span class="line"><span class="addition">+ GETBIT KEY_NAME OFFSET ：           Getbit 命令用于对 key 所储存的字符串值，获取指定偏移量上的位(bit)。</span></span><br><span class="line"><span class="addition">+ BITCOUNT KEY [start end] ：         Bitcount 命令用于获取 Bitmaps 指定范围值为 1 的个数。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ Bitmaps 命令</span></span><br></pre></td></tr></table></figure>

<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ Bitmaps 命令举例</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; setbit sign 1 0</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; setbit sign 2 1</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; setbit sign 3 0</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; setbit sign 4 1</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; setbit sign 5 0</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; setbit sign 6 1</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; setbit sign 7 0</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; getbit sign 4</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; bitcount sign</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ Bitmaps 命令举例</span></span><br></pre></td></tr></table></figure>

<p><img src="../gallery/Database/Redis/redis-069.png" alt=""></p>
<h1 id="Redis-事务"><a href="#Redis-事务" class="headerlink" title="Redis 事务"></a>Redis 事务</h1><h2 id="Redis-事务介绍"><a href="#Redis-事务介绍" class="headerlink" title="Redis 事务介绍"></a>Redis 事务介绍</h2><p><code>Redis 事务本质</code> <strong><em>是一组命令的集合！事务支持一次执行多个命令，一个事务中所有命令都会被序列化。</em></strong> 在事务执行过程中，会按照顺序串行化执行队列中的命令，其他客户端提交的命令请求不会插入到事务执行命令序列中。<strong><em>总结地说：</em></strong> Redis 事务就是 <code>一次性、顺序性、排他性</code> 的执行一个队列中的一系列命令。</p>
<hr>
<p><strong><em>Redis 事务没有隔离级别的概念：</em></strong> 批量操作在发送 EXEC 命令前被放入队列缓存，并不会被实际执行，也就不存在事务内的查询要看到事务里的更新，事务外查询不能看到。</p>
<hr>
<p><strong><em>Redis 不保证原子性：</em></strong> 单个 Redis 命令的执行是原子性的，但事务不保证原子性，且没有回滚。事务中任意命令执行失败，其余的命令仍会被执行。<strong><em>也就是说， Redis 没有在事务上增加任何维持原子性的机制，所以 Redis 事务的执行并不是原子性的。</em></strong></p>
<hr>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ Redis 事务的三个阶段【从开始到执行】</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 开始事务【multi】</span></span><br><span class="line"><span class="addition">+ 命令入队【……】</span></span><br><span class="line"><span class="addition">+ 执行事务【exec】</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ Redis 事务的三个阶段【从开始到执行】</span></span><br></pre></td></tr></table></figure>

<h2 id="Redis-事务相关命令"><a href="#Redis-事务相关命令" class="headerlink" title="Redis 事务相关命令"></a>Redis 事务相关命令</h2><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ Redis 事务相关命令</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ multi : 标记一个事务块的开始（ queued ）</span></span><br><span class="line"><span class="addition">+ exec : 执行所有事务块的命令（ 一旦执行 exec 后，之前加的监控锁都会被取消掉 ）　</span></span><br><span class="line"><span class="deletion">- discard : 取消事务，放弃事务块中的所有命令</span></span><br><span class="line"><span class="addition">+ watch key1 key2 ... : 监视一或多个 key ，如果在事务执行之前，被监视的 key 被其他命令改动，则事务被打断 （ 类似乐观锁 ）</span></span><br><span class="line"><span class="deletion">- unwatch : 取消 watch 对所有 key 的监控</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ Redis 事务相关命令</span></span><br></pre></td></tr></table></figure>

<p><img src="../gallery/Database/Redis/redis-070.png" alt=""></p>
<p><code>编译型异常：</code> 这个会导致提交失败。<strong><em>失败原因：命令错误或者语法错误。</em></strong> 如下图：</p>
<p><img src="../gallery/Database/Redis/redis-071.png" alt=""></p>
<p><code>运行时异常：</code> 事务提交能够成功。具体原因详见下方 <code>TIPS</code> 。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-072.png" alt=""></p>
<blockquote>
<p><code>TIPS：</code> 事务可以理解为一个打包的批量执行脚本，<strong><em>但批量指令并非原子化的操作，中间某条指令的失败不会导致前面已做指令的回滚</em></strong> ，也不会造成后续的指令不做。</p>
</blockquote>
<h2 id="Redis-实现乐观锁"><a href="#Redis-实现乐观锁" class="headerlink" title="Redis 实现乐观锁"></a>Redis 实现乐观锁</h2><p><code>乐观锁：</code> <strong><em>顾名思义，总是假设最好的情况，每次去拿数据的时候都认为别人不会修改，所以不会上锁。</em></strong> 但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号机制和CAS算法实现。乐观锁适用于多读的应用类型，这样可以提高吞吐量，像数据库提供的类似于write_condition机制，其实都是提供的乐观锁。在 Java 中 <code>java.util.concurrent.atomic</code> 包下面的原子变量类就是使用了乐观锁的一种实现方式CAS实现的。</p>
<hr>
<p><code>悲观锁：</code> <strong><em>总是假设最坏的情况，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会阻塞直到它拿到锁（共享资源每次只给一个线程使用，其它线程阻塞，用完后再把资源转让给其它线程）。</em></strong> 传统的关系型数据库里边就用到了很多这种锁机制，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁。<strong><em>Java 中 <code>synchronized</code> 和 <code>ReentrantLock</code> 等独占锁就是悲观锁思想的实现。</em></strong></p>
<hr>
<p><code>两种锁的使用场景：</code> 从上面对两种锁的介绍，我们知道两种锁各有优缺点，不可认为一种好于另一种，像乐观锁适用于写比较少的情况下（多读场景），即冲突真的很少发生的时候，这样可以省去了锁的开销，加大了系统的整个吞吐量。但如果是多写的情况，一般会经常产生冲突，这就会导致上层应用会不断的进行retry，这样反倒是降低了性能，所以一般多写的场景下用悲观锁就比较合适。</p>
<hr>
<p><strong><em>Redis 监视测试，</em></strong> 相关命令如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ Redis 监视测试</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; set money 1000</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; set spend 0</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; watch money</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; multi</span></span><br><span class="line"><span class="deletion">- 127.0.0.1:6379&gt; decrby money 200</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; incrby spend 200</span></span><br><span class="line"><span class="addition">+ 127.0.0.1:6379&gt; exec</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ Redis 监视测试</span></span><br></pre></td></tr></table></figure>

<p><strong><em>在这种单线程的操作下，结果没有出现问题【等会我们开多个线程，结果就不一样了，哈哈】。</em></strong> 如下图：</p>
<p><img src="../gallery/Database/Redis/redis-073.png" alt=""></p>
<p>接下来，我们需要再开启一条线程，即线程二。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-074.png" alt="线程一"><br><img src="../gallery/Database/Redis/redis-075.png" alt="线程二"></p>
<p>此时，我们的 <code>watch 命令</code> 就充当了 <strong><em>Redis 的乐观锁</em></strong> 操作。<strong><em>最终结果是线程一的事务提交失败。</em></strong> 结果如下图：</p>
<p><img src="../gallery/Database/Redis/redis-076.png" alt="线程二"></p>
<p><strong><em>那么我们该如何来解决这个问题嘞？</em></strong> <code>首先：</code> 如果发现事务提交失败，那么就先解除监控。<code>第二：</code> 既然修改失败，那就获取最新的值再次进行监控。<code>最后：</code> 执行相应的操作。 请看下图：</p>
<p><img src="../gallery/Database/Redis/redis-077.png" alt=""></p>
<h2 id="Spring-Boot-整合-Redis"><a href="#Spring-Boot-整合-Redis" class="headerlink" title="Spring Boot 整合 Redis"></a>Spring Boot 整合 Redis</h2><p><code>Spring Boot</code> 是未来的主流，所以使用它 <code>集成 Redis</code> 是非常有必要的。接下来就逐步介绍集成过程及其使用。<strong><em>【这部分的代码都安排好了，点击右侧即可下载： <a href="../gallery/Resources/SpringBoot-Redis.zip">代码资源下载</a>】</em></strong></p>
<hr>
<p><code>第一步：</code> <strong><em>创建 Spring Boot 项目。【这个就自行创建，这里不过多介绍了】</em></strong> 接着我们导入依赖如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span><span class="comment">&lt;!--netty--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p><code>注意事项：</code></p>
<p>1、<strong><em>在 Spring Boot 2.x 之后，原来使用的 Jedis 被替换成了 <code>lettuce</code> 。</em></strong><br>2、Jedis 采用直连方式连接，多个线程操作是不安全的。如需避免这种问题，就需要使用 Jedis 连接池技术。【类似 BIO 模式】<br>3、<strong><em>lettuce 的底层采用 <code>netty</code></em></strong> ，实例可以在多个线程中共享，所以不存在线程安全问题了。【类似 BIO 模式】</p>
</blockquote>
<hr>
<p><code>第二步：</code> <strong><em>编写我们的 <code>application.properties</code> 配置文件。</em></strong> 代码如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 由于当时 8080 端口被占用，所以就把端口设置为了 8082</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">8082</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 Redis 的主机</span></span><br><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 Redis 的端口号</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379</span></span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>编写我们的单元测试代码，并进行测试。</em></strong> 代码和测试结果如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/31 15:38</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">MyRedisApplicationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * RedisTemplate    模板的相关介绍</span></span><br><span class="line"><span class="comment">         * 1、opsForValue   用于操作 String</span></span><br><span class="line"><span class="comment">         * 2、opsForList    用于操作 List</span></span><br><span class="line"><span class="comment">         * 3、opsForset     用于操作 Set</span></span><br><span class="line"><span class="comment">         * ……</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">"Language"</span>, <span class="string">"Java"</span>);</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">"Language"</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>Redis 的测试结果</em></strong> 如下：</p>
<p><img src="../gallery/Database/Redis/redis-078.png" alt=""><br><img src="../gallery/Database/Redis/redis-079.png" alt=""></p>
<h2 id="自定义-redisTemplate"><a href="#自定义-redisTemplate" class="headerlink" title="自定义 redisTemplate"></a>自定义 redisTemplate</h2><p>由上图可知，<strong><em>我们存储的键乱码了。为什么呢？这个是序列化的问题。</em></strong> 先看下图：</p>
<p><img src="../gallery/Database/Redis/redis-080.png" alt=""><br><img src="../gallery/Database/Redis/redis-081.png" alt=""></p>
<p><strong><em>那我们如何来解决这个问题呢？</em></strong> 这个时候我们需要 <code>自定义 redisTemplate</code> ，这样便可解决序列化问题。<strong><em>先按下图把对应的包和类创建好，然后再开始编写我们自定义的类。</em></strong> 如下图：</p>
<p><img src="../gallery/Database/Redis/redis-082.png" alt=""></p>
<p><strong><em>接着我们在 guoshizhan 包下新建 <code>entity</code> 包，然后在 entity 包里新建 <code>User</code> 实体类。【还未实现序列化】</em></strong> 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/31 22:56</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: User 实体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, <span class="keyword">int</span> age, String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> + <span class="string">"name='"</span> + name + <span class="string">'\''</span> + <span class="string">", age="</span> + age + <span class="string">", address='"</span> + address + <span class="string">'\''</span> + <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><em>此时我们去编写一个测试方法，把这个方法放到 <code>MyRedisApplicationTest 类</code> 中。</em></strong> 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 开发中一般使用 json 来传递对象</span></span><br><span class="line">    User user = <span class="keyword">new</span> User(<span class="string">"Java"</span>, <span class="number">25</span>, <span class="string">"China"</span>);</span><br><span class="line">    String jsonUser = <span class="keyword">new</span> ObjectMapper().writeValueAsString(user);</span><br><span class="line">    redisTemplate.opsForValue().set(<span class="string">"user"</span>, jsonUser);</span><br><span class="line">    System.out.println(redisTemplate.opsForValue().get(<span class="string">"user"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试结果以及 <strong><em>后续的一点儿小改动</em></strong> 如下图：</p>
<p><img src="../gallery/Database/Redis/redis-083.png" alt=""><br><img src="../gallery/Database/Redis/redis-084.png" alt=""><br><img src="../gallery/Database/Redis/redis-085.png" alt=""></p>
<p>到这里为止，我们控制台输出的信息是不会乱码的，<strong><em>但是我们的 Redis 客户端却会出现乱码 。因为我们还使用的是系统默认的序列化方式，我们还没有自定义我们的 redisTemplate 。</em></strong> 所以，我们现在就来自定义我们的 redisTemplate 吧！！！</p>
<hr>
<p><code>第一步：</code> <strong><em>编写我们的 RedisConfig 类。</em></strong> 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonAutoDetect;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.PropertyAccessor;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/31 17:29</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: Redis 配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 编写我们自己的 redisTemplate 【代码来源于：RedisAutoConfiguration 类】</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line"></span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(factory);    <span class="comment">// 连接工厂</span></span><br><span class="line"></span><br><span class="line">        Jackson2JsonRedisSerializer serializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object<span class="class">.<span class="keyword">class</span>)</span>;    <span class="comment">// json 序列化配置</span></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        serializer.setObjectMapper(objectMapper);</span><br><span class="line"></span><br><span class="line">        StringRedisSerializer stringRedisSerializer = <span class="keyword">new</span> StringRedisSerializer();    <span class="comment">// String 的序列化</span></span><br><span class="line"></span><br><span class="line">        template.setKeySerializer(stringRedisSerializer);        <span class="comment">// key 采用 string 的序列化方式</span></span><br><span class="line">        template.setHashKeySerializer(stringRedisSerializer);    <span class="comment">// hash 的 key 采用 String 的序列化方式</span></span><br><span class="line">        template.setValueSerializer(serializer);                 <span class="comment">// value 序列化方式采用 jackson</span></span><br><span class="line">        template.setHashValueSerializer(serializer);             <span class="comment">// hash 的 value 序列化方式采用 jackson</span></span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><code>第二步：</code> <strong><em>编写我们的 MyRedisApplicationTest 类。</em></strong> 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/31 15:38</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">MyRedisApplicationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"redisTemplate"</span>)  <span class="comment">// 指定到我们自己编写的 redisTemplate</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 开发中一般使用 json 来传递对象</span></span><br><span class="line">        User user = <span class="keyword">new</span> User(<span class="string">"Java"</span>, <span class="number">25</span>, <span class="string">"China"</span>);</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">"user"</span>, user);</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">"user"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>点击测试方法进行测试</em></strong> 结果如下图：</p>
<p><img src="../gallery/Database/Redis/redis-086.png" alt=""><br><img src="../gallery/Database/Redis/redis-087.png" alt=""></p>
<h2 id="自定义-Redis-工具类"><a href="#自定义-Redis-工具类" class="headerlink" title="自定义 Redis 工具类"></a>自定义 Redis 工具类</h2><p><strong><em><code>我们发现</code> 使用系统默认的命令来操作 Redis 比较麻烦，我们想要自己定义一个 Redis 工具类来方便我们的操作。安排！！！</em></strong></p>
<hr>
<p><code>第一步：</code> <strong><em>我们在 guoshizhan 包下新建 <code>utils</code> 包，然后在 utils 包里新建 <code>RedisUtils</code> 工具类。</em></strong> 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/8/1 0:08</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 自定义 Redis 工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定缓存失效时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">expire</span><span class="params">(String key, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据key 获取过期时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 时间(秒) 返回0代表为永久有效</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getExpire</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断key是否存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 可以传一个值 或多个</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(String... key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key != <span class="keyword">null</span> &amp;&amp; key.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (key.length == <span class="number">1</span>) &#123;</span><br><span class="line">                redisTemplate.delete(key[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                redisTemplate.delete(CollectionUtils.arrayToList(key));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============================String=============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存获取</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key == <span class="keyword">null</span> ? <span class="keyword">null</span> : redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存放入</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存放入并设置时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒) time要大于0 如果time小于等于0 将设置无限期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false 失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                set(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递增</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">incr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"递增因子必须大于0"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递减</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">decr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"递减因子必须大于0"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, -delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ================================Map=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashGet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">hget</span><span class="params">(String key, String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().get(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取hashKey对应的所有键值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对应的多个键值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Object, Object&gt; <span class="title">hmget</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().entries(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map 对应多个键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false 失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet 并设置时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map  对应多个键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key, String item, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key, String item, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除hash表中的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 可以使多个 不能为null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hdel</span><span class="params">(String key, Object... item)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().delete(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断hash表中是否有该项的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hHasKey</span><span class="params">(String key, String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().hasKey(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash递增 如果不存在,就会创建一个 并把新增后的值返回</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   要增加几(大于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hincr</span><span class="params">(String key, String item, <span class="keyword">double</span> by)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash递减</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   要减少记(小于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hdecr</span><span class="params">(String key, String item, <span class="keyword">double</span> by)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, -by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============================set=============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据key获取Set中的所有值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title">sGet</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().members(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据value从一个set中查询,是否存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sHasKey</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().isMember(key, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将数据放入set缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSet</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().add(key, values);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将set数据放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time   时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSetAndTime</span><span class="params">(String key, <span class="keyword">long</span> time, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().add(key, values);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取set缓存的长度</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sGetSetSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除值为value的</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">setRemove</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().remove(key, values);</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ===============================list=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取list缓存的内容</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> start 开始</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end   结束 0 到 -1代表所有值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">lGet</span><span class="params">(String key, <span class="keyword">long</span> start, <span class="keyword">long</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().range(key, start, end);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取list缓存的长度</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lGetListSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过索引 获取list中的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 索引 index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">lGetIndex</span><span class="params">(String key, <span class="keyword">long</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().index(key, index);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, List&lt;Object&gt; value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, List&lt;Object&gt; value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据索引修改list中的某条数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lUpdateIndex</span><span class="params">(String key, <span class="keyword">long</span> index, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().set(key, index, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除N个值为value</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> count 移除多少个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lRemove</span><span class="params">(String key, <span class="keyword">long</span> count, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long remove = redisTemplate.opsForList().remove(key, count, value);</span><br><span class="line">            <span class="keyword">return</span> remove;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第二步：</code> <strong><em>编写我们的 MyRedisApplicationTest 类。</em></strong> 代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> club.guoshizhan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> club.guoshizhan.utils.RedisUtils;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: guoshizhan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span>: 2020/7/31 15:38</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 测试类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MyRedisApplicationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisUtils redisUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">redisUtilsTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        redisUtils.set(<span class="string">"name"</span>, <span class="string">"Java"</span>);</span><br><span class="line">        System.out.println(redisUtils.get(<span class="string">"name"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>第三步：</code> <strong><em>点击测试方法进行测试。</em></strong> 结果如下图：</p>
<p><img src="../gallery/Database/Redis/redis-088.png" alt=""><br><img src="../gallery/Database/Redis/redis-089.png" alt=""></p>
<h1 id="Redis-高级"><a href="#Redis-高级" class="headerlink" title="Redis 高级"></a>Redis 高级</h1><h2 id="Redis-配置文件详解-1"><a href="#Redis-配置文件详解-1" class="headerlink" title="Redis 配置文件详解"></a>Redis 配置文件详解</h2><p><code>内存配置：</code> <strong><em>当需要配置内存大小时，可以使用 1k, 5GB, 4M 等类似的格式进行配置。</em></strong> 其转换方式如下 <strong><em>【不区分大小写】</em></strong> ：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Note on units: when memory size is needed, it is possible to specify</span></span><br><span class="line"><span class="comment"># it in the usual form of 1k 5GB 4M and so forth:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 1k =&gt; 1000 bytes</span></span><br><span class="line"><span class="comment"># 1kb =&gt; 1024 bytes</span></span><br><span class="line"><span class="comment"># 1m =&gt; 1000000 bytes</span></span><br><span class="line"><span class="comment"># 1mb =&gt; 1024*1024 bytes</span></span><br><span class="line"><span class="comment"># 1g =&gt; 1000000000 bytes</span></span><br><span class="line"><span class="comment"># 1gb =&gt; 1024*1024*1024 bytes</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># units are case insensitive so 1GB 1Gb 1gB are all the same.（对大小写不敏感）</span></span><br></pre></td></tr></table></figure>

<p><code>文件引入：</code> <strong><em>引入其他的配置文件【做集群需要多个配置文件，这个时候此处就有用处了】。</em></strong> 具体配置如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################## INCLUDES ###################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Include one or more other config files here.  This is useful if you</span></span><br><span class="line"><span class="comment"># have a standard template that goes to all Redis servers but also need</span></span><br><span class="line"><span class="comment"># to customize a few per-server settings.  Include files can include</span></span><br><span class="line"><span class="comment"># other files, so use this wisely.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Notice option "include" won't be rewritten by command "CONFIG REWRITE"</span></span><br><span class="line"><span class="comment"># from admin or Redis Sentinel. Since Redis always uses the last processed</span></span><br><span class="line"><span class="comment"># line as value of a configuration directive, you'd better put includes</span></span><br><span class="line"><span class="comment"># at the beginning of this file to avoid overwriting config change at runtime.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If instead you are interested in using includes to override configuration</span></span><br><span class="line"><span class="comment"># options, it is better to use include as the last line.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># include /path/to/local.conf</span></span><br><span class="line"><span class="comment"># include /path/to/other.conf</span></span><br></pre></td></tr></table></figure>

<p><code>模块加载：</code> <strong><em>Redis 启动时加载哪些模块。</em></strong> 配置如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################## MODULES #####################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load modules at startup. If the server is not able to load modules</span></span><br><span class="line"><span class="comment"># it will abort. It is possible to use multiple loadmodule directives.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># loadmodule /path/to/my_module.so</span></span><br><span class="line"><span class="comment"># loadmodule /path/to/other_module.so</span></span><br></pre></td></tr></table></figure>

<p><code>网络配置：</code> <strong><em>配置 Redis 的主机、端口等等。</em></strong>。常用配置如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定 Redis 只能接受来自此 IP 绑定的网卡的请求，注意此默认值默认外网是不可访问的</span></span><br><span class="line"><span class="attr">bind</span> <span class="string">127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否开启保护模式。如果没有指定 bind 和密码，Redis 只会本地进行访问，拒绝外部访问。</span></span><br><span class="line"><span class="meta">protected-mode</span> <span class="string">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认端口，建议生产环境不要使用默认端口避免被恶意扫描到</span></span><br><span class="line"><span class="attr">port</span> <span class="string">6379</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># TCP 连接中已完成队列(完成三次握手之后)的长度</span></span><br><span class="line"><span class="meta">tcp-backlog</span> <span class="string">511</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 unix socket 来让 Redis 支持监听本地连接。【此项默认是被注释掉了的，只因介绍从而把它放开】</span></span><br><span class="line"><span class="attr">unixsocket</span> <span class="string">/tmp/redis.sock</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 unix socket 使用文件的权限。【此项默认是被注释掉了的，只因介绍从而把它放开】</span></span><br><span class="line"><span class="attr">unixsocketperm</span> <span class="string">700</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端连接空闲超过 timeout 将会被断开，为 0 则断开</span></span><br><span class="line"><span class="attr">timeout</span> <span class="string">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 tcp keepalive 参数</span></span><br><span class="line"><span class="meta">tcp-keepalive</span> <span class="string">300</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################## NETWORK #####################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># By default, if no "bind" configuration directive is specified, Redis listens</span></span><br><span class="line"><span class="comment"># for connections from all the network interfaces available on the server.</span></span><br><span class="line"><span class="comment"># It is possible to listen to just one or multiple selected interfaces using</span></span><br><span class="line"><span class="comment"># the "bind" configuration directive, followed by one or more IP addresses.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Examples:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># bind 192.168.1.100 10.0.0.1</span></span><br><span class="line"><span class="comment"># bind 127.0.0.1 ::1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ~~~ WARNING ~~~ If the computer running Redis is directly exposed to the</span></span><br><span class="line"><span class="comment"># internet, binding to all the interfaces is dangerous and will expose the</span></span><br><span class="line"><span class="comment"># instance to everybody on the internet. So by default we uncomment the</span></span><br><span class="line"><span class="comment"># following bind directive, that will force Redis to listen only into</span></span><br><span class="line"><span class="comment"># the IPv4 loopback interface address (this means Redis will be able to</span></span><br><span class="line"><span class="comment"># accept connections only from clients running into the same computer it</span></span><br><span class="line"><span class="comment"># is running).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES</span></span><br><span class="line"><span class="comment"># JUST COMMENT THE FOLLOWING LINE.</span></span><br><span class="line"><span class="comment"># ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span><br><span class="line"><span class="attr">bind</span> <span class="string">127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Protected mode is a layer of security protection, in order to avoid that</span></span><br><span class="line"><span class="comment"># Redis instances left open on the internet are accessed and exploited.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># When protected mode is on and if:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 1) The server is not binding explicitly to a set of addresses using the</span></span><br><span class="line"><span class="comment">#    "bind" directive.</span></span><br><span class="line"><span class="comment"># 2) No password is configured.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The server only accepts connections from clients connecting from the</span></span><br><span class="line"><span class="comment"># IPv4 and IPv6 loopback addresses 127.0.0.1 and ::1, and from Unix domain</span></span><br><span class="line"><span class="comment"># sockets.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># By default protected mode is enabled. You should disable it only if</span></span><br><span class="line"><span class="comment"># you are sure you want clients from other hosts to connect to Redis</span></span><br><span class="line"><span class="comment"># even if no authentication is configured, nor a specific set of interfaces</span></span><br><span class="line"><span class="comment"># are explicitly listed using the "bind" directive.</span></span><br><span class="line"><span class="meta">protected-mode</span> <span class="string">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Accept connections on the specified port, default is 6379 (IANA #815344).</span></span><br><span class="line"><span class="comment"># If port 0 is specified Redis will not listen on a TCP socket.</span></span><br><span class="line"><span class="attr">port</span> <span class="string">6379</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># TCP listen() backlog.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In high requests-per-second environments you need an high backlog in order</span></span><br><span class="line"><span class="comment"># to avoid slow clients connections issues. Note that the Linux kernel</span></span><br><span class="line"><span class="comment"># will silently truncate it to the value of /proc/sys/net/core/somaxconn so</span></span><br><span class="line"><span class="comment"># make sure to raise both the value of somaxconn and tcp_max_syn_backlog</span></span><br><span class="line"><span class="comment"># in order to get the desired effect.</span></span><br><span class="line"><span class="meta">tcp-backlog</span> <span class="string">511</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Unix socket.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Specify the path for the Unix socket that will be used to listen for</span></span><br><span class="line"><span class="comment"># incoming connections. There is no default, so Redis will not listen</span></span><br><span class="line"><span class="comment"># on a unix socket when not specified.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># unixsocket /tmp/redis.sock</span></span><br><span class="line"><span class="comment"># unixsocketperm 700</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Close the connection after a client is idle for N seconds (0 to disable)</span></span><br><span class="line"><span class="attr">timeout</span> <span class="string">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># TCP keepalive.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence</span></span><br><span class="line"><span class="comment"># of communication. This is useful for two reasons:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 1) Detect dead peers.</span></span><br><span class="line"><span class="comment"># 2) Take the connection alive from the point of view of network</span></span><br><span class="line"><span class="comment">#    equipment in the middle.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># On Linux, the specified value (in seconds) is the period used to send ACKs.</span></span><br><span class="line"><span class="comment"># Note that to close the connection the double of the time is needed.</span></span><br><span class="line"><span class="comment"># On other kernels the period depends on the kernel configuration.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># A reasonable value for this option is 300 seconds, which is the new</span></span><br><span class="line"><span class="comment"># Redis default starting with Redis 3.2.1.</span></span><br><span class="line"><span class="meta">tcp-keepalive</span> <span class="string">300</span></span><br></pre></td></tr></table></figure>

<p><code>通用配置：</code> <strong><em>这个是我们基本的配置项。能配置后台启动、日志级别等等。</em></strong> 配置如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 是否后台启动，默认是 no ，我们需要自己把它该为 yes</span></span><br><span class="line"><span class="attr">daemonize</span> <span class="string">no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以通过 upstart 和 systemd 来管理 Redis 的守护进程。选项如下：</span></span><br><span class="line"><span class="comment"># supervised no            - 没有监督互动</span></span><br><span class="line"><span class="comment"># supervised upstart       - 通过将 Redis 置于 SIGSTOP 式来启动信号</span></span><br><span class="line"><span class="comment"># supervised systemd       - signal systemd 将 READY = 1 写入 $ NOTIFY_SOCKET</span></span><br><span class="line"><span class="comment"># supervised auto          - 检测 upstart 或 systemd 方法基于 UPSTART_JOB 或 NOTIFY_SOCKET 环境变量</span></span><br><span class="line"><span class="attr">supervised</span> <span class="string">no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果以后台的方式运行 Redis ，我们需要指定一个 PID 文件</span></span><br><span class="line"><span class="attr">pidfile</span> <span class="string">/var/run/redis_6379.pid</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置日志级别，默认是 notice 。参数如下：</span></span><br><span class="line"><span class="comment"># debug</span></span><br><span class="line"><span class="comment"># verbose</span></span><br><span class="line"><span class="comment"># notice</span></span><br><span class="line"><span class="comment"># warning</span></span><br><span class="line"><span class="attr">loglevel</span> <span class="string">notice</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置日志文件的位置，就是把日志输出到哪一个文件</span></span><br><span class="line"><span class="attr">logfile</span> <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否打开记录 syslog 功能【此项默认是被注释掉了的，只因介绍从而把它放开】</span></span><br><span class="line"><span class="meta">syslog-enabled</span> <span class="string">no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># syslog 标识符。【此项默认是被注释掉了的，只因介绍从而把它放开】</span></span><br><span class="line"><span class="meta">syslog-ident</span> <span class="string">redis</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置日志的来源。【此项默认是被注释掉了的，只因介绍从而把它放开】</span></span><br><span class="line"><span class="meta">syslog-facility</span> <span class="string">local0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库的数量，默认值为 16 。默认使用的数据库是 DB 0，数据库范围在 0 -（database-1）之间</span></span><br><span class="line"><span class="comment"># 可以通过 SELECT 命令选择一个 db</span></span><br><span class="line"><span class="comment"># 集群环境默认只有 DB 0</span></span><br><span class="line"><span class="attr">databases</span> <span class="string">16</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否一直显示 logo ，就是启动 Redis 数据库有无那个立方体的图形显示</span></span><br><span class="line"><span class="meta">always-show-logo</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################# GENERAL #####################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># By default Redis does not run as a daemon. Use 'yes' if you need it.</span></span><br><span class="line"><span class="comment"># Note that Redis will write a pid file in /var/run/redis.pid when daemonized.</span></span><br><span class="line"><span class="attr">daemonize</span> <span class="string">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If you run Redis from upstart or systemd, Redis can interact with your</span></span><br><span class="line"><span class="comment"># supervision tree. Options:</span></span><br><span class="line"><span class="comment">#   supervised no      - no supervision interaction</span></span><br><span class="line"><span class="comment">#   supervised upstart - signal upstart by putting Redis into SIGSTOP mode</span></span><br><span class="line"><span class="comment">#   supervised systemd - signal systemd by writing READY=1 to $NOTIFY_SOCKET</span></span><br><span class="line"><span class="comment">#   supervised auto    - detect upstart or systemd method based on</span></span><br><span class="line"><span class="comment">#                        UPSTART_JOB or NOTIFY_SOCKET environment variables</span></span><br><span class="line"><span class="comment"># <span class="doctag">Note:</span> these supervision methods only signal "process is ready."</span></span><br><span class="line"><span class="comment">#       They do not enable continuous liveness pings back to your supervisor.</span></span><br><span class="line"><span class="attr">supervised</span> <span class="string">no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If a pid file is specified, Redis writes it where specified at startup</span></span><br><span class="line"><span class="comment"># and removes it at exit.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># When the server runs non daemonized, no pid file is created if none is</span></span><br><span class="line"><span class="comment"># specified in the configuration. When the server is daemonized, the pid file</span></span><br><span class="line"><span class="comment"># is used even if not specified, defaulting to "/var/run/redis.pid".</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Creating a pid file is best effort: if Redis is not able to create it</span></span><br><span class="line"><span class="comment"># nothing bad happens, the server will start and run normally.</span></span><br><span class="line"><span class="attr">pidfile</span> <span class="string">/var/run/redis_6379.pid</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify the server verbosity level.</span></span><br><span class="line"><span class="comment"># This can be one of:</span></span><br><span class="line"><span class="comment"># debug (a lot of information, useful for development/testing)</span></span><br><span class="line"><span class="comment"># verbose (many rarely useful info, but not a mess like the debug level)</span></span><br><span class="line"><span class="comment"># notice (moderately verbose, what you want in production probably)</span></span><br><span class="line"><span class="comment"># warning (only very important / critical messages are logged)</span></span><br><span class="line"><span class="attr">loglevel</span> <span class="string">notice</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify the log file name. Also the empty string can be used to force</span></span><br><span class="line"><span class="comment"># Redis to log on the standard output. Note that if you use standard</span></span><br><span class="line"><span class="comment"># output for logging but daemonize, logs will be sent to /dev/null</span></span><br><span class="line"><span class="attr">logfile</span> <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># To enable logging to the system logger, just set 'syslog-enabled' to yes,</span></span><br><span class="line"><span class="comment"># and optionally update the other syslog parameters to suit your needs.</span></span><br><span class="line"><span class="comment"># syslog-enabled no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify the syslog identity.</span></span><br><span class="line"><span class="comment"># syslog-ident redis</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7.</span></span><br><span class="line"><span class="comment"># syslog-facility local0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the number of databases. The default database is DB 0, you can select</span></span><br><span class="line"><span class="comment"># a different one on a per-connection basis using SELECT &lt;dbid&gt; where</span></span><br><span class="line"><span class="comment"># dbid is a number between 0 and 'databases'-1</span></span><br><span class="line"><span class="attr">databases</span> <span class="string">16</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># By default Redis shows an ASCII art logo only when started to log to the</span></span><br><span class="line"><span class="comment"># standard output and if the standard output is a TTY. Basically this means</span></span><br><span class="line"><span class="comment"># that normally a logo is displayed only in interactive sessions.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># However it is possible to force the pre-4.0 behavior and always show a</span></span><br><span class="line"><span class="comment"># ASCII art logo in startup logs by setting the following option to yes.</span></span><br><span class="line"><span class="meta">always-show-logo</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>

<p><code>快照配置：</code> <strong><em>与 Redis 的数据持久化 <code>RDB</code> 有关。【一定时间内执行了多少次，则会持久化到文件】</em></strong> 配置如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 保存数据到磁盘 【RDB 方式】 :</span></span><br><span class="line"><span class="comment"># after 900 sec (15 min) if at least 1 key changed    【15 分钟（900 秒）内至少有一个 key 发生变化就保存数据到磁盘】</span></span><br><span class="line"><span class="comment"># after 300 sec (5 min) if at least 10 keys changed   【5 分钟（300 秒）至少有 10 个 key 发生变化就保存数据到磁盘】</span></span><br><span class="line"><span class="comment"># after 60 sec if at least 10000 keys changed         【1 分钟（60 秒）至少有 10000 个 key 发生变化就保存数据到磁盘】</span></span><br><span class="line"></span><br><span class="line"><span class="attr">save</span> <span class="string">900 1</span></span><br><span class="line"><span class="attr">save</span> <span class="string">300 10</span></span><br><span class="line"><span class="attr">save</span> <span class="string">60 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 持久化出现错误后，是否依然进行继续进行工作</span></span><br><span class="line"><span class="meta">stop-writes-on-bgsave-error</span> <span class="string">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 存储至本地数据库时（持久化到 rdb 文件）是否压缩数据【这需要消耗一些 CPU 资源】，默认为 yes</span></span><br><span class="line"><span class="attr">rdbcompression</span> <span class="string">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否开启RC64校验，默认是 yes</span></span><br><span class="line"><span class="attr">rdbchecksum</span> <span class="string">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rdb 文件名称</span></span><br><span class="line"><span class="attr">dbfilename</span> <span class="string">dump.rdb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rdb 使用上面的 dbfilename 配置指令的文件名保存到这个目录</span></span><br><span class="line"><span class="attr">dir</span> <span class="string">./</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################ SNAPSHOTTING  ################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Save the DB on disk:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   save &lt;seconds&gt; &lt;changes&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Will save the DB if both the given number of seconds and the given</span></span><br><span class="line"><span class="comment">#   number of write operations against the DB occurred.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   In the example below the behaviour will be to save:</span></span><br><span class="line"><span class="comment">#   after 900 sec (15 min) if at least 1 key changed</span></span><br><span class="line"><span class="comment">#   after 300 sec (5 min) if at least 10 keys changed</span></span><br><span class="line"><span class="comment">#   after 60 sec if at least 10000 keys changed</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   <span class="doctag">Note:</span> you can disable saving completely by commenting out all "save" lines.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   It is also possible to remove all the previously configured save</span></span><br><span class="line"><span class="comment">#   points by adding a save directive with a single empty string argument</span></span><br><span class="line"><span class="comment">#   like in the following example:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   save ""</span></span><br><span class="line"></span><br><span class="line"><span class="attr">save</span> <span class="string">900 1</span></span><br><span class="line"><span class="attr">save</span> <span class="string">300 10</span></span><br><span class="line"><span class="attr">save</span> <span class="string">60 10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># By default Redis will stop accepting writes if RDB snapshots are enabled</span></span><br><span class="line"><span class="comment"># (at least one save point) and the latest background save failed.</span></span><br><span class="line"><span class="comment"># This will make the user aware (in a hard way) that data is not persisting</span></span><br><span class="line"><span class="comment"># on disk properly, otherwise chances are that no one will notice and some</span></span><br><span class="line"><span class="comment"># disaster will happen.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If the background saving process will start working again Redis will</span></span><br><span class="line"><span class="comment"># automatically allow writes again.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># However if you have setup your proper monitoring of the Redis server</span></span><br><span class="line"><span class="comment"># and persistence, you may want to disable this feature so that Redis will</span></span><br><span class="line"><span class="comment"># continue to work as usual even if there are problems with disk,</span></span><br><span class="line"><span class="comment"># permissions, and so forth.</span></span><br><span class="line"><span class="meta">stop-writes-on-bgsave-error</span> <span class="string">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Compress string objects using LZF when dump .rdb databases?</span></span><br><span class="line"><span class="comment"># For default that's set to 'yes' as it's almost always a win.</span></span><br><span class="line"><span class="comment"># If you want to save some CPU in the saving child set it to 'no' but</span></span><br><span class="line"><span class="comment"># the dataset will likely be bigger if you have compressible values or keys.</span></span><br><span class="line"><span class="attr">rdbcompression</span> <span class="string">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Since version 5 of RDB a CRC64 checksum is placed at the end of the file.</span></span><br><span class="line"><span class="comment"># This makes the format more resistant to corruption but there is a performance</span></span><br><span class="line"><span class="comment"># hit to pay (around 10%) when saving and loading RDB files, so you can disable it</span></span><br><span class="line"><span class="comment"># for maximum performances.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># RDB files created with checksum disabled have a checksum of zero that will</span></span><br><span class="line"><span class="comment"># tell the loading code to skip the check.</span></span><br><span class="line"><span class="attr">rdbchecksum</span> <span class="string">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The filename where to dump the DB</span></span><br><span class="line"><span class="attr">dbfilename</span> <span class="string">dump.rdb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The working directory.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The DB will be written inside this directory, with the filename specified</span></span><br><span class="line"><span class="comment"># above using the 'dbfilename' configuration directive.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The Append Only File will also be created inside this directory.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note that you must specify a directory here, not a file name.</span></span><br><span class="line"><span class="attr">dir</span> <span class="string">./</span></span><br></pre></td></tr></table></figure>

<p><code>主从复制：</code> <strong><em>主从复制配置。</em></strong> 配置如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定主节点。旧版本是：slaveof 。【此项默认是被注释掉了的，只因介绍从而把它放开】</span></span><br><span class="line"><span class="attr">replicaof</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># master 的密码。【此项默认是被注释掉了的，只因介绍从而把它放开】</span></span><br><span class="line"><span class="attr">masterauth</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当一个 slave 失去和 master 的连接，或者同步正在进行中，slave 的行为有两种可能：</span></span><br><span class="line"><span class="comment"># 如果 replica-serve-stale-data 设置为 “yes” (默认值)，slave 会继续响应客户端请求，可能是正常数据，也可能是还没获得值的空数据。</span></span><br><span class="line"><span class="comment"># 如果 replica-serve-stale-data 设置为 “no” ，slave 会回复"正在从 master 同步（SYNC with master in progress）" 来处理各种请求，除了 INFO 和 SLAVEOF 命令。</span></span><br><span class="line"><span class="meta">replica-serve-stale-data</span> <span class="string">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置从是否为只读，开启后从则不能写入数据，旧版本是：slave-read-only yes</span></span><br><span class="line"><span class="meta">replica-read-only</span> <span class="string">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同步策略: 磁盘或 socket，默认磁盘方式</span></span><br><span class="line"><span class="meta">repl-diskless-sync</span> <span class="string">no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果非磁盘同步方式开启，可以配置同步延迟时间，以等待 master 产生子进程通过 socket 传输 RDB 数据给 slave 。</span></span><br><span class="line"><span class="comment"># 默认值为 5 秒，设置为 0 秒则每次传输无延迟。</span></span><br><span class="line"><span class="meta">repl-diskless-sync-delay</span> <span class="string">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># slave 根据指定的时间间隔向 master 发送 ping 请求。默认 10 秒。【此项默认是被注释掉了的，只因介绍从而把它放开】</span></span><br><span class="line"><span class="meta">repl-ping-replica-period</span> <span class="string">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同步的超时时间：slave 在与 master SYNC 期间有大量数据传输，造成超时</span></span><br><span class="line"><span class="comment"># 在 slave 角度，master 超时，包括数据、ping 等</span></span><br><span class="line"><span class="comment"># 在 master 角度，slave 超时，当 master 发送 REPLCONF ACK pings ，确保这个值大于指定的 repl-ping-slave-period ，否则在主从间流量不高时每次都会检测到超时</span></span><br><span class="line"><span class="meta">repl-timeout</span> <span class="string">60</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否在 slave 套接字发送 SYNC 之后禁用 TCP_NODELAY</span></span><br><span class="line"><span class="comment"># 如果选择 yes，Redis 将使用更少的 TCP 包和带宽来向 slaves 发送数据。但是这将使数据传输到 slave 上有延迟，Linux 内核的默认配置会达到 40 毫秒。</span></span><br><span class="line"><span class="comment"># 如果选择 no ，数据传输到 salve 的延迟将会减少但要使用更多的带宽。</span></span><br><span class="line"><span class="comment"># 默认我们会为低延迟做优化，但高流量情况或主从之间的跳数过多时，可以设置为 “yes” 。</span></span><br><span class="line"><span class="meta">repl-disable-tcp-nodelay</span> <span class="string">no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置数据备份的 backlog 大小。同步的超时时间</span></span><br><span class="line"><span class="meta">repl-backlog-size</span> <span class="string">1mb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从最后一个 slave 断开开始计时多少秒后，backlog 缓冲将会释放。同步的超时时间</span></span><br><span class="line"><span class="meta">repl-backlog-ttl</span> <span class="string">3600</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 优先级</span></span><br><span class="line"><span class="meta">replica-priority</span> <span class="string">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果 master 少于 N 个延时小于等于M秒的已连接slave，就可以停止接收写操作。N 个 slave 需要是 “oneline” 状态。</span></span><br><span class="line"><span class="comment"># 延时是以秒为单位，并且必须小于等于指定值，是从最后一个从slave接收到的ping（通常每秒发送）开始计数。</span></span><br><span class="line"><span class="comment"># 该选项不保证N个slave正确同步写操作，但是限制数据丢失的窗口期。</span></span><br><span class="line"><span class="comment"># 例如至少需要3个延时小于等于10秒的slave用下面的指令：【此项默认是被注释掉了的，只因介绍从而把它放开】</span></span><br><span class="line"><span class="meta">min-replicas-to-write</span> <span class="string">3</span></span><br><span class="line"><span class="meta">min-replicas-max-lag</span> <span class="string">10</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################# REPLICATION #################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Master-Replica replication. Use replicaof to make a Redis instance a copy of</span></span><br><span class="line"><span class="comment"># another Redis server. A few things to understand ASAP about Redis replication.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   +------------------+      +---------------+</span></span><br><span class="line"><span class="comment">#   |      Master      | ---&gt; |    Replica    |</span></span><br><span class="line"><span class="comment">#   | (receive writes) |      |  (exact copy) |</span></span><br><span class="line"><span class="comment">#   +------------------+      +---------------+</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 1) Redis replication is asynchronous, but you can configure a master to</span></span><br><span class="line"><span class="comment">#    stop accepting writes if it appears to be not connected with at least</span></span><br><span class="line"><span class="comment">#    a given number of replicas.</span></span><br><span class="line"><span class="comment"># 2) Redis replicas are able to perform a partial resynchronization with the</span></span><br><span class="line"><span class="comment">#    master if the replication link is lost for a relatively small amount of</span></span><br><span class="line"><span class="comment">#    time. You may want to configure the replication backlog size (see the next</span></span><br><span class="line"><span class="comment">#    sections of this file) with a sensible value depending on your needs.</span></span><br><span class="line"><span class="comment"># 3) Replication is automatic and does not need user intervention. After a</span></span><br><span class="line"><span class="comment">#    network partition replicas automatically try to reconnect to masters</span></span><br><span class="line"><span class="comment">#    and resynchronize with them.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># replicaof &lt;masterip&gt; &lt;masterport&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If the master is password protected (using the "requirepass" configuration</span></span><br><span class="line"><span class="comment"># directive below) it is possible to tell the replica to authenticate before</span></span><br><span class="line"><span class="comment"># starting the replication synchronization process, otherwise the master will</span></span><br><span class="line"><span class="comment"># refuse the replica request.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># masterauth &lt;master-password&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># When a replica loses its connection with the master, or when the replication</span></span><br><span class="line"><span class="comment"># is still in progress, the replica can act in two different ways:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 1) if replica-serve-stale-data is set to 'yes' (the default) the replica will</span></span><br><span class="line"><span class="comment">#    still reply to client requests, possibly with out of date data, or the</span></span><br><span class="line"><span class="comment">#    data set may just be empty if this is the first synchronization.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 2) if replica-serve-stale-data is set to 'no' the replica will reply with</span></span><br><span class="line"><span class="comment">#    an error "SYNC with master in progress" to all the kind of commands</span></span><br><span class="line"><span class="comment">#    but to INFO, replicaOF, AUTH, PING, SHUTDOWN, REPLCONF, ROLE, CONFIG,</span></span><br><span class="line"><span class="comment">#    SUBSCRIBE, UNSUBSCRIBE, PSUBSCRIBE, PUNSUBSCRIBE, PUBLISH, PUBSUB,</span></span><br><span class="line"><span class="comment">#    COMMAND, POST, HOST: and LATENCY.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="meta">replica-serve-stale-data</span> <span class="string">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># You can configure a replica instance to accept writes or not. Writing against</span></span><br><span class="line"><span class="comment"># a replica instance may be useful to store some ephemeral data (because data</span></span><br><span class="line"><span class="comment"># written on a replica will be easily deleted after resync with the master) but</span></span><br><span class="line"><span class="comment"># may also cause problems if clients are writing to it because of a</span></span><br><span class="line"><span class="comment"># misconfiguration.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Since Redis 2.6 by default replicas are read-only.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># <span class="doctag">Note:</span> read only replicas are not designed to be exposed to untrusted clients</span></span><br><span class="line"><span class="comment"># on the internet. It's just a protection layer against misuse of the instance.</span></span><br><span class="line"><span class="comment"># Still a read only replica exports by default all the administrative commands</span></span><br><span class="line"><span class="comment"># such as CONFIG, DEBUG, and so forth. To a limited extent you can improve</span></span><br><span class="line"><span class="comment"># security of read only replicas using 'rename-command' to shadow all the</span></span><br><span class="line"><span class="comment"># administrative / dangerous commands.</span></span><br><span class="line"><span class="meta">replica-read-only</span> <span class="string">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Replication SYNC strategy: disk or socket.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># -------------------------------------------------------</span></span><br><span class="line"><span class="comment"># WARNING: DISKLESS REPLICATION IS EXPERIMENTAL CURRENTLY</span></span><br><span class="line"><span class="comment"># -------------------------------------------------------</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># New replicas and reconnecting replicas that are not able to continue the replication</span></span><br><span class="line"><span class="comment"># process just receiving differences, need to do what is called a "full</span></span><br><span class="line"><span class="comment"># synchronization". An RDB file is transmitted from the master to the replicas.</span></span><br><span class="line"><span class="comment"># The transmission can happen in two different ways:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 1) Disk-backed: The Redis master creates a new process that writes the RDB</span></span><br><span class="line"><span class="comment">#                 file on disk. Later the file is transferred by the parent</span></span><br><span class="line"><span class="comment">#                 process to the replicas incrementally.</span></span><br><span class="line"><span class="comment"># 2) Diskless: The Redis master creates a new process that directly writes the</span></span><br><span class="line"><span class="comment">#              RDB file to replica sockets, without touching the disk at all.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># With disk-backed replication, while the RDB file is generated, more replicas</span></span><br><span class="line"><span class="comment"># can be queued and served with the RDB file as soon as the current child producing</span></span><br><span class="line"><span class="comment"># the RDB file finishes its work. With diskless replication instead once</span></span><br><span class="line"><span class="comment"># the transfer starts, new replicas arriving will be queued and a new transfer</span></span><br><span class="line"><span class="comment"># will start when the current one terminates.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># When diskless replication is used, the master waits a configurable amount of</span></span><br><span class="line"><span class="comment"># time (in seconds) before starting the transfer in the hope that multiple replicas</span></span><br><span class="line"><span class="comment"># will arrive and the transfer can be parallelized.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># With slow disks and fast (large bandwidth) networks, diskless replication</span></span><br><span class="line"><span class="comment"># works better.</span></span><br><span class="line"><span class="meta">repl-diskless-sync</span> <span class="string">no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># When diskless replication is enabled, it is possible to configure the delay</span></span><br><span class="line"><span class="comment"># the server waits in order to spawn the child that transfers the RDB via socket</span></span><br><span class="line"><span class="comment"># to the replicas.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This is important since once the transfer starts, it is not possible to serve</span></span><br><span class="line"><span class="comment"># new replicas arriving, that will be queued for the next RDB transfer, so the server</span></span><br><span class="line"><span class="comment"># waits a delay in order to let more replicas arrive.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The delay is specified in seconds, and by default is 5 seconds. To disable</span></span><br><span class="line"><span class="comment"># it entirely just set it to 0 seconds and the transfer will start ASAP.</span></span><br><span class="line"><span class="meta">repl-diskless-sync-delay</span> <span class="string">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Replicas send PINGs to server in a predefined interval. It's possible to change</span></span><br><span class="line"><span class="comment"># this interval with the repl_ping_replica_period option. The default value is 10</span></span><br><span class="line"><span class="comment"># seconds.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># repl-ping-replica-period 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The following option sets the replication timeout for:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 1) Bulk transfer I/O during SYNC, from the point of view of replica.</span></span><br><span class="line"><span class="comment"># 2) Master timeout from the point of view of replicas (data, pings).</span></span><br><span class="line"><span class="comment"># 3) Replica timeout from the point of view of masters (REPLCONF ACK pings).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># It is important to make sure that this value is greater than the value</span></span><br><span class="line"><span class="comment"># specified for repl-ping-replica-period otherwise a timeout will be detected</span></span><br><span class="line"><span class="comment"># every time there is low traffic between the master and the replica.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># repl-timeout 60</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable TCP_NODELAY on the replica socket after SYNC?</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If you select "yes" Redis will use a smaller number of TCP packets and</span></span><br><span class="line"><span class="comment"># less bandwidth to send data to replicas. But this can add a delay for</span></span><br><span class="line"><span class="comment"># the data to appear on the replica side, up to 40 milliseconds with</span></span><br><span class="line"><span class="comment"># Linux kernels using a default configuration.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If you select "no" the delay for data to appear on the replica side will</span></span><br><span class="line"><span class="comment"># be reduced but more bandwidth will be used for replication.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># By default we optimize for low latency, but in very high traffic conditions</span></span><br><span class="line"><span class="comment"># or when the master and replicas are many hops away, turning this to "yes" may</span></span><br><span class="line"><span class="comment"># be a good idea.</span></span><br><span class="line"><span class="meta">repl-disable-tcp-nodelay</span> <span class="string">no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the replication backlog size. The backlog is a buffer that accumulates</span></span><br><span class="line"><span class="comment"># replica data when replicas are disconnected for some time, so that when a replica</span></span><br><span class="line"><span class="comment"># wants to reconnect again, often a full resync is not needed, but a partial</span></span><br><span class="line"><span class="comment"># resync is enough, just passing the portion of data the replica missed while</span></span><br><span class="line"><span class="comment"># disconnected.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The bigger the replication backlog, the longer the time the replica can be</span></span><br><span class="line"><span class="comment"># disconnected and later be able to perform a partial resynchronization.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The backlog is only allocated once there is at least a replica connected.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># repl-backlog-size 1mb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># After a master has no longer connected replicas for some time, the backlog</span></span><br><span class="line"><span class="comment"># will be freed. The following option configures the amount of seconds that</span></span><br><span class="line"><span class="comment"># need to elapse, starting from the time the last replica disconnected, for</span></span><br><span class="line"><span class="comment"># the backlog buffer to be freed.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note that replicas never free the backlog for timeout, since they may be</span></span><br><span class="line"><span class="comment"># promoted to masters later, and should be able to correctly "partially</span></span><br><span class="line"><span class="comment"># resynchronize" with the replicas: hence they should always accumulate backlog.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># A value of 0 means to never release the backlog.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># repl-backlog-ttl 3600</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The replica priority is an integer number published by Redis in the INFO output.</span></span><br><span class="line"><span class="comment"># It is used by Redis Sentinel in order to select a replica to promote into a</span></span><br><span class="line"><span class="comment"># master if the master is no longer working correctly.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># A replica with a low priority number is considered better for promotion, so</span></span><br><span class="line"><span class="comment"># for instance if there are three replicas with priority 10, 100, 25 Sentinel will</span></span><br><span class="line"><span class="comment"># pick the one with priority 10, that is the lowest.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># However a special priority of 0 marks the replica as not able to perform the</span></span><br><span class="line"><span class="comment"># role of master, so a replica with priority of 0 will never be selected by</span></span><br><span class="line"><span class="comment"># Redis Sentinel for promotion.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># By default the priority is 100.</span></span><br><span class="line"><span class="meta">replica-priority</span> <span class="string">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># It is possible for a master to stop accepting writes if there are less than</span></span><br><span class="line"><span class="comment"># N replicas connected, having a lag less or equal than M seconds.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The N replicas need to be in "online" state.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The lag in seconds, that must be &lt;= the specified value, is calculated from</span></span><br><span class="line"><span class="comment"># the last ping received from the replica, that is usually sent every second.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This option does not GUARANTEE that N replicas will accept the write, but</span></span><br><span class="line"><span class="comment"># will limit the window of exposure for lost writes in case not enough replicas</span></span><br><span class="line"><span class="comment"># are available, to the specified number of seconds.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For example to require at least 3 replicas with a lag &lt;= 10 seconds use:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># min-replicas-to-write 3</span></span><br><span class="line"><span class="comment"># min-replicas-max-lag 10</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Setting one or the other to 0 disables the feature.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># By default min-replicas-to-write is set to 0 (feature disabled) and</span></span><br><span class="line"><span class="comment"># min-replicas-max-lag is set to 10.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># A Redis master is able to list the address and port of the attached</span></span><br><span class="line"><span class="comment"># replicas in different ways. For example the "INFO replication" section</span></span><br><span class="line"><span class="comment"># offers this information, which is used, among other tools, by</span></span><br><span class="line"><span class="comment"># Redis Sentinel in order to discover replica instances.</span></span><br><span class="line"><span class="comment"># Another place where this info is available is in the output of the</span></span><br><span class="line"><span class="comment"># "ROLE" command of a master.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The listed IP and address normally reported by a replica is obtained</span></span><br><span class="line"><span class="comment"># in the following way:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   IP: The address is auto detected by checking the peer address</span></span><br><span class="line"><span class="comment">#   of the socket used by the replica to connect with the master.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Port: The port is communicated by the replica during the replication</span></span><br><span class="line"><span class="comment">#   handshake, and is normally the port that the replica is using to</span></span><br><span class="line"><span class="comment">#   listen for connections.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># However when port forwarding or Network Address Translation (NAT) is</span></span><br><span class="line"><span class="comment"># used, the replica may be actually reachable via different IP and port</span></span><br><span class="line"><span class="comment"># pairs. The following two options can be used by a replica in order to</span></span><br><span class="line"><span class="comment"># report to its master a specific set of IP and port, so that both INFO</span></span><br><span class="line"><span class="comment"># and ROLE will report those values.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># There is no need to use both the options if you need to override just</span></span><br><span class="line"><span class="comment"># the port or the IP address.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># replica-announce-ip 5.5.5.5</span></span><br><span class="line"><span class="comment"># replica-announce-port 1234</span></span><br></pre></td></tr></table></figure>

<p><code>安全设置：</code> <strong><em>可在此处设置 Redis 的密码。</em></strong>配置如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置密码。举个例子： requirepass 123456 。【此项默认是被注释掉了的，只因介绍从而把它放开】</span></span><br><span class="line"><span class="attr">requirepass</span> <span class="string">foobared</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#命令重命名。设置命令为空时禁用命令。【此项默认是被注释掉了的，只因介绍从而把它放开】</span></span><br><span class="line"><span class="meta">rename-command</span> <span class="string">CONFIG ""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 Redis 客户端查看是否有密码以及设置密码等</span></span><br><span class="line"><span class="comment"># 查看是否有密码</span></span><br><span class="line"><span class="attr">config</span> <span class="string">get requirepass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置密码</span></span><br><span class="line"><span class="attr">config</span> <span class="string">set requirepass "123456"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登陆验证密码</span></span><br><span class="line"><span class="attr">auth</span> <span class="string">123456</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################## SECURITY ###################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Require clients to issue AUTH &lt;PASSWORD&gt; before processing any other</span></span><br><span class="line"><span class="comment"># commands.  This might be useful in environments in which you do not trust</span></span><br><span class="line"><span class="comment"># others with access to the host running redis-server.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This should stay commented out for backward compatibility and because most</span></span><br><span class="line"><span class="comment"># people do not need auth (e.g. they run their own servers).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Warning: since Redis is pretty fast an outside user can try up to</span></span><br><span class="line"><span class="comment"># 150k passwords per second against a good box. This means that you should</span></span><br><span class="line"><span class="comment"># use a very strong password otherwise it will be very easy to break.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># requirepass foobared</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Command renaming.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># It is possible to change the name of dangerous commands in a shared</span></span><br><span class="line"><span class="comment"># environment. For instance the CONFIG command may be renamed into something</span></span><br><span class="line"><span class="comment"># hard to guess so that it will still be available for internal-use tools</span></span><br><span class="line"><span class="comment"># but not available for general clients.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Example:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># It is also possible to completely kill a command by renaming it into</span></span><br><span class="line"><span class="comment"># an empty string:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># rename-command CONFIG ""</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Please note that changing the name of commands that are logged into the</span></span><br><span class="line"><span class="comment"># AOF file or transmitted to replicas may cause problems.</span></span><br></pre></td></tr></table></figure>

<p><code>客户端设置：</code> <strong><em>设置能同时连接到 Redis 的最大客户端的数量。</em></strong> 配置如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################### CLIENTS ####################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the max number of connected clients at the same time. By default</span></span><br><span class="line"><span class="comment"># this limit is set to 10000 clients, however if the Redis server is not</span></span><br><span class="line"><span class="comment"># able to configure the process file limit to allow for the specified limit</span></span><br><span class="line"><span class="comment"># the max number of allowed clients is set to the current file limit</span></span><br><span class="line"><span class="comment"># minus 32 (as Redis reserves a few file descriptors for internal uses).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Once the limit is reached Redis will close all the new connections sending</span></span><br><span class="line"><span class="comment"># an error 'max number of clients reached'.</span></span><br><span class="line"><span class="comment"># 设置能同时连接到 Redis 的最大客户端的数量</span></span><br><span class="line"><span class="comment"># maxclients 10000</span></span><br></pre></td></tr></table></figure>

<p><code>内存限制：</code> <strong>*  *</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 内存限制：能够配置最大内存容量【此项默认是被注释掉了的，只因介绍从而把它放开】</span></span><br><span class="line"><span class="attr">maxmemory</span> <span class="string">&lt;bytes&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果达到上方最大的内存限制，Redis 如何选择删除 key</span></span><br><span class="line"><span class="comment"># volatile-lru     -&gt;   根据 LRU 算法删除设置过期时间的 key</span></span><br><span class="line"><span class="comment"># allkeys-lru      -&gt;   根据 LRU 算法删除任何 key</span></span><br><span class="line"><span class="comment"># volatile-random  -&gt;   随机移除设置过过期时间的 key</span></span><br><span class="line"><span class="comment"># allkeys-random   -&gt;   随机移除任何 key</span></span><br><span class="line"><span class="comment"># volatile-ttl     -&gt;   移除即将过期的 key(minor TTL)</span></span><br><span class="line"><span class="comment"># noeviction       -&gt;   不移除任何 key，只返回一个写错误</span></span><br><span class="line"><span class="comment"># 注意：对所有策略来说，如果 Redis 找不到合适的可以删除的 key 都会在写操作时返回一个错误。</span></span><br><span class="line"><span class="comment"># 目前为止涉及的命令：set setnx setex append incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby getset mset msetnx exec sort</span></span><br><span class="line"><span class="meta">maxmemory-policy</span> <span class="string">noeviction</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># LRU 和最小 TTL 算法的样本个数【此项默认是被注释掉了的，只因介绍从而把它放开】</span></span><br><span class="line"><span class="meta">maxmemory-samples</span> <span class="string">5</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">############################## MEMORY MANAGEMENT ################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set a memory usage limit to the specified amount of bytes.</span></span><br><span class="line"><span class="comment"># When the memory limit is reached Redis will try to remove keys</span></span><br><span class="line"><span class="comment"># according to the eviction policy selected (see maxmemory-policy).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If Redis can't remove keys according to the policy, or if the policy is</span></span><br><span class="line"><span class="comment"># set to 'noeviction', Redis will start to reply with errors to commands</span></span><br><span class="line"><span class="comment"># that would use more memory, like SET, LPUSH, and so on, and will continue</span></span><br><span class="line"><span class="comment"># to reply to read-only commands like GET.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This option is usually useful when using Redis as an LRU or LFU cache, or to</span></span><br><span class="line"><span class="comment"># set a hard memory limit for an instance (using the 'noeviction' policy).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># WARNING: If you have replicas attached to an instance with maxmemory on,</span></span><br><span class="line"><span class="comment"># the size of the output buffers needed to feed the replicas are subtracted</span></span><br><span class="line"><span class="comment"># from the used memory count, so that network problems / resyncs will</span></span><br><span class="line"><span class="comment"># not trigger a loop where keys are evicted, and in turn the output</span></span><br><span class="line"><span class="comment"># buffer of replicas is full with DELs of keys evicted triggering the deletion</span></span><br><span class="line"><span class="comment"># of more keys, and so forth until the database is completely emptied.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In short... if you have replicas attached it is suggested that you set a lower</span></span><br><span class="line"><span class="comment"># limit for maxmemory so that there is some free RAM on the system for replica</span></span><br><span class="line"><span class="comment"># output buffers (but this is not needed if the policy is 'noeviction').</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># maxmemory &lt;bytes&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MAXMEMORY POLICY: how Redis will select what to remove when maxmemory</span></span><br><span class="line"><span class="comment"># is reached. You can select among five behaviors:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># volatile-lru -&gt; Evict using approximated LRU among the keys with an expire set.</span></span><br><span class="line"><span class="comment"># allkeys-lru -&gt; Evict any key using approximated LRU.</span></span><br><span class="line"><span class="comment"># volatile-lfu -&gt; Evict using approximated LFU among the keys with an expire set.</span></span><br><span class="line"><span class="comment"># allkeys-lfu -&gt; Evict any key using approximated LFU.</span></span><br><span class="line"><span class="comment"># volatile-random -&gt; Remove a random key among the ones with an expire set.</span></span><br><span class="line"><span class="comment"># allkeys-random -&gt; Remove a random key, any key.</span></span><br><span class="line"><span class="comment"># volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL)</span></span><br><span class="line"><span class="comment"># noeviction -&gt; Don't evict anything, just return an error on write operations.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># LRU means Least Recently Used</span></span><br><span class="line"><span class="comment"># LFU means Least Frequently Used</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Both LRU, LFU and volatile-ttl are implemented using approximated</span></span><br><span class="line"><span class="comment"># randomized algorithms.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># <span class="doctag">Note:</span> with any of the above policies, Redis will return an error on write</span></span><br><span class="line"><span class="comment">#       operations, when there are no suitable keys for eviction.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#       At the date of writing these commands are: set setnx setex append</span></span><br><span class="line"><span class="comment">#       incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span></span><br><span class="line"><span class="comment">#       sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span></span><br><span class="line"><span class="comment">#       zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span></span><br><span class="line"><span class="comment">#       getset mset msetnx exec sort</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The default is:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># maxmemory-policy noeviction</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated</span></span><br><span class="line"><span class="comment"># algorithms (in order to save memory), so you can tune it for speed or</span></span><br><span class="line"><span class="comment"># accuracy. For default Redis will check five keys and pick the one that was</span></span><br><span class="line"><span class="comment"># used less recently, you can change the sample size using the following</span></span><br><span class="line"><span class="comment"># configuration directive.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The default of 5 produces good enough results. 10 Approximates very closely</span></span><br><span class="line"><span class="comment"># true LRU but costs more CPU. 3 is faster but not very accurate.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># maxmemory-samples 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Starting from Redis 5, by default a replica will ignore its maxmemory setting</span></span><br><span class="line"><span class="comment"># (unless it is promoted to master after a failover or manually). It means</span></span><br><span class="line"><span class="comment"># that the eviction of keys will be just handled by the master, sending the</span></span><br><span class="line"><span class="comment"># DEL commands to the replica as keys evict in the master side.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This behavior ensures that masters and replicas stay consistent, and is usually</span></span><br><span class="line"><span class="comment"># what you want, however if your replica is writable, or you want the replica to have</span></span><br><span class="line"><span class="comment"># a different memory setting, and you are sure all the writes performed to the</span></span><br><span class="line"><span class="comment"># replica are idempotent, then you may change this default (but be sure to understand</span></span><br><span class="line"><span class="comment"># what you are doing).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note that since the replica by default does not evict, it may end using more</span></span><br><span class="line"><span class="comment"># memory than the one set via maxmemory (there are certain buffers that may</span></span><br><span class="line"><span class="comment"># be larger on the replica, or data structures may sometimes take more memory and so</span></span><br><span class="line"><span class="comment"># forth). So make sure you monitor your replicas and make sure they have enough</span></span><br><span class="line"><span class="comment"># memory to never hit a real out-of-memory condition before the master hits</span></span><br><span class="line"><span class="comment"># the configured maxmemory setting.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># replica-ignore-maxmemory yes</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>RDB 触发机制：</code></p>
<p>1、执行 save 方法会生成 dump.rdb 文件。<br>2、执行 flushall 命令生成 dump.rdb 文件。<br>3、退出 Redis 也会生成 dump.rdb 文件。</p>
</blockquote>
<p><code>AOF 配置：</code> <strong><em>持久化方式 AOF 的配置。</em></strong> 配置如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每次启动时 Redis 都会先把这个文件的数据读入内存里，先忽略 RDB 文件【默认是不开启 AOF 模式的】</span></span><br><span class="line"><span class="attr">appendonly</span> <span class="string">no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置生成的 AOF 文件的名称</span></span><br><span class="line"><span class="attr">appendfilename</span> <span class="string">“appendonly.aof”</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># fsync() 系统调用告诉操作系统把数据写到磁盘上，而不是等更多的数据进入输出缓冲区。有些操作系统会真的把数据马上刷到磁盘上；有些则会尽快去尝试这么做。</span></span><br><span class="line"><span class="comment"># Redis 支持三种不同的模式：</span></span><br><span class="line"><span class="comment"># no：           不要立刻刷，只有在操作系统需要刷的时候再刷。比较快。</span></span><br><span class="line"><span class="comment"># always：      每次写操作都立刻写入到 aof 文件。慢，但是最安全。</span></span><br><span class="line"><span class="comment"># everysec：    每秒写一次。折中方案。</span></span><br><span class="line"><span class="comment"># 默认的 everysec 通常来说能在速度和数据安全性之间取得比较好的平衡。</span></span><br><span class="line"><span class="attr">appendfsync</span> <span class="string">everysec</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果 AOF 的同步策略设置成 “always” 或者 “everysec” ，并且后台的存储进程（后台存储或写入 AOF 日志）会产生很多磁盘 I/O 开销。某些 Linux 的配置下会使 Redis 因为 fsync() 系统调用而阻塞很久。</span></span><br><span class="line"><span class="comment"># 注意，目前对这个情况还没有完美修正，甚至不同线程的 fsync() 会阻塞我们同步的 write(2) 调用。</span></span><br><span class="line"><span class="comment"># 为了缓解这个问题，可以用下面这个选项。它可以在 BGSAVE 或 BGREWRITEAOF 处理时阻止 fsync()。</span></span><br><span class="line"><span class="comment"># 这就意味着如果有子进程在进行保存操作，那么 Redis 就处于"不可同步"的状态。</span></span><br><span class="line"><span class="comment"># 这实际上是说，在最差的情况下可能会丢掉 30 秒钟的日志数据。（默认 Linux 设定）</span></span><br><span class="line"><span class="comment"># 如果把这个设置成 "yes" 带来了延迟问题，就保持 "no" ，这是保存持久数据的最安全的方式。</span></span><br><span class="line"><span class="meta">no-appendfsync-on-rewrite</span> <span class="string">no</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#自动重写AOF文件。如果AOF日志文件增大到指定百分比，Redis能够通过 BGREWRITEAOF 自动重写AOF日志文件。</span></span><br><span class="line"><span class="comment">#工作原理：Redis记住上次重写时AOF文件的大小（如果重启后还没有写操作，就直接用启动时的AOF大小）</span></span><br><span class="line"><span class="comment">#这个基准大小和当前大小做比较。如果当前大小超过指定比例，就会触发重写操作。</span></span><br><span class="line"><span class="comment">#你还需要指定被重写日志的最小尺寸，这样避免了达到指定百分比但尺寸仍然很小的情况还要重写。</span></span><br><span class="line"><span class="comment">#指定百分比为0会禁用AOF自动重写特性。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">auto-aof-rewrite-percentage</span> <span class="string">100</span></span><br><span class="line"><span class="comment"># 文件达到大小阈值的时候进行重写</span></span><br><span class="line"><span class="meta">auto-aof-rewrite-min-size</span> <span class="string">64mb</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果设置为yes，如果一个因异常被截断的AOF文件被redis启动时加载进内存，redis将会发送日志通知用户</span></span><br><span class="line"><span class="comment">#如果设置为no，erdis将会拒绝启动。此时需要用"redis-check-aof"工具修复文件。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">aof-load-truncated</span> <span class="string">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#加载时Redis识别出AOF文件以“REDIS”开头字符串，</span></span><br><span class="line"><span class="comment">#并加载带此前缀的RDB文件，然后继续加载AOF</span></span><br><span class="line"><span class="meta">aof-use-rdb-preamble</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">############################## APPEND ONLY MODE ###############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># By default Redis asynchronously dumps the dataset on disk. This mode is</span></span><br><span class="line"><span class="comment"># good enough in many applications, but an issue with the Redis process or</span></span><br><span class="line"><span class="comment"># a power outage may result into a few minutes of writes lost (depending on</span></span><br><span class="line"><span class="comment"># the configured save points).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The Append Only File is an alternative persistence mode that provides</span></span><br><span class="line"><span class="comment"># much better durability. For instance using the default data fsync policy</span></span><br><span class="line"><span class="comment"># (see later in the config file) Redis can lose just one second of writes in a</span></span><br><span class="line"><span class="comment"># dramatic event like a server power outage, or a single write if something</span></span><br><span class="line"><span class="comment"># wrong with the Redis process itself happens, but the operating system is</span></span><br><span class="line"><span class="comment"># still running correctly.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># AOF and RDB persistence can be enabled at the same time without problems.</span></span><br><span class="line"><span class="comment"># If the AOF is enabled on startup Redis will load the AOF, that is the file</span></span><br><span class="line"><span class="comment"># with the better durability guarantees.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Please check http://redis.io/topics/persistence for more information.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">appendonly</span> <span class="string">no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the append only file (default: "appendonly.aof")</span></span><br><span class="line"></span><br><span class="line"><span class="attr">appendfilename</span> <span class="string">"appendonly.aof"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The fsync() call tells the Operating System to actually write data on disk</span></span><br><span class="line"><span class="comment"># instead of waiting for more data in the output buffer. Some OS will really flush</span></span><br><span class="line"><span class="comment"># data on disk, some other OS will just try to do it ASAP.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Redis supports three different modes:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># no: don't fsync, just let the OS flush the data when it wants. Faster.</span></span><br><span class="line"><span class="comment"># always: fsync after every write to the append only log. Slow, Safest.</span></span><br><span class="line"><span class="comment"># everysec: fsync only one time every second. Compromise.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The default is "everysec", as that's usually the right compromise between</span></span><br><span class="line"><span class="comment"># speed and data safety. It's up to you to understand if you can relax this to</span></span><br><span class="line"><span class="comment"># "no" that will let the operating system flush the output buffer when</span></span><br><span class="line"><span class="comment"># it wants, for better performances (but if you can live with the idea of</span></span><br><span class="line"><span class="comment"># some data loss consider the default persistence mode that's snapshotting),</span></span><br><span class="line"><span class="comment"># or on the contrary, use "always" that's very slow but a bit safer than</span></span><br><span class="line"><span class="comment"># everysec.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># More details please check the following article:</span></span><br><span class="line"><span class="comment"># http://antirez.com/post/redis-persistence-demystified.html</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If unsure, use "everysec".</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># appendfsync always</span></span><br><span class="line"><span class="attr">appendfsync</span> <span class="string">everysec</span></span><br><span class="line"><span class="comment"># appendfsync no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># When the AOF fsync policy is set to always or everysec, and a background</span></span><br><span class="line"><span class="comment"># saving process (a background save or AOF log background rewriting) is</span></span><br><span class="line"><span class="comment"># performing a lot of I/O against the disk, in some Linux configurations</span></span><br><span class="line"><span class="comment"># Redis may block too long on the fsync() call. Note that there is no fix for</span></span><br><span class="line"><span class="comment"># this currently, as even performing fsync in a different thread will block</span></span><br><span class="line"><span class="comment"># our synchronous write(2) call.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In order to mitigate this problem it's possible to use the following option</span></span><br><span class="line"><span class="comment"># that will prevent fsync() from being called in the main process while a</span></span><br><span class="line"><span class="comment"># BGSAVE or BGREWRITEAOF is in progress.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This means that while another child is saving, the durability of Redis is</span></span><br><span class="line"><span class="comment"># the same as "appendfsync none". In practical terms, this means that it is</span></span><br><span class="line"><span class="comment"># possible to lose up to 30 seconds of log in the worst scenario (with the</span></span><br><span class="line"><span class="comment"># default Linux settings).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If you have latency problems turn this to "yes". Otherwise leave it as</span></span><br><span class="line"><span class="comment"># "no" that is the safest pick from the point of view of durability.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">no-appendfsync-on-rewrite</span> <span class="string">no</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Automatic rewrite of the append only file.</span></span><br><span class="line"><span class="comment"># Redis is able to automatically rewrite the log file implicitly calling</span></span><br><span class="line"><span class="comment"># BGREWRITEAOF when the AOF log size grows by the specified percentage.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This is how it works: Redis remembers the size of the AOF file after the</span></span><br><span class="line"><span class="comment"># latest rewrite (if no rewrite has happened since the restart, the size of</span></span><br><span class="line"><span class="comment"># the AOF at startup is used).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This base size is compared to the current size. If the current size is</span></span><br><span class="line"><span class="comment"># bigger than the specified percentage, the rewrite is triggered. Also</span></span><br><span class="line"><span class="comment"># you need to specify a minimal size for the AOF file to be rewritten, this</span></span><br><span class="line"><span class="comment"># is useful to avoid rewriting the AOF file even if the percentage increase</span></span><br><span class="line"><span class="comment"># is reached but it is still pretty small.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Specify a percentage of zero in order to disable the automatic AOF</span></span><br><span class="line"><span class="comment"># rewrite feature.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">auto-aof-rewrite-percentage</span> <span class="string">100</span></span><br><span class="line"><span class="meta">auto-aof-rewrite-min-size</span> <span class="string">64mb</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># An AOF file may be found to be truncated at the end during the Redis</span></span><br><span class="line"><span class="comment"># startup process, when the AOF data gets loaded back into memory.</span></span><br><span class="line"><span class="comment"># This may happen when the system where Redis is running</span></span><br><span class="line"><span class="comment"># crashes, especially when an ext4 filesystem is mounted without the</span></span><br><span class="line"><span class="comment"># data=ordered option (however this can't happen when Redis itself</span></span><br><span class="line"><span class="comment"># crashes or aborts but the operating system still works correctly).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Redis can either exit with an error when this happens, or load as much</span></span><br><span class="line"><span class="comment"># data as possible (the default now) and start if the AOF file is found</span></span><br><span class="line"><span class="comment"># to be truncated at the end. The following option controls this behavior.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If aof-load-truncated is set to yes, a truncated AOF file is loaded and</span></span><br><span class="line"><span class="comment"># the Redis server starts emitting a log to inform the user of the event.</span></span><br><span class="line"><span class="comment"># Otherwise if the option is set to no, the server aborts with an error</span></span><br><span class="line"><span class="comment"># and refuses to start. When the option is set to no, the user requires</span></span><br><span class="line"><span class="comment"># to fix the AOF file using the "redis-check-aof" utility before to restart</span></span><br><span class="line"><span class="comment"># the server.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note that if the AOF file will be found to be corrupted in the middle</span></span><br><span class="line"><span class="comment"># the server will still exit with an error. This option only applies when</span></span><br><span class="line"><span class="comment"># Redis will try to read more data from the AOF file but not enough bytes</span></span><br><span class="line"><span class="comment"># will be found.</span></span><br><span class="line"><span class="meta">aof-load-truncated</span> <span class="string">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># When rewriting the AOF file, Redis is able to use an RDB preamble in the</span></span><br><span class="line"><span class="comment"># AOF file for faster rewrites and recoveries. When this option is turned</span></span><br><span class="line"><span class="comment"># on the rewritten AOF file is composed of two different stanzas:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   [RDB file][AOF tail]</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># When loading Redis recognizes that the AOF file starts with the "REDIS"</span></span><br><span class="line"><span class="comment"># string and loads the prefixed RDB file, and continues loading the AOF</span></span><br><span class="line"><span class="comment"># tail.</span></span><br><span class="line"><span class="meta">aof-use-rdb-preamble</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>注意啦！！！</code></p>
<p>1、如果我们的 AOF 文件有错误，我们的 Redis 文件时启动不起来的。因此，我们需要修复 AOF 文件。<br>2、Redis 给我们提供了一个工具： redis-check-aof ，用于修复受损的 AOF 文件。<br>3、修复命令为： redis-check-aof –fix appendonly.aof</p>
</blockquote>
<h2 id="Redis-的发布订阅"><a href="#Redis-的发布订阅" class="headerlink" title="Redis 的发布订阅"></a>Redis 的发布订阅</h2><p><code>Redis 发布订阅(pub/sub)</code> 是一种 <strong><em>消息通信模式：发送者(pub)发送消息，订阅者(sub)接收消息。</em></strong> 举个常用的例子：我们微信关注的公众号会给我们发送消息就属于这种通信模式。<strong><em>【Redis 客户端可以订阅任意数量的频道】</em></strong></p>
<p><img src="../gallery/Database/Redis/redis-090.png" alt="发布订阅消息图"><br><img src="../gallery/Database/Redis/redis-091.png" alt=""></p>
<p>下表列出了关于 <strong><em>Redis 发布订阅常用命令：</em></strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 订阅一个或多个符合给定模式的频道。</span></span><br><span class="line"><span class="string">PSUBSCRIBE</span> <span class="string">pattern</span> <span class="string">[pattern</span> <span class="string">...]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看订阅与发布系统状态。</span></span><br><span class="line"><span class="string">PUBSUB</span> <span class="string">subcommand</span> <span class="string">[argument</span> <span class="string">[argument</span> <span class="string">...]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将信息发送到指定的频道。</span></span><br><span class="line"><span class="string">PUBLISH</span> <span class="string">channel</span> <span class="string">message</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 退订所有给定模式的频道。</span></span><br><span class="line"><span class="string">PUNSUBSCRIBE</span> <span class="string">[pattern</span> <span class="string">[pattern</span> <span class="string">...]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 订阅给定的一个或多个频道的信息。</span></span><br><span class="line"><span class="string">SUBSCRIBE</span> <span class="string">channel</span> <span class="string">[channel</span> <span class="string">...]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指退订给定的频道。</span></span><br><span class="line"><span class="string">UNSUBSCRIBE</span> <span class="string">[channel</span> <span class="string">[channel</span> <span class="string">...]]</span></span><br></pre></td></tr></table></figure>

<p><strong><em>使用 Redis 客户端来实现订阅发布。</em></strong> 如下图：</p>
<p><img src="../gallery/Database/Redis/redis-092.png" alt=""></p>
<blockquote>
<p><code>TIPS：</code> 使用 Java 来实现订阅发布先放一放，以后有空来完善。</p>
</blockquote>
<p><code>应用场景：</code> Redis 的发布订阅应用场景在我们生活中还是挺常见的。如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ Redis 订阅发布应用场景</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 1、构建实时消息系统，比如普通的即时聊天，群聊等功能。</span></span><br><span class="line"><span class="addition">+ 2、微信的公共号订阅消息推送等。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ Redis 订阅发布应用场景</span></span><br></pre></td></tr></table></figure>

<h2 id="Redis-的集群搭建"><a href="#Redis-的集群搭建" class="headerlink" title="Redis 的集群搭建"></a>Redis 的集群搭建</h2><h3 id="集群简介"><a href="#集群简介" class="headerlink" title="集群简介"></a>集群简介</h3><p>Redis 是一个开源的 key value 存储系统，受到了广大互联网公司的青睐。但在 Redis3.0 版本之前，它只支持单例模式，<strong><em>在 3.0 版本及以后才支持集群。</em></strong> Redis 集群采用 P2P 模式，是完全去中心化的，不存在中心节点或者代理节点。并且 Redis 集群是没有统一的入口的，客户端（client）连接集群的时候连接集群中的任意节点（node）即可。集群内部的节点是相互通信的（PING-PONG 机制），每个节点都是一个 Redis 实例。</p>
<hr>
<p>为了实现 Redis 集群的高可用，即判断节点是否健康（能否正常使用），<strong><em>redis-cluster 有这么一个投票容错机制：</em></strong> 如果集群中超过半数的节点投票认为某个节点挂了，那么这个节点就挂了（fail）。这是判断节点是否挂了的方法。<strong><em>那么如何判断集群是否挂了呢?</em></strong> -&gt; 如果集群中任意一个节点挂了，而且该节点没有从节点（备份节点），那么这个集群就挂了。这是判断集群是否挂了的方法。</p>
<hr>
<p><strong><em>那么为什么任意一个节点挂了（没有从节点）这个集群就挂了呢？</em></strong> 因为集群内置了 16384 个 slot（哈希槽），并且把所有的物理节点映射到了这 16384[0-16383] 个 slot 上，或者说把这些 slot 均等的分配给了各个节点。当需要在 Redis 集群存放一个数据（key-value）时，Redis 会先对这个 key 进行 crc16 算法，然后得到一个结果。再把这个结果对 16384 进行求余，这个余数会对应 [0-16383] 其中一个槽，进而决定 key-value 存储到哪个节点中。所以一旦某个节点挂了，该节点对应的 slot 就无法使用，那么就会导致集群无法正常工作。<strong><em>综上所述，每个 Redis 集群理论上最多可以有 16384 个节点。</em></strong></p>
<hr>
<p><code>集群所需环境：</code> <strong><em>1、Redis 集群至少需要 3 个节点，</em></strong> 因为投票容错机制要求超过半数节点认为某个节点挂了该节点才是挂了，所以 2 个节点无法构成集群。<strong><em>2、要保证集群的高可用，需要每个节点都有从节点，也就是备份节点，所以 Redis 集群至少需要 6 台服务器。</em></strong>因为我没有那么多服务器，也启动不了那么多虚拟机，所在这里搭建的是伪分布式集群，即一台服务器虚拟运行 6 个 redis 实例，修改端口号为（7001-7006），当然实际生产环境的 Redis 集群搭建和这里是一样的。</p>
<blockquote>
<p><code>简介来源：</code> <a href="https://blog.csdn.net/qq_42815754/article/details/82912130">redis集群搭建（非常详细，适合新手）</a></p>
</blockquote>
<h3 id="集群搭建"><a href="#集群搭建" class="headerlink" title="集群搭建"></a>集群搭建</h3><p><code>第一步：</code> <strong><em>开启虚拟机，打开四个窗口连接我们的同一台虚拟机。</em></strong> 如下图：</p>
<p><img src="../gallery/Database/Redis/redis-093.png" alt=""></p>
<p><code>第二步：</code> <strong><em>复制 Redis 配置文件，为每一台从机进行配置。</em></strong> 如下图：</p>
<p><img src="../gallery/Database/Redis/redis-094.png" alt=""></p>
<p><code>第三步：</code> <strong><em>修改 <code>redis.conf</code> 、<code>redis-1.conf</code> 、<code>redis-2.conf</code> 和 <code>redis-3.conf</code> 配置文件。</em></strong> 需修改的配置如下：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis.conf 配置文件需修改的地方</span></span><br><span class="line"><span class="string">logfile</span> <span class="string">"6379.log"</span>        <span class="comment"># 这个是修改后的内容</span></span><br><span class="line"><span class="string">dbfilename</span> <span class="string">dump6379.rdb</span>   <span class="comment"># 这个是修改后的内容</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># redis-1.conf 配置文件需修改的地方</span></span><br><span class="line"><span class="string">port</span> <span class="number">6380</span>                            <span class="comment"># 这个是修改后的内容</span></span><br><span class="line"><span class="string">pidfile</span> <span class="string">/var/run/redis_6380.pid</span>      <span class="comment"># 这个是修改后的内容</span></span><br><span class="line"><span class="string">logfile</span> <span class="string">"6380.log"</span>                   <span class="comment"># 这个是修改后的内容</span></span><br><span class="line"><span class="string">dbfilename</span> <span class="string">dump6380.rdb</span>              <span class="comment"># 这个是修改后的内容</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># redis-2.conf 配置文件需修改的地方</span></span><br><span class="line"><span class="string">port</span> <span class="number">6381</span>                            <span class="comment"># 这个是修改后的内容</span></span><br><span class="line"><span class="string">pidfile</span> <span class="string">/var/run/redis_6381.pid</span>      <span class="comment"># 这个是修改后的内容</span></span><br><span class="line"><span class="string">logfile</span> <span class="string">"6381.log"</span>                   <span class="comment"># 这个是修改后的内容</span></span><br><span class="line"><span class="string">dbfilename</span> <span class="string">dump6381.rdb</span>              <span class="comment"># 这个是修改后的内容</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># redis-3.conf 配置文件需修改的地方</span></span><br><span class="line"><span class="string">port</span> <span class="number">6382</span>                            <span class="comment"># 这个是修改后的内容</span></span><br><span class="line"><span class="string">pidfile</span> <span class="string">/var/run/redis_6382.pid</span>      <span class="comment"># 这个是修改后的内容</span></span><br><span class="line"><span class="string">logfile</span> <span class="string">"6382.log"</span>                   <span class="comment"># 这个是修改后的内容</span></span><br><span class="line"><span class="string">dbfilename</span> <span class="string">dump6382.rdb</span>              <span class="comment"># 这个是修改后的内容</span></span><br></pre></td></tr></table></figure>

<p><code>第四步：</code> <strong><em>开启我们的四个 Redis 服务器，并进行查看。</em></strong> 具体操作如下图：</p>
<div class="img-x">

<p><img src="../gallery/Database/Redis/redis-095.png" alt="开启 Redis 主机"> <img src="../gallery/Database/Redis/redis-096.png" alt="开启 Redis 1 号从机"> <img src="../gallery/Database/Redis/redis-097.png" alt="开启 Redis 2 号从机"> <img src="../gallery/Database/Redis/redis-098.png" alt="开启 Redis 3 号从机"><img src="../gallery/Database/Redis/redis-099.png" alt="查看 Redis 服务"> </p>
</div>

<blockquote>
<p><code>说明一下：</code> 这个部分的操作是为下面的 <strong><em>Redis 的主从复制</em></strong> 服务的。所以，上述的搭建过程并不是真正意义上的集群搭建。</p>
</blockquote>
<h2 id="Redis-的主从复制"><a href="#Redis-的主从复制" class="headerlink" title="Redis 的主从复制"></a>Redis 的主从复制</h2><h3 id="主从复制简介"><a href="#主从复制简介" class="headerlink" title="主从复制简介"></a>主从复制简介</h3><p>通过持久化功能，Redis 保证了即使在服务器重启的情况下也不会丢失（或少量丢失）数据，但是由于数据是存储在一台服务器上的，如果这台服务器出现故障，比如硬盘坏了，也会导致数据丢失。<strong><em>为了避免单点故障，我们需要将数据复制多份部署在多台不同的服务器上，即使有一台服务器出现故障其他服务器依然可以继续提供服务。</em></strong> 这就要求当一台服务器上的数据更新后，自动将更新的数据同步到其他服务器上，这时候就用到了 Redis 的主从复制。</p>
<p><img src="../gallery/Database/Redis/redis-100.png" alt=""></p>
<p><strong><em>Redis 提供了复制（replication）功能来自动实现多台 Redis 服务器的数据同步。</em></strong> 我们可以通过部署多台 Redis ，并在配置文件中指定这几台 Redis 之间的主从关系，主服务器负责写入数据，同时把写入的数据实时同步到从服务器，这种模式叫做 <code>主从复制</code> ，<strong><em>即 master/slave ，并且 Redis 默认 master 用于写，slave 用于读，向 slave 写数据会导致错误。</em></strong> <code>注意：</code> <strong><em>默认情况下，每一台 Redis 服务器都是主节点【如果还没有进行相应的配置】。</em></strong></p>
<h3 id="主从复制搭建"><a href="#主从复制搭建" class="headerlink" title="主从复制搭建"></a>主从复制搭建</h3><p><strong><em>主从复制会使用到的命令如下：</em></strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379&gt;</span> <span class="string">info</span> <span class="string">replication</span>    <span class="comment"># 查看当前库信息</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379&gt;</span> <span class="string">slaveof</span> <span class="string">host</span> <span class="string">port</span>   <span class="comment"># 配置主机【就是去认老大】</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379&gt;</span> <span class="string">slaveof</span> <span class="literal">no</span> <span class="string">one</span>      <span class="comment"># 如果主机宕机了，从机可使用这条命令让自己成为主机【谋朝篡位】</span></span><br></pre></td></tr></table></figure>

<p><code>第一步：</code> <strong><em>开启四台 Redis 服务器的客户端。</em></strong> 如下图所示：</p>
<div class="img-x">

<p><img src="../gallery/Database/Redis/redis-101.png" alt=""> <img src="../gallery/Database/Redis/redis-102.png" alt=""> <img src="../gallery/Database/Redis/redis-103.png" alt=""> <img src="../gallery/Database/Redis/redis-104.png" alt=""></p>
</div>

<hr>
<p><code>第二步：</code> <strong><em>我们使用 1 号机（6380 端口）去配置主机。（此时的 1 号机仍是主机，配置之后会变为从机）</em></strong> 配置如下图：</p>
<p><img src="../gallery/Database/Redis/redis-105.png" alt=""></p>
<p><code>第三步：</code> <strong><em>配置完成后，我们去看看我们的主机状态（6379 端口）。</em></strong> 如下图：</p>
<p><img src="../gallery/Database/Redis/redis-106.png" alt=""></p>
<p><code>第四步：</code> <strong><em>注意事项与故障测试。</em></strong> 这部分使用文字描述，具体操作自行实现。描述如下：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ 注意事项与故障测试</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 1、真正的主从复制的配置应该在配置文件中配置，这样配置才是永久的，而我们使用命令配置只是暂时的。</span></span><br><span class="line"><span class="addition">+ 2、主机负责写，从机负责读且从机不能写。（从机如果去写，会报错： (error) READONLY You can't write against a read only replica.）</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">- 如果主机服务器（6379 端口）突然宕机了（我们把它断开连接），那么从机依旧会连接到主机，但是没有写操作。</span></span><br><span class="line"><span class="deletion">- 如果此时主机又恢复正常了，从机依旧可以获取到主机写的信息。</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ 如果是使用命令行来配置的主从复制，这个时候从机如果重启，就会变会到主机，就无法获取到他原来主机的值。</span></span><br><span class="line"><span class="addition">+ 这个时候如果把它变回从机，那么它又可以获取到原来主机的值。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 注意事项与故障测试</span></span><br></pre></td></tr></table></figure>

<h3 id="宕机后手动配置主机"><a href="#宕机后手动配置主机" class="headerlink" title="宕机后手动配置主机"></a>宕机后手动配置主机</h3><p><strong><em>如果我们的 6379 机子宕机了，那怎么办呢？【现在我们先手动配置，稍后讲哨兵模式（自动配置）】</em></strong> 如下图：</p>
<p><img src="../gallery/Database/Redis/redis-107.png" alt=""></p>
<p><strong><em>我们先把集群配置成上图的第二种方式。【注意观察 6380 机子的信息】</em></strong> 如下图：</p>
<div class="img-x">

<p><img src="../gallery/Database/Redis/redis-108.png" alt="6381 机子"> <img src="../gallery/Database/Redis/redis-109.png" alt="6382 机子"> <img src="../gallery/Database/Redis/redis-110.png" alt="6380 机子"> <img src="../gallery/Database/Redis/redis-111.png" alt="6379 主机"></p>
</div>

<hr>
<p><strong><em>此时，我们把 6379 主机断开（使用 shutdown + exit 命令）</em></strong> ，那就没有主机了。<strong><em>那么 6380 机子可能成为主机吗？（需手动选择） 系统能不能在主机宕机之后自动选择主机呢？（哨兵模式，稍后讲）</em></strong> 我们先来手动配置，把 6380 机子设置为主机。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-112.png" alt=""></p>
<p>那么问题来了，<strong><em>如果 6379 又恢复正常了，谁会是主机呢？【6380 仍是主机，否则怎么叫谋朝篡位呢】</em></strong> 如下图：</p>
<p><img src="../gallery/Database/Redis/redis-114.png" alt=""><br><img src="../gallery/Database/Redis/redis-113.png" alt=""></p>
<blockquote>
<p><code>温馨提示：</code></p>
<p>主机宕机的手动解决方案就是这样了。接下来介绍 <strong><em>自动解决方案： 哨兵模式</em></strong> 。</p>
</blockquote>
<h2 id="哨兵模式详解"><a href="#哨兵模式详解" class="headerlink" title="哨兵模式详解"></a>哨兵模式详解</h2><h3 id="哨兵模式简介"><a href="#哨兵模式简介" class="headerlink" title="哨兵模式简介"></a>哨兵模式简介</h3><p><strong><em>主从切换技术的方法是：</em></strong> 当主服务器宕机后，需要手动把一台从服务器切换为主服务器，这就需要 <strong><em>人工干预，费事费力，还会造成一段时间内服务不可用，</em></strong> 这不是一种推荐的方式。</p>
<hr>
<p>更多时候， 我们优先考虑 <code>哨兵模式</code> ：<strong><em>从 Redis2.8 开始正式提供了 Sentinel(哨兵)架构来解决这个问题。</em></strong><code>哨兵模式</code> 就是谋朝篡位的自动版，<strong><em>能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库。</em></strong></p>
<hr>
<p><code>哨兵模式</code> 是一种特殊的模式， 首先 Redis 提供了哨兵的命令， <strong><em>哨兵是一个独立的进程，</em></strong> 作为进程， 它会独立运行。<strong><em>其原理是哨兵通过发送命令， 等待 Redis 服务器响应， 从而监控运行的多个 Redis 实例。</em></strong> 哨兵模式如下图：</p>
<p><img src="../gallery/Database/Redis/redis-115.png" alt=""></p>
<blockquote>
<p><code>这里的哨兵有两个作用：</code></p>
<p>1、通过发送命令， 让 Redis 服务器返回监控其运行状态的信息， 包括主服务器和从服务器。<br>2、当哨兵监测到 master 宕机， 会自动将 slave 切换成 master， 然后通过发布订阅模式通知其他的从服务器，并修改配置文件，让它们切换主机。</p>
</blockquote>
<p><strong><em>然而，一个哨兵进程对 Redis 服务器进行监控， 可能会出现问题【可能哨兵挂了】。</em></strong> 为此， 我们可以使用多个哨兵进行监控。各个哨兵之间还会进行监控，这样就形成了 <strong><em>多哨兵模式</em></strong> 。如下图：</p>
<p><img src="../gallery/Database/Redis/redis-116.png" alt=""></p>
<p>假设主服务器宕机，<strong><em>哨兵 1</em></strong> 先检测到这个结果， 系统并不会马上进行 failover 过程， 仅仅是哨兵 1 主观的认为主服务器不可用， 这个现象称为 <code>主观下线</code> 。当后面的哨兵也检测到主服务器不可用，<strong><em>并且数量达到一定值时，那么哨兵之间就会进行一次投票，</em></strong> 投票的结果由一个哨兵发起， 进行 failover[故障转移] 操作。切换成功后， 就会通过 <strong><em>发布订阅模式</em></strong> ， 让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为 <code>客观下线</code> 。</p>
<h3 id="哨兵模式配置"><a href="#哨兵模式配置" class="headerlink" title="哨兵模式配置"></a>哨兵模式配置</h3><p><code>第一步：</code> <strong><em>明确我们的主从配置模式。</em></strong> 现在的配置模式 <strong><em>【一主三从】</em></strong> 如下图：</p>
<p><img src="../gallery/Database/Redis/redis-100.png" alt=""></p>
<p><code>第二步：</code> <strong><em>配置我们的哨兵配置文件 <code>sentinel.conf</code> 。</em></strong> 配置文件内容及截图如下：</p>
<figure class="highlight yml"><figcaption><span>sentinel.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###########################################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel【固定的】  monitor【固定的】  监控的名称  主机  端口号  是否选举</span></span><br><span class="line"><span class="string">sentinel</span> <span class="string">monitor</span> <span class="string">myredis</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">6379</span> <span class="number">1</span></span><br><span class="line"><span class="comment"># 上述的数字 1 表示： 当主机挂了，哨兵进行投票给从机，哪个从机票数多，谁就能够成为主机。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###########################################################################################</span></span><br></pre></td></tr></table></figure>

<p><img src="../gallery/Database/Redis/redis-117.png" alt=""></p>
<p><code>第三步：</code> <strong><em>启动哨兵模式。</em></strong> 如下图：</p>
<p><img src="../gallery/Database/Redis/redis-118.png" alt=""></p>
<p><code>第四步：</code> <strong><em>关闭主机，查看哨兵模式是否起作用。</em></strong> 如下图：</p>
<p><img src="../gallery/Database/Redis/redis-119.png" alt=""><br><img src="../gallery/Database/Redis/redis-120.png" alt=""><br><img src="../gallery/Database/Redis/redis-121.png" alt=""></p>
<p>那么问题来了，<strong><em>如果 6379 机子恢复了，会出现什么情况呢？</em></strong> 如下图：</p>
<p><img src="../gallery/Database/Redis/redis-122.png" alt=""></p>
<h3 id="优缺点及问题"><a href="#优缺点及问题" class="headerlink" title="优缺点及问题"></a>优缺点及问题</h3><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">+++ 哨兵模式优缺点</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 优点</span></span><br><span class="line"><span class="addition">+ 1、哨兵集群，基于主从复制模式，所有的主从配置优点，它全有。</span></span><br><span class="line"><span class="addition">+ 2、主从可以切换，故障可以转移，系统的可用性就会更好。</span></span><br><span class="line"><span class="addition">+ 3、哨兵模式就是主从模式的升级，手动到自动，更加健壮！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--- 缺点</span></span><br><span class="line"><span class="deletion">- 1、Redis 不好在线扩容， 集群容量一旦到达上限， 在线扩容就十分麻烦!</span></span><br><span class="line"><span class="deletion">- 2、实现哨兵模式的配置其实是很麻烦的，里面有很多选择!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">+++ 哨兵模式优缺点</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>问题如下图：<strong><em>就是我恢复 6379 机子时，主机发生了变化，不是 6381了， 而是 6382。由于时间原因，暂未查明，以后看到把它搞定。</em></strong></p>
<p><img src="../gallery/Database/Redis/redis-123.png" alt=""></p>
</blockquote>
<h3 id="哨兵模式配置文件"><a href="#哨兵模式配置文件" class="headerlink" title="哨兵模式配置文件"></a>哨兵模式配置文件</h3><p><strong><em>哨兵模式配置文件</em></strong> 详解如下：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Example sentinel.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#哨兵sentinel实例运行的端口 默认26379</span></span><br><span class="line"><span class="string">port</span> <span class="number">26379</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#哨兵sentinel的工作目录</span></span><br><span class="line"><span class="string">dir</span> <span class="string">/tmp</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#哨兵sentinel监控的redis主节点的 ip port</span></span><br><span class="line"><span class="comment">#master-name可以自己命名的主节点名字，只能由字母A-z、数字0-9、这三个字符".-_"组成。</span></span><br><span class="line"><span class="comment">#quorum 配置多少个sentinel哨兵统一认为master主节点失联 那么这时客观上认为主节点失联了</span></span><br><span class="line"><span class="comment">#sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span></span><br><span class="line"><span class="string">sentinel</span> <span class="string">monitor</span> <span class="string">mymaster</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">6379</span> <span class="number">2</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#当在Redis实例中开启了requirepass foobared授权密码，这样所有连接Redis实例的客户端都要提供密码 </span></span><br><span class="line"><span class="comment">#设置哨兵sentinel连接主从的密码，注意必须为主从设置一样的验证密码</span></span><br><span class="line"><span class="comment"># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span></span><br><span class="line"><span class="string">sentinel</span> <span class="string">auth-pass</span> <span class="string">mymaster</span> <span class="string">XXX</span></span><br><span class="line"><span class="comment">#指定多少毫秒之后主节点没有应答哨兵，此时哨兵主观上认为主节点下线，默认30秒</span></span><br><span class="line"><span class="comment"># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line"><span class="string">sentinel</span> <span class="string">down-after-milliseconds</span> <span class="string">mymaster</span> <span class="number">30000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个配置项指定了在发生failover主备切换（选举）时多可以有多少个slave同时对新的master进行同步，数字越小，完成failover所需的时间就越长，但是如果这个数字越大，就意味着越多的slave因为replication而不可用。可以通过将这个值设为1来保证每次只有一个slave处于不能处理命令请求的状态。</span></span><br><span class="line"><span class="comment"># sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span></span><br><span class="line"><span class="string">sentinel</span> <span class="string">parallel-syncs</span> <span class="string">mymaster</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#故障转移的超时时间failover-timeout可以用在以下这些方面：</span></span><br><span class="line"><span class="comment">#1. 同一个sentinel对同一个master两次failover之间的间隔时间。</span></span><br><span class="line"><span class="comment">#2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。</span></span><br><span class="line"><span class="comment">#3.当想要取消一个正在进行的failover所需要的时间。</span></span><br><span class="line"><span class="comment">#4.当进行failover时，配置所有slaves指向新的master所需的大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了#默认三分钟</span></span><br><span class="line"><span class="comment"># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line"><span class="string">sentinel</span> <span class="string">failover-timeout</span> <span class="string">mymaster</span> <span class="number">180000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#SCRIPTS EXECUTION</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员。</span></span><br><span class="line"><span class="comment">#对于脚本的运行结果有以下规则：</span></span><br><span class="line"><span class="comment">#若脚本执行后返回1，那么该脚本稍后将会被再次执行，重复次数目前默认为10</span></span><br><span class="line"><span class="comment">#若脚本执行后返回2，或者比2更高的一个返回值，脚本将不会重复执行。</span></span><br><span class="line"><span class="comment">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。#一个脚本的大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#通知型脚本:当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），将会去调用这个脚本，这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传给脚本两个参数，一个是事件的类型，一个是事件的描述。如果sentinel.conf配 置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无 法正常启动成功。</span></span><br><span class="line"><span class="comment">#通知脚本</span></span><br><span class="line"><span class="comment"># sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line"><span class="string">sentinel</span> <span class="string">notification-script</span> <span class="string">mymaster</span> <span class="string">/var/redis/notify.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#客户端重新配置主节点参数脚本</span></span><br><span class="line"><span class="comment"># 当一个master由于failover而发生改变时，这个脚本将会被调用，通知相关的客户端关于master地址已经发生改变的信息。</span></span><br><span class="line"><span class="comment">#以下参数将会在调用脚本时传给脚本:</span></span><br><span class="line"><span class="comment"># &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span></span><br><span class="line"><span class="comment"># 目前&lt;state&gt;总是“failover”, # &lt;role&gt;是“leader”或者“observer”中的一个。</span></span><br><span class="line"><span class="comment">#参数 from-ip, from-port, to-ip, to-port是用来和旧的master和新的master(即旧的slave)通信的</span></span><br><span class="line"><span class="comment"># 这个脚本应该是通用的，能被多次调用，不是针对性的。</span></span><br><span class="line"><span class="comment"># sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line"><span class="string">sentinel</span> <span class="string">client-reconfig-script</span> <span class="string">mymaster</span> <span class="string">/var/redis/reconfig.sh</span></span><br></pre></td></tr></table></figure>

<h2 id="缓存穿透和雪崩"><a href="#缓存穿透和雪崩" class="headerlink" title="缓存穿透和雪崩"></a>缓存穿透和雪崩</h2><h3 id="缓存穿透简介"><a href="#缓存穿透简介" class="headerlink" title="缓存穿透简介"></a>缓存穿透简介</h3><p><code>缓存穿透的概念：</code> <strong><em>用户想要查询一个数据， 发现 Redis 内存数据库没有， 也就是缓存没有命中， 于是向持久层数据库查询。发现也没有，于是本次查询失败。</em></strong> 当用户很多的时候，缓存都没有命中(秒杀!)，于是都去请求了持久层数据库，这会给持久层数据库造成很大的压力，这时候就相当于出现了 <code>缓存穿透</code> 。</p>
<hr>
<p><strong><em>解决方案：</em></strong> <code>布隆过滤器</code> 是一种数据结构， 对所有可能查询的参数以 hash 形式存储， 在控制层先进行校验， 不符合则丢弃， 从而避免了对底层存储系统的查询压力；</p>
<p><code>缓存空对象：</code>当存储层不命中后，即使返回的空对象也将其缓存起来，同时会设置一个过期时间，之后再访问这个数据将会从缓存中获取，保护了后端数据源。</p>
<hr>
<p><strong><em>但是这种方法会存在两个问题：</em></strong></p>
<ul>
<li>1、如果空值能够被缓存起来，这就意味着缓存需要更多的空间存储更多的键，因为这当中可能会有很多的空值的键。</li>
<li>2、即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响。</li>
</ul>
<h3 id="缓存击穿"><a href="#缓存击穿" class="headerlink" title="缓存击穿"></a>缓存击穿</h3><p><strong><em>这里需要注意缓存穿透和缓存击穿的区别，</em></strong> <code>缓存击穿</code> 是指一个 key 非常热点（如微博热搜）， 在不停的扛着大并发， 大并发集中对这一个点进行访问， 当这个 key 在失效的瞬间， 持续的大并发就穿破缓存， 直接请求数据库， 就像在一个屏障上凿开了一个洞。</p>
<hr>
<p>当某个 key 在过期的瞬间， 有大量的请求并发访问， 这类数据一般是热点数据， 由于缓存过期， 会同时访问数据库来查询最新数据，并且回写缓存，会导使数据库瞬间压力过大。</p>
<hr>
<p><code>解决方案</code><br>1、设置热点数据永不过期：从缓存层面来看， 没有设置过期时间， 所以不会出现热点 key 过期后产生的问题。<br>2、加互斥锁分布式锁：使用分布式锁， 保证对于每个key同时只有一个线程去查询后端服务， 其他线程没有获得分布式锁的权限， 因此只需要等待即可。这种方式将高并发的压力转移到了分布式锁，因此对分布式锁的考验很大。</p>
<h3 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h3><p><code>缓存雪崩</code> 是指在某一个时间段工缓存集中过期失效。产生雪崩的原因之一，比如在写本文的时候，马上就要到双十二零点，很快就会迎来一波抢购，这波商品时间比较集中的放入了缓存，假设缓存一个小时。那么到了凌晨一点钟的时候，这批商品的缓存就都过期了。而对这批商品的访问查询，都落到了数据库上，对于数据库而言，就会产生周期性的压力波峰。于是所有的请求都会达到存储层，存储层的调用量会暴增，造成存储层也会挂掉的情况。</p>
<p>其实集中过期，倒不是非常致命，比较致命的缓存雪崩，是缓存服务器某个节点宕机或断网。因为自然形成的缓存雪崩，一定是在某个时间段集中创建缓存，这个时候，数据库也是可以顶住压力的。无非就是对数据库产生周期性的压力而已。而缓存服务节点的宕机，对数据库服务器造成的压力是不可预知的，很有可能瞬间就把数据库压垮。11!I</p>
<hr>
<p>解决方案<br>1、Redis 高可用<br>这个思想的含义是， 既然red is有可能挂掉， 那我多增设几台red is， 这样一台挂掉之群。(异地多活!)<br>2、限流降级<br>这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的询数据和写缓存，其他线程等待。<br>3、数据预热<br>数据加热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分将发生大并发访问前手动触发加载缓存不同的key， 设置不同的过期时间， 让缓存失后其他的还可以继续工作，其实就是搭建的集的线程数量。比如对某个key只允许一个线程查分可能大量访问的数据就会加载到缓存中。在即效的时间点尽量均匀。</p>
<h1 id="Redis-面试题"><a href="#Redis-面试题" class="headerlink" title="Redis 面试题"></a>Redis 面试题</h1><p><strong><em>redis 是什么？都有哪些使用场景？</em></strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Redis（Remote</span> <span class="string">Dictionary</span> <span class="string">Server</span> <span class="string">)</span> <span class="string">:</span> <span class="string">即远程字典服务</span> <span class="string">，是一个开源的使用</span> <span class="string">ANSI</span> <span class="string">C</span> <span class="string">语言编写、支持网络、可基于内存亦可持久化的日志型、高性能的</span> <span class="string">NOSQL</span> <span class="string">系列的非关系型数据库</span> <span class="string">，并提供多种语言的</span> <span class="string">API</span> <span class="string">。【————</span> <span class="string">百度百科】</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Redis 的应用场景</span></span><br><span class="line"><span class="number">1</span><span class="string">、缓存（数据查询、短连接、新闻内容、商品内容等等）</span></span><br><span class="line"><span class="number">2</span><span class="string">、聊天室的在线好友列表</span></span><br><span class="line"><span class="number">3</span><span class="string">、任务队列。（秒杀、抢购、12306</span> <span class="string">等等）</span></span><br><span class="line"><span class="number">4</span><span class="string">、应用排行榜</span></span><br><span class="line"><span class="number">5</span><span class="string">、网站访问统计</span></span><br><span class="line"><span class="number">6</span><span class="string">、数据过期处理（可以精确到毫秒</span></span><br><span class="line"><span class="number">7</span><span class="string">、分布式集群架构中的</span> <span class="string">session</span> <span class="string">分离</span></span><br><span class="line"><span class="number">8</span><span class="string">、发布订阅系统</span></span><br><span class="line"><span class="number">9</span><span class="string">、地图信息分析</span></span><br></pre></td></tr></table></figure>

<p><strong><em>redis 有哪些功能？</em></strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redis 的功能</span></span><br><span class="line"><span class="string">数据缓存功能</span></span><br><span class="line"><span class="string">分布式锁的功能</span></span><br><span class="line"><span class="string">支持数据持久化</span></span><br><span class="line"><span class="string">支持事务</span></span><br><span class="line"><span class="string">支持消息队列</span></span><br></pre></td></tr></table></figure>

<p><strong><em>redis 和 memecache 有什么区别？</em></strong></p>
<p><code>DJFASFDJAKLFASDLF;</code></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">memcached</span> <span class="string">所有的值均是简单的字符串，redis</span> <span class="string">作为其替代者，支持更为丰富的数据类型</span></span><br><span class="line"><span class="string">redis</span> <span class="string">的速度比</span> <span class="string">memcached</span> <span class="string">快很多</span></span><br><span class="line"><span class="string">redis</span> <span class="string">可以持久化其数据</span></span><br></pre></td></tr></table></figure>

<p><strong><em>redis 为什么是单线程的？</em></strong></p>
<hr>
<p>因为 cpu 不是 Redis 的瓶颈，Redis 的瓶颈最有可能是机器内存或者网络带宽。既然单线程容易实现，而且 cpu 又不会成为瓶颈，那就顺理成章地采用单线程的方案了。关于 Redis 的性能，官方网站也有，普通笔记本轻松处理每秒几十万的请求。而且单线程并不代表就慢 nginx 和 nodejs 也都是高性能单线程的代表。</p>
<p>什么是缓存穿透？怎么解决？</p>
<hr>
<p><strong><em>缓存穿透：</em></strong> 指查询一个一定不存在的数据，由于缓存是不命中时需要从数据库查询，查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到数据库去查询，造成缓存穿透。<br><strong><em>解决方案：</em></strong>最简单粗暴的方法如果一个查询返回的数据为空（不管是数据不存在，还是系统故障），我们就把这个空结果进行缓存，但它的过期时间会很短，最长不超过五分钟。</p>
<p>redis 支持的数据类型有哪些？</p>
<hr>
<p>string、list、hash、set、zset。</p>
<p>redis 支持的 java 客户端都有哪些？</p>
<hr>
<p>Redisson、Jedis、lettuce等等，官方推荐使用Redisson。</p>
<p>jedis 和 redisson 有哪些区别？</p>
<hr>
<p>Jedis是Redis的Java实现的客户端，其API提供了比较全面的Redis命令的支持。</p>
<p>Redisson实现了分布式和可扩展的Java数据结构，和Jedis相比，功能较为简单，不支持字符串操作，不支持排序、事务、管道、分区等Redis特性。Redisson的宗旨是促进使用者对Redis的关注分离，从而让使用者能够将精力更集中地放在处理业务逻辑上。</p>
<p>怎么保证缓存和数据库数据的一致性？</p>
<hr>
<ul>
<li>合理设置缓存的过期时间。</li>
<li>新增、更改、删除数据库操作时同步更新 Redis，可以使用事物机制来保证数据的一致性。</li>
</ul>
<p>redis 持久化有几种方式？</p>
<hr>
<p>Redis 的持久化有两种方式，或者说有两种策略：</p>
<ul>
<li>RDB（Redis Database）：指定的时间间隔能对你的数据进行快照存储。</li>
<li>AOF（Append Only File）：每一个收到的写命令都通过write函数追加到文件中。</li>
</ul>
<p>redis 怎么实现分布式锁？</p>
<hr>
<p>Redis 分布式锁其实就是在系统里面占一个“坑”，其他程序也要占“坑”的时候，占用成功了就可以继续执行，失败了就只能放弃或稍后重试。</p>
<p>占坑一般使用 setnx(set if not exists)指令，只允许被一个程序占有，使用完调用 del 释放锁。</p>
<p>redis 分布式锁有什么缺陷？</p>
<hr>
<p>Redis 分布式锁不能解决超时的问题，分布式锁有一个超时时间，程序的执行如果超出了锁的超时时间就会出现问题。</p>
<p>redis 如何做内存优化？</p>
<hr>
<p>尽可能使用散列表（hashes），散列表（是说散列表里面存储的数少）使用的内存非常小，所以你应该尽可能的将你的数据模型抽象到一个散列表里面。</p>
<p>比如你的web系统中有一个用户对象，不要为这个用户的名称，姓氏，邮箱，密码设置单独的key,而是应该把这个用户的所有信息存储到一张散列表里面。</p>
<p>redis 淘汰策略有哪些？</p>
<hr>
<ul>
<li>volatile-lru：从已设置过期时间的数据集（server. db[i]. expires）中挑选最近最少使用的数据淘汰。</li>
<li>volatile-ttl：从已设置过期时间的数据集（server. db[i]. expires）中挑选将要过期的数据淘汰。</li>
<li>volatile-random：从已设置过期时间的数据集（server. db[i]. expires）中任意选择数据淘汰。</li>
<li>allkeys-lru：从数据集（server. db[i]. dict）中挑选最近最少使用的数据淘汰。</li>
<li>allkeys-random：从数据集（server. db[i]. dict）中任意选择数据淘汰。</li>
<li>no-enviction（驱逐）：禁止驱逐数据。</li>
</ul>
<p>redis 常见的性能问题有哪些？该如何解决？</p>
<hr>
<p>主服务器写内存快照，会阻塞主线程的工作，当快照比较大时对性能影响是非常大的，会间断性暂停服务，所以主服务器最好不要写内存快照。<br>Redis 主从复制的性能问题，为了主从复制的速度和连接的稳定性，主从库最好在同一个局域网内。</p>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item  guo-tags">
                    <i class="fas fa-tags has-text-grey"></i>&nbsp;&nbsp;
                    <a class="has-link-grey -link" href="/tags/Redis/" rel="tag">Redis</a>
                </div>
            </div>
        </div>
        
        
        
        <!-- 文章版权信息代码开始 -->

        
            <ul class="post-copyright">
            <li><b>本文标题：</b><b>Redis 入门教程</b></li>
            <li><b>本文作者：</b><b>Java Developer</b></li>
            <li><b>本文链接：</b><b><a href="https://guoshizhan.github.io/redis.html">https://guoshizhan.github.io/redis.html</a></b></li>
            <li><b>版权声明：</b><b>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</b>
            </li>
            </ul>
            <br/>
            <span class="is-size-6 has-text-grey has-mr-7">📚&nbsp;本站推荐文章</span>
<br>

    &nbsp;<!--1--> 👉 <a href="/blog-setup.html" class="is-size-6" target="_blank">从 0 开始搭建 Hexo 博客</a><br>

    &nbsp;<!--2--> 👉 <a href="/computerNetwork.html" class="is-size-6" target="_blank">计算机网络入门教程</a><br>

    &nbsp;<!--3--> 👉 <a href="/Structure.html" class="is-size-6" target="_blank">数据结构入门</a><br>

    &nbsp;<!--4--> 👉 <a href="/Algorithm.html" class="is-size-6" target="_blank">算法入门</a><br>

    &nbsp;<!--5--> 👉 <a href="/IDEA.html" class="is-size-6" target="_blank">IDEA 入门教程</a><br>

            <br>
        

        <!-- 文章版权信息代码结束-->
        

        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3>
        <div class="buttons is-centered">
            
                
<a class="button is-info donate">
    <span class="icon is-small">
        <i class="fab fa-alipay"></i>
    </span>
    <span>支付宝</span>
    <div class="qrcode"><img src="/images/wechat.png" alt="支付宝"></div>
</a>

                
                
<a class="button is-success donate">
    <span class="icon is-small">
        <i class="fab fa-weixin"></i>
    </span>
    <span>微信</span>
    <div class="qrcode"><img src="/images/wechat.png" alt="微信"></div>
</a>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/Ajax-Json.html">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">AJAX 和 JSON 知识</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/Mybatis.html">
                <span class="level-item">Mybatis 入门教程</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">可在评论区留言哦</h3>
        
<div id="comment-container"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.4.1/dist/gitalk.min.js"></script>
<script>
    var gitalk = new Gitalk({
        clientID: 'cff2590c3ebe89a56cf0',
        clientSecret: 'b6eea23c7fd06b8a540fea56bfa7546a3dfcf214',
        id: 'a5c8ba0b5a515455f47b1e976930e8f5',
        repo: 'gitalk-comments',
        owner: 'guoshizhan',
        admin: "guoshizhan",
        createIssueManually: false,
        distractionFreeMode: true
    })
    gitalk.render('comment-container')
</script>

    </div>
</div>
</div>
                




<div class="column is-4-tablet is-3-desktop is-3-widescreen  has-order-1 column-left is-sticky">
    
        <!--         这里的第一行和最后一行的功能是动态隐藏 profile ，菜单页显示，文章页不显示。-->

<div class="card widget">
    <div class="card-content guo-profile">
        <nav class="level">
            <div class="level-item has-text-centered guo-nav" style="flex-shrink: 1">
                <div class="guo-header">
                    <div class="guo-img">
                        
                        <figure class="image is-128x128 has-mb-6">
                            <img class="is-rounded  avatar-image" src="/images/avatar.gif" alt="何年の再遇见">
                        </figure>
                    </div>
                    
                    <div class="guo-text">
                        
                            <p class="is-size-4 is-block">
                                何年の再遇见
                            </p>
                            
                            
                            <p class="is-size-6 is-block">
                                愿你走出半生，归来仍是少年
                            </p>
                            
                            
                            <p class="is-size-6 is-flex is-flex-center">
                                <i class="fas fa-map-marker-alt has-mr-7"></i>
                                <span>井冈山大学</span>
                            </p>
                        
                    </div>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile guo-nav">
            <div class="level-item has-text-centered is-marginless wz">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            29
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless fl">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            8
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless bq">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            38
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        <!--
        
            <div >
                <a class="level-item button guo-github" href="https://github.com/guoshizhan" target="_blank" rel="noopener">我的 GitHub 地址</a>
            </div>
        
        -->
        
        
        <div style="max-height:100px;">
            <p id="hitokoto">一言句子获取中...</p>
            <script src="https://v1.hitokoto.cn/?encode=js&select=%23hitokoto" defer></script>
        </div>
    </div>
</div>
<!--         这里的最后一行和第一行的功能是动态隐藏 profile ，菜单页显示，文章页不显示。-->
    
        

    <div class="card widget toc-scroll" id="toc">
        <div class="card-content">
            <div class="menu">
                <h3 class="menu-label">
                    目录
                </h3>
                <ul class="menu-list"><li>
        <a class="is-flex" href="#Redis-基本介绍">
        <span class="has-mr-6">1</span>
        <span>Redis 基本介绍</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#Redis-简介">
        <span class="has-mr-6">1.1</span>
        <span>Redis 简介</span>
        </a></li><li>
        <a class="is-flex" href="#Redis-优缺点">
        <span class="has-mr-6">1.2</span>
        <span>Redis 优缺点</span>
        </a></li><li>
        <a class="is-flex" href="#Redis-应用场景">
        <span class="has-mr-6">1.3</span>
        <span>Redis 应用场景</span>
        </a></li><li>
        <a class="is-flex" href="#Redis-下载安装">
        <span class="has-mr-6">1.4</span>
        <span>Redis 下载安装</span>
        </a></li><li>
        <a class="is-flex" href="#Redis-配置文件详解">
        <span class="has-mr-6">1.5</span>
        <span>Redis 配置文件详解</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#相关操作命令">
        <span class="has-mr-6">2</span>
        <span>相关操作命令</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#redis-数据结构">
        <span class="has-mr-6">2.1</span>
        <span>redis 数据结构</span>
        </a></li><li>
        <a class="is-flex" href="#通用命令">
        <span class="has-mr-6">2.2</span>
        <span>通用命令</span>
        </a></li><li>
        <a class="is-flex" href="#字符串类型">
        <span class="has-mr-6">2.3</span>
        <span>字符串类型</span>
        </a></li><li>
        <a class="is-flex" href="#哈希类型">
        <span class="has-mr-6">2.4</span>
        <span>哈希类型</span>
        </a></li><li>
        <a class="is-flex" href="#列表类型">
        <span class="has-mr-6">2.5</span>
        <span>列表类型</span>
        </a></li><li>
        <a class="is-flex" href="#集合类型">
        <span class="has-mr-6">2.6</span>
        <span>集合类型</span>
        </a></li><li>
        <a class="is-flex" href="#有序集合类型">
        <span class="has-mr-6">2.7</span>
        <span>有序集合类型</span>
        </a></li><li>
        <a class="is-flex" href="#Redis-的持久化">
        <span class="has-mr-6">2.8</span>
        <span>Redis 的持久化</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#持久化简介">
        <span class="has-mr-6">2.8.1</span>
        <span>持久化简介</span>
        </a></li><li>
        <a class="is-flex" href="#持久化机制">
        <span class="has-mr-6">2.8.2</span>
        <span>持久化机制</span>
        </a></li></ul></li></ul></li><li>
        <a class="is-flex" href="#Jedis-快速入门">
        <span class="has-mr-6">3</span>
        <span>Jedis 快速入门</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#Jedis-简介">
        <span class="has-mr-6">3.1</span>
        <span>Jedis 简介</span>
        </a></li><li>
        <a class="is-flex" href="#Jedis-的使用">
        <span class="has-mr-6">3.2</span>
        <span>Jedis 的使用</span>
        </a></li><li>
        <a class="is-flex" href="#Jedis-的各种操作">
        <span class="has-mr-6">3.3</span>
        <span>Jedis 的各种操作</span>
        </a></li><li>
        <a class="is-flex" href="#Jedis-连接池">
        <span class="has-mr-6">3.4</span>
        <span>Jedis 连接池</span>
        </a></li><li>
        <a class="is-flex" href="#Jedis-连接池工具类">
        <span class="has-mr-6">3.5</span>
        <span>Jedis 连接池工具类</span>
        </a></li><li>
        <a class="is-flex" href="#Redis-案例">
        <span class="has-mr-6">3.6</span>
        <span>Redis 案例</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#案例准备">
        <span class="has-mr-6">3.6.1</span>
        <span>案例准备</span>
        </a></li><li>
        <a class="is-flex" href="#案例编码">
        <span class="has-mr-6">3.6.2</span>
        <span>案例编码</span>
        </a></li><li>
        <a class="is-flex" href="#使用-Redis-作为缓存">
        <span class="has-mr-6">3.6.3</span>
        <span>使用 Redis 作为缓存</span>
        </a></li></ul></li></ul></li><li>
        <a class="is-flex" href="#Redis-进阶">
        <span class="has-mr-6">4</span>
        <span>Redis 进阶</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#Redis-在-Linux-下的安装">
        <span class="has-mr-6">4.1</span>
        <span>Redis 在 Linux 下的安装</span>
        </a></li><li>
        <a class="is-flex" href="#Redis-性能测试">
        <span class="has-mr-6">4.2</span>
        <span>Redis 性能测试</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#三种特殊数据类型">
        <span class="has-mr-6">5</span>
        <span>三种特殊数据类型</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#geospatial-地理位置">
        <span class="has-mr-6">5.1</span>
        <span>geospatial-地理位置</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#GEOADD">
        <span class="has-mr-6">5.1.1</span>
        <span>GEOADD</span>
        </a></li><li>
        <a class="is-flex" href="#GEOPOS">
        <span class="has-mr-6">5.1.2</span>
        <span>GEOPOS</span>
        </a></li><li>
        <a class="is-flex" href="#GEODIST">
        <span class="has-mr-6">5.1.3</span>
        <span>GEODIST</span>
        </a></li><li>
        <a class="is-flex" href="#GEORADIUS">
        <span class="has-mr-6">5.1.4</span>
        <span>GEORADIUS</span>
        </a></li><li>
        <a class="is-flex" href="#GEORADIUSBYMEMBER">
        <span class="has-mr-6">5.1.5</span>
        <span>GEORADIUSBYMEMBER</span>
        </a></li><li>
        <a class="is-flex" href="#GEOHASH">
        <span class="has-mr-6">5.1.6</span>
        <span>GEOHASH</span>
        </a></li><li>
        <a class="is-flex" href="#特别提示">
        <span class="has-mr-6">5.1.7</span>
        <span>特别提示</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#HyperLogLog-类型">
        <span class="has-mr-6">5.2</span>
        <span>HyperLogLog 类型</span>
        </a></li><li>
        <a class="is-flex" href="#Bitmaps-位图">
        <span class="has-mr-6">5.3</span>
        <span>Bitmaps 位图</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#Redis-事务">
        <span class="has-mr-6">6</span>
        <span>Redis 事务</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#Redis-事务介绍">
        <span class="has-mr-6">6.1</span>
        <span>Redis 事务介绍</span>
        </a></li><li>
        <a class="is-flex" href="#Redis-事务相关命令">
        <span class="has-mr-6">6.2</span>
        <span>Redis 事务相关命令</span>
        </a></li><li>
        <a class="is-flex" href="#Redis-实现乐观锁">
        <span class="has-mr-6">6.3</span>
        <span>Redis 实现乐观锁</span>
        </a></li><li>
        <a class="is-flex" href="#Spring-Boot-整合-Redis">
        <span class="has-mr-6">6.4</span>
        <span>Spring Boot 整合 Redis</span>
        </a></li><li>
        <a class="is-flex" href="#自定义-redisTemplate">
        <span class="has-mr-6">6.5</span>
        <span>自定义 redisTemplate</span>
        </a></li><li>
        <a class="is-flex" href="#自定义-Redis-工具类">
        <span class="has-mr-6">6.6</span>
        <span>自定义 Redis 工具类</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#Redis-高级">
        <span class="has-mr-6">7</span>
        <span>Redis 高级</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#Redis-配置文件详解-1">
        <span class="has-mr-6">7.1</span>
        <span>Redis 配置文件详解</span>
        </a></li><li>
        <a class="is-flex" href="#Redis-的发布订阅">
        <span class="has-mr-6">7.2</span>
        <span>Redis 的发布订阅</span>
        </a></li><li>
        <a class="is-flex" href="#Redis-的集群搭建">
        <span class="has-mr-6">7.3</span>
        <span>Redis 的集群搭建</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#集群简介">
        <span class="has-mr-6">7.3.1</span>
        <span>集群简介</span>
        </a></li><li>
        <a class="is-flex" href="#集群搭建">
        <span class="has-mr-6">7.3.2</span>
        <span>集群搭建</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#Redis-的主从复制">
        <span class="has-mr-6">7.4</span>
        <span>Redis 的主从复制</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#主从复制简介">
        <span class="has-mr-6">7.4.1</span>
        <span>主从复制简介</span>
        </a></li><li>
        <a class="is-flex" href="#主从复制搭建">
        <span class="has-mr-6">7.4.2</span>
        <span>主从复制搭建</span>
        </a></li><li>
        <a class="is-flex" href="#宕机后手动配置主机">
        <span class="has-mr-6">7.4.3</span>
        <span>宕机后手动配置主机</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#哨兵模式详解">
        <span class="has-mr-6">7.5</span>
        <span>哨兵模式详解</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#哨兵模式简介">
        <span class="has-mr-6">7.5.1</span>
        <span>哨兵模式简介</span>
        </a></li><li>
        <a class="is-flex" href="#哨兵模式配置">
        <span class="has-mr-6">7.5.2</span>
        <span>哨兵模式配置</span>
        </a></li><li>
        <a class="is-flex" href="#优缺点及问题">
        <span class="has-mr-6">7.5.3</span>
        <span>优缺点及问题</span>
        </a></li><li>
        <a class="is-flex" href="#哨兵模式配置文件">
        <span class="has-mr-6">7.5.4</span>
        <span>哨兵模式配置文件</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#缓存穿透和雪崩">
        <span class="has-mr-6">7.6</span>
        <span>缓存穿透和雪崩</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#缓存穿透简介">
        <span class="has-mr-6">7.6.1</span>
        <span>缓存穿透简介</span>
        </a></li><li>
        <a class="is-flex" href="#缓存击穿">
        <span class="has-mr-6">7.6.2</span>
        <span>缓存击穿</span>
        </a></li><li>
        <a class="is-flex" href="#缓存雪崩">
        <span class="has-mr-6">7.6.3</span>
        <span>缓存雪崩</span>
        </a></li></ul></li></ul></li><li>
        <a class="is-flex" href="#Redis-面试题">
        <span class="has-mr-6">8</span>
        <span>Redis 面试题</span>
        </a></li></ul>
            </div>
        </div>
    </div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/C-python-Linux/">
            <span class="level-start">
                <span class="level-item">C-python-Linux</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Java%E5%AD%A6%E4%B9%A0/">
            <span class="level-start">
                <span class="level-item">Java学习</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">12</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/">
            <span class="level-start">
                <span class="level-item">前端知识</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E5%A4%A7%E5%AD%A6-%E7%94%9F%E6%B4%BB-%E5%85%B6%E4%BB%96/">
            <span class="level-start">
                <span class="level-item">大学-生活-其他</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E6%95%99%E7%A8%8B%E5%B7%A5%E5%85%B7/">
            <span class="level-start">
                <span class="level-item">教程工具</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">
            <span class="level-start">
                <span class="level-item">数据库</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/">
            <span class="level-start">
                <span class="level-item">数据结构和算法</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">
            <span class="level-start">
                <span class="level-item">计算机网络</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow  is-sticky">
        
            <div class="card widget">
	<div class="card-content">
		<h3 class="menu-label">我的歌单</h3>
		<div class="aplayer" data-id="1997628239" data-server="netease" data-type="playlist" data-mode="single"></div>
	</div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/AJAX/" style="font-size: 10px;">AJAX</a> <a href="/tags/CMD%E5%91%BD%E4%BB%A4/" style="font-size: 10px;">CMD命令</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/IDEA%E6%95%99%E7%A8%8B/" style="font-size: 10px;">IDEA教程</a> <a href="/tags/IO-%E6%B5%81/" style="font-size: 10px;">IO 流</a> <a href="/tags/JSON/" style="font-size: 10px;">JSON</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 16.67px;">Java基础</a> <a href="/tags/Java%E9%9B%86%E5%90%88/" style="font-size: 10px;">Java集合</a> <a href="/tags/Jenkins/" style="font-size: 10px;">Jenkins</a> <a href="/tags/Layui-%E5%8D%9A%E5%AE%A2/" style="font-size: 10px;">Layui 博客</a> <a href="/tags/LeetCode/" style="font-size: 10px;">LeetCode</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">Oracle数据库</a> <a href="/tags/PL-SQL/" style="font-size: 10px;">PL/SQL</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SSM/" style="font-size: 10px;">SSM</a> <a href="/tags/Spring-Boot/" style="font-size: 13.33px;">Spring Boot</a> <a href="/tags/Vue/" style="font-size: 10px;">Vue</a> <a href="/tags/hello-world/" style="font-size: 10px;">hello world</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/icarus%E4%B8%BB%E9%A2%98/" style="font-size: 10px;">icarus主题</a> <a href="/tags/mybatis/" style="font-size: 10px;">mybatis</a> <a href="/tags/windows%E6%95%99%E7%A8%8B/" style="font-size: 10px;">windows教程</a> <a href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">函数式编程</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">前端</a> <a href="/tags/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/" style="font-size: 10px;">博客搭建</a> <a href="/tags/%E5%8F%8D%E5%B0%84%E6%B3%A8%E8%A7%A3/" style="font-size: 10px;">反射注解</a> <a href="/tags/%E5%B8%B8%E7%94%A8-API/" style="font-size: 10px;">常用 API</a> <a href="/tags/%E5%B8%B8%E7%94%A8%E7%AE%97%E6%B3%95/" style="font-size: 10px;">常用算法</a> <a href="/tags/%E6%95%85%E4%BA%8B/" style="font-size: 10px;">故事</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 10px;">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 10px;">数据结构</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">网络编程</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">计算机网络</a>
    </div>
</div>
        
            <div class="card widget">
  <div class="card-content">
    <div class="menu">
      <h3 class="menu-label">
        订阅更新
      </h3>
      <div>
        <form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow"
          onsubmit="window.open('https://feedburner.google.com/fb/a/mailverify?uri=guoshizhanFeedsId', 'popupwindow', 'scrollbars=yes,width=550,height=520');return true">
          <input type="hidden" value="guoshizhanFeedsId" name="uri" />
          <input type="hidden" name="loc" value="en_US" />
          <div class="field">
            <div class="control has-icons-left">
              <input class="input" name="email" type="email" placeholder="请输入邮箱地址" />
              <span class="icon is-small is-left">
                <i class="fas fa-envelope"></i>
              </span>
            </div>
            <p class="help">立即订阅跳转人机认证后，点击完成按钮！</p>
          </div>
          <div class="field is-grouped is-grouped-right">
            <div class="control">
              <input class="button is-link is-rounded" type="submit" value="订阅">
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/GSZ's-Blog.png" alt="Redis 入门教程" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 Java Developer&nbsp;
                Powered &#10084; ShiZhan·Guo
                </p>
            </div>    
            <script>
                (function(){
                    var bp = document.createElement('script');
                    var curProtocol = window.location.protocol.split(':')[0];
                    if (curProtocol === 'https') {
                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                    }
                    else {
                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                    }
                    var s = document.getElementsByTagName("script")[0];
                    s.parentNode.insertBefore(bp, s);
                })();
            </script>

            <div align="center" id="access-number">
                <br>
                <script type="text/javascript" src="/js/statistics.js"></script>
                <span id="statistic-times"></span>
                <br>
                <div align="center">
                    <span class="busuanzi_container_site_pv">总访问量 
                        <b><span id="busuanzi_value_site_pv"></span></b> 次
                    </span>
                    <span class="busuanzi_container_site_uv">您是第  
                        <b><span id="busuanzi_value_site_uv"></b>
                        </span> 位小伙伴
                    </span>
                    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
                </div>
            </div>
            
            
            <!--<div id="earth">
                <span>
                <script type="text/javascript" src="//rf.revolvermaps.com/0/0/2.js?i=0xetp0d4rdh&m=7&s=130&c=00fff6&t=1" async="async"></script>
                </span>
            </div>-->


            <!--这个一个空的 div ，目的是让卜算子统计居中-->
            <div id="empty"></div>


            <script>
                (function(){
                    var bp = document.createElement('script');
                    bp.src = '//push.zhanzhang.baidu.com/push.js';
                    var s = document.getElementsByTagName("script")[0];
                    s.parentNode.insertBefore(bp, s);
                })();
            </script>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'https://guoshizhan.github.io',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
    
    <!--配置看板娘-->
    <script type="text/javascript" async="" src="/live2d/autoload.js"></script>

    <!--音乐js文件-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
    <script src="/js/APlayer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script>
</body>
</html>